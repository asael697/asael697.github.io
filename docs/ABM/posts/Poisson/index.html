<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.1.179">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="Asael Alonzo Matamoros">
<meta name="dcterms.date" content="2022-12-01">

<title>asael_am - Efectividad de repelentes de insectos</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1.6em;
  vertical-align: middle;
}
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { color: #008000; } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { color: #008000; font-weight: bold; } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
div.csl-bib-body { }
div.csl-entry {
  clear: both;
}
.hanging div.csl-entry {
  margin-left:2em;
  text-indent:-2em;
}
div.csl-left-margin {
  min-width:2em;
  float:left;
}
div.csl-right-inline {
  margin-left:2em;
  padding-left:1em;
}
div.csl-indent {
  margin-left: 2em;
}
</style>


<script src="../../../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../../../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../../../site_libs/clipboard/clipboard.min.js"></script>
<script src="../../../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../../../site_libs/quarto-search/fuse.min.js"></script>
<script src="../../../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../../../">
<script src="../../../site_libs/quarto-html/quarto.js"></script>
<script src="../../../site_libs/quarto-html/popper.min.js"></script>
<script src="../../../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../../../site_libs/quarto-html/anchor.min.js"></script>
<link href="../../../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../../../site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" class="quarto-color-scheme" id="quarto-text-highlighting-styles">
<link href="../../../site_libs/quarto-html/quarto-syntax-highlighting-dark.css" rel="prefetch" class="quarto-color-scheme quarto-color-alternate" id="quarto-text-highlighting-styles">
<script src="../../../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../../../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../../../site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" class="quarto-color-scheme" id="quarto-bootstrap" data-mode="light">
<link href="../../../site_libs/bootstrap/bootstrap-dark.min.css" rel="prefetch" class="quarto-color-scheme quarto-color-alternate" id="quarto-bootstrap" data-mode="dark">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 20,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit"
  }
}</script>
<style>html{ scroll-behavior: smooth; }</style>
<link href="../../../site_libs/tabwid-1.1.0/tabwid.css" rel="stylesheet">
<link href="../../../site_libs/tabwid-1.1.0/scrool.css" rel="stylesheet">

  <script>window.backupDefine = window.define; window.define = undefined;</script><script src="https://cdn.jsdelivr.net/npm/katex@0.15.1/dist/katex.min.js"></script>
  <script>document.addEventListener("DOMContentLoaded", function () {
 var mathElements = document.getElementsByClassName("math");
 var macros = [];
 for (var i = 0; i < mathElements.length; i++) {
  var texText = mathElements[i].firstChild;
  if (mathElements[i].tagName == "SPAN") {
   katex.render(texText.data, mathElements[i], {
    displayMode: mathElements[i].classList.contains('display'),
    throwOnError: false,
    macros: macros,
    fleqn: false
   });
}}});
  </script>
  <script>window.define = window.backupDefine; window.backupDefine = undefined;</script><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.15.1/dist/katex.min.css">

<link rel="stylesheet" href="../../../styles.css">
</head>

<body class="nav-fixed">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg navbar-dark ">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container">
    <a class="navbar-brand" href="../../../index.html">
    <span class="navbar-title">asael_am</span>
    </a>
  </div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll me-auto">
  <li class="nav-item">
    <a class="nav-link" href="../../../about.html">CV</a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../../ABM/index.html">Applied Bayesian Modeling</a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../../DOF/index.html">Depression and other stories</a>
  </li>  
</ul>
            <ul class="navbar-nav navbar-nav-scroll ms-auto">
  <li class="nav-item compact">
    <a class="nav-link" href="https://twitter.com/Asael_am"><i class="bi bi-twitter" role="img">
</i> 
 </a>
  </li>  
  <li class="nav-item compact">
    <a class="nav-link" href="https://github.com/asael697"><i class="bi bi-github" role="img">
</i> 
 </a>
  </li>  
  <li class="nav-item compact">
    <a class="nav-link" href="https://www.linkedin.com/in/asael-alonzo-matamoros-8466836a/"><i class="bi bi-linkedin" role="img">
</i> 
 </a>
  </li>  
</ul>
              <div class="quarto-toggle-container">
                  <a href="" class="quarto-color-scheme-toggle nav-link" onclick="window.quartoToggleColorScheme(); return false;" title="Toggle dark mode"><i class="bi"></i></a>
              </div>
              <div id="quarto-search" class="" title="Search"></div>
          </div> <!-- /navcollapse -->
      </div> <!-- /container-fluid -->
    </nav>
</header>
<!-- content -->
<header id="title-block-header" class="quarto-title-block default page-columns page-full">
  <div class="quarto-title-banner page-columns page-full">
    <div class="quarto-title column-body">
      <h1 class="title">Efectividad de repelentes de insectos</h1>
            <p class="subtitle lead">Bayesian Poisson models</p>
                                <div class="quarto-categories">
                <div class="quarto-category">Bayesian</div>
                <div class="quarto-category">analysis</div>
                <div class="quarto-category">code</div>
                <div class="quarto-category">Poisson</div>
              </div>
                  </div>
  </div>
    
  
  <div class="quarto-title-meta">

      <div>
      <div class="quarto-title-meta-heading">Author</div>
      <div class="quarto-title-meta-contents">
               <p>Asael Alonzo Matamoros </p>
            </div>
    </div>
      
      <div>
      <div class="quarto-title-meta-heading">Published</div>
      <div class="quarto-title-meta-contents">
        <p class="date">December 1, 2022</p>
      </div>
    </div>
      
    </div>
    
  
  </header><div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">On this page</h2>
   
  <ul>
  <li><a href="#modelo-m1-de-poisson-conjugado" id="toc-modelo-m1-de-poisson-conjugado" class="nav-link active" data-scroll-target="#modelo-m1-de-poisson-conjugado">Modelo <span class="math inline">M1</span> de Poisson Conjugado</a>
  <ul class="collapse">
  <li><a href="#selección-de-la-prior" id="toc-selección-de-la-prior" class="nav-link" data-scroll-target="#selección-de-la-prior">Selección de la prior</a></li>
  <li><a href="#estimadores-puntuales" id="toc-estimadores-puntuales" class="nav-link" data-scroll-target="#estimadores-puntuales">Estimadores puntuales</a></li>
  <li><a href="#posterior-predictive-checks" id="toc-posterior-predictive-checks" class="nav-link" data-scroll-target="#posterior-predictive-checks">Posterior predictive checks</a></li>
  </ul></li>
  <li><a href="#modelo-m_2-de-binomial-negativa-con-priori-dispersa" id="toc-modelo-m_2-de-binomial-negativa-con-priori-dispersa" class="nav-link" data-scroll-target="#modelo-m_2-de-binomial-negativa-con-priori-dispersa">Modelo <span class="math inline">M_2</span> de Binomial Negativa con priori dispersa</a></li>
  <li><a href="#modelo-m_3-de-poisson-con-prior-débil" id="toc-modelo-m_3-de-poisson-con-prior-débil" class="nav-link" data-scroll-target="#modelo-m_3-de-poisson-con-prior-débil">Modelo <span class="math inline">M_3</span> de Poisson con prior débil</a>
  <ul class="collapse">
  <li><a href="#selección-de-modelos" id="toc-selección-de-modelos" class="nav-link" data-scroll-target="#selección-de-modelos">Selección de Modelos</a></li>
  </ul></li>
  <li><a href="#referencias" id="toc-referencias" class="nav-link" data-scroll-target="#referencias">Referencias</a></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content quarto-banner-title-block" id="quarto-document-content">




<p>Este post muestra los pasos del Bayesian Workflow para analizar la base de datos <code>Insects-Spray</code>.</p>
<p>Se desea evaluar la efectividad de seis diferentes tipos de repelentes para insectos (<span class="math inline">A,B,\ldots,F</span>). El experimento consiste en contar el número de insectos en cierta área delimitada, horas después de aplicar cierto tipo de repelente. El experimento se replicó 72 veces, 12 veces para cada uno de los tipos de repelente.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(GGally)</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggplot2)</span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(flextable)</span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(bayesplot)</span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(posterior)</span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a><span class="fu">data</span>(<span class="st">"InsectSprays"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>La <a href="#fig-box">Figure&nbsp;1</a> resume la distribución y valores medios del número de insectos encontrados en cada uno de los tipos de repelente utilizados. Claramente, las distribuciones son no simétricas y muy heterogéneas entre cada uno de los tipos, y los datos son de tipo discreto, por lo tanto se descartan los supuestos de normalidad.</p>
<p>Supondremos tres modelos distintos:</p>
<ul>
<li>Modelo de Poisson, con parámetro <span class="math inline">\lambda</span> desconocido y prior conjugada de tipo Gamma:</li>
</ul>
<p><span class="math display">M_1: \ y_i \sim Poisson(\lambda), \quad \lambda \sim Gamma(\alpha,\beta).</span></p>
<ul>
<li>Modelo Binomial negativa, con parámetro <span class="math inline">p</span> desconocido y prior dispersa:</li>
</ul>
<p><span class="math display">M_2: \ y_i \sim \text{Neg-Binom}(n,p), \quad \lambda \sim U(1,1).</span></p>
<ul>
<li>Modelo de Poisson, con parámetro <span class="math inline">\lambda</span> desconocido y prior no conjugada de tipo Normal:</li>
</ul>
<p><span class="math display">M_3: \ y_i \sim Poisson(\lambda), \quad \lambda \sim N(\mu,\sigma^2).</span></p>
<p>Note que en cada modelo, no consideramos la dispersión entre grupos presente en los datos, simplemente queremos modelar la distribución global del número de insectos contabilizados independiente del repelente utilizado.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">y =</span> count, <span class="at">x =</span> spray,<span class="at">fill =</span> spray),<span class="at">data =</span> InsectSprays)<span class="sc">+</span></span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_boxplot</span>()<span class="sc">+</span></span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"Número de insectos por tipo de repelente"</span>,</span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a>       <span class="at">x =</span> <span class="st">"tipo de repelente"</span>,<span class="at">y =</span> <span class="st">"Número de insectos"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div id="fig-box" class="quarto-figure quarto-figure-center anchored">
<figure class="figure">
<p><img src="index_files/figure-html/fig-box-1.png" class="img-fluid figure-img" width="672"></p>
<p></p><figcaption class="figure-caption">Figure&nbsp;1: Gráfico de cajas. Cada caja representa una distribución por cuantiles del número de insectos encontrados en cada uno de los tipos de repelentes. Los repelentes de tipo A,B y F, presentan más insectos que las cajas C, D y E. Además, las dispersiones de los primeros tres tipos son mayores a las dispersiones presentadas en las cajas C, D y E.</figcaption><p></p>
</figure>
</div>
</div>
</div>
<p>Los ejemplos propuestos se resolverán de tres diferentes formas:</p>
<ol type="1">
<li><p>Los modelos <span class="math inline">M_1</span> y <span class="math inline">M_2</span> se resolverán con un Gibbs sampler, que para estos casos es un simple MC.</p></li>
<li><p>El modelo <span class="math inline">M_3</span> se resolverá con un Metrópolis-Hastings.</p></li>
</ol>
<section id="modelo-m1-de-poisson-conjugado" class="level2">
<h2 class="anchored" data-anchor-id="modelo-m1-de-poisson-conjugado">Modelo <span class="math inline">M1</span> de Poisson Conjugado</h2>
<p>Se define el número de insectos encontrado como una variable aleatoria discreta de tipo Poisson con parámetro <span class="math inline">\lambda</span> desconocido (<span class="math inline">y_i \sim Poisson(\lambda)</span>) y aleatorio, la priori para <span class="math inline">\lambda</span> es una prior conjugada y “poco informativa”. Asumamos que los repelentes aplicados son efectivos y elegir una prior Gamma tal que centre la probabilidad en valores cercanos al cero.</p>
<section id="selección-de-la-prior" class="level3">
<h3 class="anchored" data-anchor-id="selección-de-la-prior">Selección de la prior</h3>
<p>En este caso, la prior a usar es:</p>
<p><span class="math display">\lambda \sim Gamma(3,3).</span> <a href="#fig-priors1">Figure&nbsp;2</a> presenta posibles candidatos a priors para el parámetro <span class="math inline">\lambda</span>.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a>x <span class="ot">=</span> <span class="fu">c</span>(<span class="fu">rgamma</span>(<span class="dv">600</span>,<span class="dv">2</span>,<span class="dv">4</span>),<span class="fu">rgamma</span>(<span class="dv">600</span>,<span class="dv">3</span>,<span class="dv">3</span>),<span class="fu">rgamma</span>( <span class="dv">600</span>,<span class="dv">5</span>,<span class="dv">2</span>))</span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a>y <span class="ot">=</span> <span class="fu">c</span>(<span class="fu">rep</span>(<span class="st">"G(2,4)"</span>,<span class="dv">600</span>),<span class="fu">rep</span>(<span class="st">"G(3,3)"</span>,<span class="dv">600</span>),<span class="fu">rep</span>(<span class="st">"G(5,2)"</span>,<span class="dv">600</span>))</span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a>df <span class="ot">=</span> <span class="fu">data.frame</span>(<span class="at">sim =</span> x, <span class="at">dist =</span> y)</span>
<span id="cb3-5"><a href="#cb3-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-6"><a href="#cb3-6" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> sim,<span class="at">fill =</span> dist),<span class="at">data =</span> df)<span class="sc">+</span></span>
<span id="cb3-7"><a href="#cb3-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_density</span>(<span class="at">alpha =</span> <span class="fl">0.4</span>)<span class="sc">+</span></span>
<span id="cb3-8"><a href="#cb3-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"Diferentes tipos de priors"</span>,</span>
<span id="cb3-9"><a href="#cb3-9" aria-hidden="true" tabindex="-1"></a>       <span class="at">x =</span> <span class="st">"Simulaciones"</span>,<span class="at">y =</span> <span class="st">"densidad"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div id="fig-priors1" class="quarto-figure quarto-figure-center anchored">
<figure class="figure">
<p><img src="index_files/figure-html/fig-priors1-1.png" class="img-fluid figure-img" width="672"></p>
<p></p><figcaption class="figure-caption">Figure&nbsp;2: Gráfico de densidades. Se comparan tres distribuciones Gamma como posibles candidatos para priors de lambda, las tres priors tienen medias similares alrededor de 9, pero la prior G(2,4) es la que provee mayor dispersión, siendo más sujetiva.</figcaption><p></p>
</figure>
</div>
</div>
</div>
<p>La distribución a posteriori para <span class="math inline">\lambda</span> es:</p>
<p><span class="math display">\lambda |y \sim Gamma(3 + \sum_{i=1}^n y_i,3+n).</span></p>
<p>Donde, <span class="math inline">\sum_{i=1}^n y_i =</span> 684 y <span class="math inline">n = 72</span>. Por lo tanto la posterior final es: <span class="math inline">\lambda |y \sim Gamma (687,75)</span>.</p>
</section>
<section id="estimadores-puntuales" class="level3">
<h3 class="anchored" data-anchor-id="estimadores-puntuales">Estimadores puntuales</h3>
<p>El estimador puntual para <span class="math inline">\lambda</span> es:</p>
<p><span class="math display">\hat \lambda = E[\lambda | y] = \frac{687}{75} \approx 9.16.</span> <a href="#fig-reslt1">Figure&nbsp;3</a> muestra la comparación de las densidades prior y posterior para el modelo Poisson, pese que la prior se eligió con el propósito de ser no informativa, la posterior es muy especifica y centrada en su primer momento.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a>x <span class="ot">=</span> <span class="fu">c</span>(<span class="fu">rgamma</span>(<span class="dv">600</span>,<span class="dv">3</span>,<span class="dv">3</span>),<span class="fu">rgamma</span>(<span class="dv">600</span>,<span class="dv">687</span>,<span class="dv">75</span>))</span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a>y <span class="ot">=</span> <span class="fu">c</span>(<span class="fu">rep</span>(<span class="st">"Prior"</span>,<span class="dv">600</span>),<span class="fu">rep</span>(<span class="st">"Posterior"</span>,<span class="dv">600</span>))</span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-4"><a href="#cb4-4" aria-hidden="true" tabindex="-1"></a>df <span class="ot">=</span> <span class="fu">data.frame</span>(<span class="at">sim =</span> x, <span class="at">dist =</span> y)</span>
<span id="cb4-5"><a href="#cb4-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-6"><a href="#cb4-6" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> sim,<span class="at">fill =</span> dist),<span class="at">data =</span> df)<span class="sc">+</span></span>
<span id="cb4-7"><a href="#cb4-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_density</span>(<span class="at">alpha =</span> <span class="fl">0.4</span>)<span class="sc">+</span></span>
<span id="cb4-8"><a href="#cb4-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"Comparación Prior | Posterior"</span>,</span>
<span id="cb4-9"><a href="#cb4-9" aria-hidden="true" tabindex="-1"></a>       <span class="at">subtitle =</span> <span class="st">"Modelo Poisson Conjugado"</span>,</span>
<span id="cb4-10"><a href="#cb4-10" aria-hidden="true" tabindex="-1"></a>       <span class="at">x =</span> <span class="st">"Simulaciones"</span>,<span class="at">y =</span> <span class="st">"densidades"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div id="fig-reslt1" class="quarto-figure quarto-figure-center anchored">
<figure class="figure">
<p><img src="index_files/figure-html/fig-reslt1-1.png" class="img-fluid figure-img" width="672"></p>
<p></p><figcaption class="figure-caption">Figure&nbsp;3: Gráfico de densidades. Comparamos la distribuciones a Priori | Posteriori para el modelo Poisson conjugado, pese que la prior esta focalizada cerca de cero, la posterior se corre a la media de los datos, con muy poca dispersión, siendo muy especifica.</figcaption><p></p>
</figure>
</div>
</div>
</div>
<p>Los intervalos de credibilidad se encuentran mediante <code>Monte-Carlo</code>. Los intervalos de credibilidad al 90% para la posterior son:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a>IC <span class="ot">=</span> <span class="fu">quantile</span>(<span class="fu">rgamma</span>(<span class="dv">600</span>,<span class="dv">687</span>,<span class="dv">75</span>),<span class="at">probs =</span> <span class="fu">c</span>(<span class="fl">0.05</span>,<span class="fl">0.95</span>))</span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a>IC</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>      5%      95% 
8.554635 9.798944 </code></pre>
</div>
</div>
</section>
<section id="posterior-predictive-checks" class="level3">
<h3 class="anchored" data-anchor-id="posterior-predictive-checks">Posterior predictive checks</h3>
<p>En este caso se realizaran comparaciones de la densidad predictiva del modelo, esta se puede estimar con <code>Monte-Carlo</code> mediante el siguiente procedimiento.</p>
<ol type="1">
<li><p>Para <span class="math inline">k = 1,2,\ldots,w</span>; hacer</p>
<ul>
<li><p>1.1 Simular un valor <span class="math inline">\lambda_k</span> de la posterior <span class="math inline">Gamma(687,75)</span>.</p></li>
<li><p>1.2 Simular un valor de la verosimilitud <span class="math inline">y^*_k \sim Poisson(\lambda_k)</span>.</p></li>
</ul></li>
<li><p>Los valores <span class="math inline">y^*_1,y^*_2,\ldots,y^*_w</span> son una muestra de <span class="math inline">y^* | y</span>.</p></li>
</ol>
<p><a href="#fig-ppc1">Figure&nbsp;4</a> compara las predictivas distribuciones obtenidas, notamos que la función predictiva esta muy centrada en el valor esperado de los datos, y provee un ajuste muy pobre.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="fu">bayesplot_theme_set</span>(<span class="fu">theme_grey</span>())</span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a><span class="co"># Predictive</span></span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a>yrep <span class="ot">=</span> <span class="fu">rep</span>(<span class="fu">rpois</span>(<span class="dv">600</span>,<span class="fu">rgamma</span>(<span class="dv">600</span>,<span class="dv">687</span>,<span class="dv">75</span>)),<span class="dv">72</span>)</span>
<span id="cb7-4"><a href="#cb7-4" aria-hidden="true" tabindex="-1"></a>yrep <span class="ot">=</span> <span class="fu">matrix</span>(yrep,<span class="at">ncol =</span> <span class="dv">72</span>,<span class="at">byrow =</span> <span class="cn">TRUE</span>)</span>
<span id="cb7-5"><a href="#cb7-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-6"><a href="#cb7-6" aria-hidden="true" tabindex="-1"></a>y <span class="ot">=</span> InsectSprays<span class="sc">$</span>count</span>
<span id="cb7-7"><a href="#cb7-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-8"><a href="#cb7-8" aria-hidden="true" tabindex="-1"></a><span class="fu">ppc_dens_overlay</span>(y, yrep[<span class="dv">1</span><span class="sc">:</span><span class="dv">200</span>,])<span class="sc">+</span></span>
<span id="cb7-9"><a href="#cb7-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"Posterior Predictive Checks"</span>,</span>
<span id="cb7-10"><a href="#cb7-10" aria-hidden="true" tabindex="-1"></a>       <span class="at">subtitle =</span> <span class="st">"Modelo Poisson Conjugado"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div id="fig-ppc1" class="quarto-figure quarto-figure-center anchored">
<figure class="figure">
<p><img src="index_files/figure-html/fig-ppc1-1.png" class="img-fluid figure-img" width="672"></p>
<p></p><figcaption class="figure-caption">Figure&nbsp;4: Gráfico de densidades. Comparamos la distribuciones a predictiva y muestra para el modelo Poisson conjugado.</figcaption><p></p>
</figure>
</div>
</div>
</div>
</section>
</section>
<section id="modelo-m_2-de-binomial-negativa-con-priori-dispersa" class="level2">
<h2 class="anchored" data-anchor-id="modelo-m_2-de-binomial-negativa-con-priori-dispersa">Modelo <span class="math inline">M_2</span> de Binomial Negativa con priori dispersa</h2>
<p>Se define el número de insectos encontrado como una variable aleatoria discreta Binomial negativa con parámetro <span class="math inline">p</span> desconocido y <span class="math inline">m = 30</span> repeticiones, (<span class="math inline">y_i \sim \text{Neg=Binom}(30,p)</span>). La prior es conjugada para <span class="math inline">p</span> es la distribución Beta.</p>
<p><span class="math display">p \sim Beta(\alpha,\beta).</span></p>
<p>Esta prior genera una posterior de tipo Beta, pero si <span class="math inline">\alpha = \beta = 1</span> la distribución es uniforme en el intervalo unitario, que a su vez es una prior dispersa para <span class="math inline">p</span>.</p>
<p>La posterior para <span class="math inline">p</span> es:</p>
<p><span class="math display">p | y \sim Beta(1 + 30n,1+\sum_{i=1}^n y_i).</span></p>
<p>Por lo tanto, la posterior final es: <span class="math inline">p |y \sim Beta (2160,685)</span>. Los estimadores puntuales y por intervalos son:</p>
<p><span class="math display">\hat p = E[p | y] = \frac{2160}{2160+685} \approx 0.759,</span> y los intervalos de credibilidad al 90% :</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a>IC <span class="ot">=</span> <span class="fu">quantile</span>(<span class="fu">rbeta</span>(<span class="dv">600</span>,<span class="dv">2160</span>,<span class="dv">685</span>),<span class="at">probs =</span> <span class="fu">c</span>(<span class="fl">0.05</span>,<span class="fl">0.95</span>))</span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a>IC</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>       5%       95% 
0.7465970 0.7713715 </code></pre>
</div>
</div>
<p>Los dos valores anteriores no brindan información del fenómeno de estudio, para una mejor interpretador, calculamos el número de insectos esperado a posterior, esto es, el valor esperado de la función de probabilidad que modela los datos, calculado con el estimador puntual obtenido</p>
<p><span class="math display">E[y|p = \hat p] = \frac{r(1-\hat p)}{\hat p} \approx 10.</span> El número esperado de insectos con el modelo Binomial negativa es de 10 insectos, que es mayor al obtenido por el modelo <span class="math inline">M_1</span> cuyo valor esperado fue de 9.16 insectos.</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Código preliminar al gráfico</span></span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a><span class="fu">bayesplot_theme_set</span>(<span class="fu">theme_grey</span>())</span>
<span id="cb10-3"><a href="#cb10-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-4"><a href="#cb10-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Compare distributions</span></span>
<span id="cb10-5"><a href="#cb10-5" aria-hidden="true" tabindex="-1"></a>x <span class="ot">=</span> <span class="fu">c</span>(<span class="fu">rbeta</span>(<span class="dv">600</span>,<span class="dv">1</span>,<span class="dv">1</span>),<span class="fu">rbeta</span>(<span class="dv">600</span>,<span class="dv">2160</span>,<span class="dv">685</span>))</span>
<span id="cb10-6"><a href="#cb10-6" aria-hidden="true" tabindex="-1"></a>y <span class="ot">=</span> <span class="fu">c</span>(<span class="fu">rep</span>(<span class="st">"Prior"</span>,<span class="dv">600</span>),<span class="fu">rep</span>(<span class="st">"Posterior"</span>,<span class="dv">600</span>))</span>
<span id="cb10-7"><a href="#cb10-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-8"><a href="#cb10-8" aria-hidden="true" tabindex="-1"></a>df <span class="ot">=</span> <span class="fu">data.frame</span>(<span class="at">sim =</span> x, <span class="at">dist =</span> y)</span>
<span id="cb10-9"><a href="#cb10-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-10"><a href="#cb10-10" aria-hidden="true" tabindex="-1"></a><span class="co"># posterior predictive checks</span></span>
<span id="cb10-11"><a href="#cb10-11" aria-hidden="true" tabindex="-1"></a>yrep <span class="ot">=</span> <span class="fu">rep</span>(<span class="fu">rnbinom</span>(<span class="dv">600</span>,<span class="at">size =</span> <span class="dv">30</span>,<span class="fu">rbeta</span>(<span class="dv">600</span>,<span class="dv">2160</span>,<span class="dv">685</span>)),<span class="dv">72</span>)</span>
<span id="cb10-12"><a href="#cb10-12" aria-hidden="true" tabindex="-1"></a>yrep <span class="ot">=</span> <span class="fu">matrix</span>(yrep,<span class="at">ncol =</span> <span class="dv">72</span>,<span class="at">byrow =</span> <span class="cn">TRUE</span>)</span>
<span id="cb10-13"><a href="#cb10-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-14"><a href="#cb10-14" aria-hidden="true" tabindex="-1"></a>y <span class="ot">=</span> InsectSprays<span class="sc">$</span>count</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div>
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> sim,<span class="at">fill =</span> dist),<span class="at">data =</span> df)<span class="sc">+</span></span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_density</span>(<span class="at">alpha =</span> <span class="fl">0.4</span>)<span class="sc">+</span></span>
<span id="cb11-3"><a href="#cb11-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"Comparación Prior | Posterior"</span>,</span>
<span id="cb11-4"><a href="#cb11-4" aria-hidden="true" tabindex="-1"></a>       <span class="at">subtitle =</span> <span class="st">"Modelo Binomial-Negativa dispersa"</span>,</span>
<span id="cb11-5"><a href="#cb11-5" aria-hidden="true" tabindex="-1"></a>       <span class="at">x =</span> <span class="st">"Simulaciones"</span>,<span class="at">y =</span> <span class="st">"densidades"</span>)</span>
<span id="cb11-6"><a href="#cb11-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-7"><a href="#cb11-7" aria-hidden="true" tabindex="-1"></a><span class="fu">ppc_dens_overlay</span>(y, yrep[<span class="dv">1</span><span class="sc">:</span><span class="dv">200</span>,])<span class="sc">+</span></span>
<span id="cb11-8"><a href="#cb11-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"Posterior Predictive Checks"</span>,</span>
<span id="cb11-9"><a href="#cb11-9" aria-hidden="true" tabindex="-1"></a>       <span class="at">subtitle =</span> <span class="st">"Modelo Binomial Negativa dispersa"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div id="fig-reslt2" class="cell quarto-layout-panel">
<figure class="figure">
<div class="quarto-layout-row quarto-layout-valign-top">
<div class="cell-output-display quarto-layout-cell quarto-layout-cell-subref" style="flex-basis: 50.0%;justify-content: center;">
<div id="fig-reslt2-1" class="quarto-figure quarto-figure-center anchored">
<figure class="figure">
<p><img src="index_files/figure-html/fig-reslt2-1.png" class="img-fluid figure-img" data-ref-parent="fig-reslt2" width="672"></p>
<p></p><figcaption class="figure-caption">(a) Comparamos la densidades a Priori | Posteriori y obtenemos una posterior muy especifica pese lo dispersa que es la prior.”</figcaption><p></p>
</figure>
</div>
</div>
<div class="cell-output-display quarto-layout-cell quarto-layout-cell-subref" style="flex-basis: 50.0%;justify-content: center;">
<div id="fig-reslt2-2" class="quarto-figure quarto-figure-center anchored">
<figure class="figure">
<p><img src="index_files/figure-html/fig-reslt2-2.png" class="img-fluid figure-img" data-ref-parent="fig-reslt2" width="672"></p>
<p></p><figcaption class="figure-caption">(b) La densidad predictiva del modelo muestra el mal ajuste a los datos, el modelo no captura la dispersion y asimetría de la muestra.”</figcaption><p></p>
</figure>
</div>
</div>
</div>
<p></p><figcaption class="figure-caption">Figure&nbsp;5: Comparación de la posterior vs prior y análisis del ajuste del modelo mediante la densidad predictiva, modelo Binomial negativa.</figcaption><p></p>
</figure>
</div>
</div>
<p><a href="#fig-reslt2">Figure&nbsp;5</a> muestra la comparación de las densidades prior y posterior para el modelo Binomial negativa, pese la sobre-dispersión de la prior, se obtiene una posterior muy informativa y especifica. El gráfico derecho compara las predictivas obtenidas, notamos que la función predictiva esta muy centrada en el valor esperado de los datos, y provee un ajuste muy pobre.</p>
</section>
<section id="modelo-m_3-de-poisson-con-prior-débil" class="level2">
<h2 class="anchored" data-anchor-id="modelo-m_3-de-poisson-con-prior-débil">Modelo <span class="math inline">M_3</span> de Poisson con prior débil</h2>
<p>Se define el número de insectos encontrado como una variable aleatoria discreta de tipo Poisson con parámetro <span class="math inline">\lambda</span> desconocido (<span class="math inline">y_i \sim Poisson(\lambda)</span>) y aleatorio, la prior para <span class="math inline">\lambda</span> es</p>
<p><span class="math display">\lambda \sim N(8,1).</span> En este caso la prior es no conjugada y se debe realizar el <code>algoritmo de Metrópolis</code>, <span class="citation" data-cites="metropolis1953">Metropolis et al. (<a href="#ref-metropolis1953" role="doc-biblioref">1953</a>)</span>. El siguiente código muestra la implementación del algoritmo para nuestro modelo, la primera función calcula la densidad propuesta que es simplemente el producto de le verosimilitud y la prior, (<span class="math inline">f_p(\theta) = f(y|\theta)f(\theta)</span>). La segunda función es del algoritmo mismo.</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a>post <span class="ot">=</span> <span class="cf">function</span>(y,lambda,mu,sigma){</span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a>  prior <span class="ot">=</span> <span class="fu">dnorm</span>(lambda,<span class="at">mean =</span> mu,<span class="at">sd =</span> sigma)</span>
<span id="cb12-3"><a href="#cb12-3" aria-hidden="true" tabindex="-1"></a>  like <span class="ot">=</span> <span class="fu">prod</span>(<span class="fu">dpois</span>(<span class="at">x =</span> y,<span class="at">lambda =</span> lambda))</span>
<span id="cb12-4"><a href="#cb12-4" aria-hidden="true" tabindex="-1"></a>  post <span class="ot">=</span> like<span class="sc">*</span>prior</span>
<span id="cb12-5"><a href="#cb12-5" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb12-6"><a href="#cb12-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(post)</span>
<span id="cb12-7"><a href="#cb12-7" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb12-8"><a href="#cb12-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-9"><a href="#cb12-9" aria-hidden="true" tabindex="-1"></a>metropolis <span class="ot">=</span> <span class="cf">function</span>(y, mu, <span class="at">sigma =</span> <span class="dv">1</span>,<span class="at">iter =</span> <span class="dv">5000</span>,<span class="at">inits =</span> <span class="fu">rnorm</span>(<span class="dv">1</span>, <span class="dv">5</span>,<span class="dv">1</span>)){</span>
<span id="cb12-10"><a href="#cb12-10" aria-hidden="true" tabindex="-1"></a>  lbd <span class="ot">=</span> <span class="fu">rep</span>(<span class="dv">0</span>,iter) </span>
<span id="cb12-11"><a href="#cb12-11" aria-hidden="true" tabindex="-1"></a>  lbd[<span class="dv">1</span>] <span class="ot">=</span> inits</span>
<span id="cb12-12"><a href="#cb12-12" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">2</span><span class="sc">:</span>iter) {</span>
<span id="cb12-13"><a href="#cb12-13" aria-hidden="true" tabindex="-1"></a>    temp <span class="ot">=</span> <span class="fu">rnorm</span>(<span class="dv">1</span>,<span class="at">mean =</span> lbd[i<span class="dv">-1</span>])</span>
<span id="cb12-14"><a href="#cb12-14" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb12-15"><a href="#cb12-15" aria-hidden="true" tabindex="-1"></a>    p1 <span class="ot">=</span> <span class="fu">post</span>(y,<span class="at">lambda =</span> temp,<span class="at">mu =</span> mu,<span class="at">sigma =</span> sigma)</span>
<span id="cb12-16"><a href="#cb12-16" aria-hidden="true" tabindex="-1"></a>    p2 <span class="ot">=</span> <span class="fu">post</span>(y,<span class="at">lambda =</span> lbd[i<span class="dv">-1</span>],<span class="at">mu =</span> mu,<span class="at">sigma =</span> sigma)</span>
<span id="cb12-17"><a href="#cb12-17" aria-hidden="true" tabindex="-1"></a>    pa <span class="ot">=</span> p1<span class="sc">/</span>p2</span>
<span id="cb12-18"><a href="#cb12-18" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb12-19"><a href="#cb12-19" aria-hidden="true" tabindex="-1"></a>    lbd[i] <span class="ot">=</span> lbd[i<span class="dv">-1</span>]</span>
<span id="cb12-20"><a href="#cb12-20" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb12-21"><a href="#cb12-21" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span>(pa <span class="sc">&gt;</span> <span class="fu">runif</span>(<span class="dv">1</span>))</span>
<span id="cb12-22"><a href="#cb12-22" aria-hidden="true" tabindex="-1"></a>      lbd[i] <span class="ot">=</span> temp</span>
<span id="cb12-23"><a href="#cb12-23" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb12-24"><a href="#cb12-24" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb12-25"><a href="#cb12-25" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(lbd)</span>
<span id="cb12-26"><a href="#cb12-26" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>Para este ejemplo simulamos dos cadenas independientes de 5,000 iteraciones, donde el valor inicial de cada cadena se simuló de una normal con media cinco y varianza uno.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb13"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a>lambda1 <span class="ot">=</span> <span class="fu">metropolis</span>(<span class="at">y =</span> InsectSprays<span class="sc">$</span>count,<span class="at">mu =</span> <span class="dv">8</span>)</span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true" tabindex="-1"></a>lambda2 <span class="ot">=</span> <span class="fu">metropolis</span>(<span class="at">y =</span> InsectSprays<span class="sc">$</span>count,<span class="at">mu =</span> <span class="dv">8</span>)</span>
<span id="cb13-3"><a href="#cb13-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-4"><a href="#cb13-4" aria-hidden="true" tabindex="-1"></a>df1 <span class="ot">=</span> <span class="fu">data.frame</span>(<span class="at">chain =</span> <span class="fu">sort</span>(<span class="fu">rep</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">2</span>,<span class="dv">4000</span>)),</span>
<span id="cb13-5"><a href="#cb13-5" aria-hidden="true" tabindex="-1"></a>                <span class="at">lambda =</span> <span class="fu">c</span>(lambda1[<span class="dv">1001</span><span class="sc">:</span><span class="dv">5000</span>],lambda2[<span class="dv">1001</span><span class="sc">:</span><span class="dv">5000</span>]))</span>
<span id="cb13-6"><a href="#cb13-6" aria-hidden="true" tabindex="-1"></a>pdf <span class="ot">=</span> posterior<span class="sc">::</span><span class="fu">as_draws</span>(df1)</span>
<span id="cb13-7"><a href="#cb13-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-8"><a href="#cb13-8" aria-hidden="true" tabindex="-1"></a><span class="fu">mcmc_combo</span>(<span class="at">x =</span> df1,<span class="at">pars =</span> <span class="st">"lambda"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div id="fig-chain" class="quarto-figure quarto-figure-center anchored">
<figure class="figure">
<p><img src="index_files/figure-html/fig-chain-1.png" class="img-fluid figure-img" width="672"></p>
<p></p><figcaption class="figure-caption">Figure&nbsp;6: Gráfico de las posterior. Presentamos los traceplot y densidades de la posterior simulada, usando 2 cadenas de 5000 iteraciones y Warm-up: 1000 iteraciones.</figcaption><p></p>
</figure>
</div>
</div>
</div>
<p><a href="#fig-chain">Figure&nbsp;6</a> muestra los trace-plots de ambas cadenas que se entrelazan entre ellas indicando estacionariadad y convergenica, el grafico de densidades es uni modal y simétrico indicando convergencia. <a href="#tbl-post2">Table&nbsp;1</a> muestra las estadísticas resumen de la posterior de <span class="math inline">\lambda</span>, dos indicadores importantes muestran convergencia de las cadenas, el <em>effective sample size</em> (ess) que indica el número de muestras independientes a las que equivalen las muestras obtenidas de la cadenas, dichos valores deben ser similar al número de iteraciones. El factor de convergencia <span class="math inline">\hat R</span> es un valor que compara las varianzas de las cadenas, valores aproximados a 1 indican convergencia.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb14"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a>x <span class="ot">=</span> <span class="fu">summarise_draws</span>(pdf)</span>
<span id="cb14-2"><a href="#cb14-2" aria-hidden="true" tabindex="-1"></a>ft <span class="ot">=</span> <span class="fu">flextable</span>(x[<span class="dv">2</span>,])</span>
<span id="cb14-3"><a href="#cb14-3" aria-hidden="true" tabindex="-1"></a><span class="fu">autofit</span>(ft)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div id="tbl-post2" class="anchored">

<div class="tabwid"><style>.cl-3cc66abc{}.cl-3cc11288{font-family:'Helvetica';font-size:11pt;font-weight:normal;font-style:normal;text-decoration:none;color:rgba(0, 0, 0, 1.00);background-color:transparent;}.cl-3cc35688{margin:0;text-align:left;border-bottom: 0 solid rgba(0, 0, 0, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);padding-bottom:5pt;padding-top:5pt;padding-left:5pt;padding-right:5pt;line-height: 1;background-color:transparent;}.cl-3cc35692{margin:0;text-align:right;border-bottom: 0 solid rgba(0, 0, 0, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);padding-bottom:5pt;padding-top:5pt;padding-left:5pt;padding-right:5pt;line-height: 1;background-color:transparent;}.cl-3cc36588{width:0.82in;background-color:transparent;vertical-align: middle;border-bottom: 2pt solid rgba(102, 102, 102, 1.00);border-top: 2pt solid rgba(102, 102, 102, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-3cc36592{width:0.922in;background-color:transparent;vertical-align: middle;border-bottom: 2pt solid rgba(102, 102, 102, 1.00);border-top: 2pt solid rgba(102, 102, 102, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-3cc36593{width:1.007in;background-color:transparent;vertical-align: middle;border-bottom: 2pt solid rgba(102, 102, 102, 1.00);border-top: 2pt solid rgba(102, 102, 102, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-3cc36594{width:0.837in;background-color:transparent;vertical-align: middle;border-bottom: 2pt solid rgba(102, 102, 102, 1.00);border-top: 2pt solid rgba(102, 102, 102, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-3cc3659c{width:0.965in;background-color:transparent;vertical-align: middle;border-bottom: 2pt solid rgba(102, 102, 102, 1.00);border-top: 2pt solid rgba(102, 102, 102, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-3cc3659d{width:0.88in;background-color:transparent;vertical-align: middle;border-bottom: 2pt solid rgba(102, 102, 102, 1.00);border-top: 2pt solid rgba(102, 102, 102, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-3cc365a6{width:0.82in;background-color:transparent;vertical-align: middle;border-bottom: 2pt solid rgba(102, 102, 102, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-3cc365a7{width:0.922in;background-color:transparent;vertical-align: middle;border-bottom: 2pt solid rgba(102, 102, 102, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-3cc365a8{width:1.007in;background-color:transparent;vertical-align: middle;border-bottom: 2pt solid rgba(102, 102, 102, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-3cc365b0{width:0.837in;background-color:transparent;vertical-align: middle;border-bottom: 2pt solid rgba(102, 102, 102, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-3cc365b1{width:0.965in;background-color:transparent;vertical-align: middle;border-bottom: 2pt solid rgba(102, 102, 102, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-3cc365ba{width:0.88in;background-color:transparent;vertical-align: middle;border-bottom: 2pt solid rgba(102, 102, 102, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}</style><table class="cl-3cc66abc"><caption>Table&nbsp;1:  Criterios de información de los modelos. Mediante Validación cruzada. La tabla presenta los criterios AIC, RMSE, MAE y MAPE bajo un 10-fold cv. </caption><thead><tr style="overflow-wrap:break-word;"><td class="cl-3cc36588"><p class="cl-3cc35688"><span class="cl-3cc11288">variable</span></p></td><td class="cl-3cc36592"><p class="cl-3cc35692"><span class="cl-3cc11288">mean</span></p></td><td class="cl-3cc36592"><p class="cl-3cc35692"><span class="cl-3cc11288">median</span></p></td><td class="cl-3cc36593"><p class="cl-3cc35692"><span class="cl-3cc11288">sd</span></p></td><td class="cl-3cc36593"><p class="cl-3cc35692"><span class="cl-3cc11288">mad</span></p></td><td class="cl-3cc36592"><p class="cl-3cc35692"><span class="cl-3cc11288">q5</span></p></td><td class="cl-3cc36594"><p class="cl-3cc35692"><span class="cl-3cc11288">q95</span></p></td><td class="cl-3cc36592"><p class="cl-3cc35692"><span class="cl-3cc11288">rhat</span></p></td><td class="cl-3cc3659c"><p class="cl-3cc35692"><span class="cl-3cc11288">ess_bulk</span></p></td><td class="cl-3cc3659d"><p class="cl-3cc35692"><span class="cl-3cc11288">ess_tail</span></p></td></tr></thead><tbody><tr style="overflow-wrap:break-word;"><td class="cl-3cc365a6"><p class="cl-3cc35688"><span class="cl-3cc11288">lambda</span></p></td><td class="cl-3cc365a7"><p class="cl-3cc35692"><span class="cl-3cc11288">9.341607</span></p></td><td class="cl-3cc365a7"><p class="cl-3cc35692"><span class="cl-3cc11288">9.332651</span></p></td><td class="cl-3cc365a8"><p class="cl-3cc35692"><span class="cl-3cc11288">0.3359167</span></p></td><td class="cl-3cc365a8"><p class="cl-3cc35692"><span class="cl-3cc11288">0.3318626</span></p></td><td class="cl-3cc365a7"><p class="cl-3cc35692"><span class="cl-3cc11288">8.798246</span></p></td><td class="cl-3cc365b0"><p class="cl-3cc35692"><span class="cl-3cc11288">9.88604</span></p></td><td class="cl-3cc365a7"><p class="cl-3cc35692"><span class="cl-3cc11288">1.000066</span></p></td><td class="cl-3cc365b1"><p class="cl-3cc35692"><span class="cl-3cc11288">1,555.832</span></p></td><td class="cl-3cc365ba"><p class="cl-3cc35692"><span class="cl-3cc11288">1,831.55</span></p></td></tr></tbody></table></div>
</div>
</div>
</div>
<p><a href="#tbl-post2">Table&nbsp;1</a> muestra la media a posterior e intervalos de credibilidad para la posterior de <span class="math inline">\lambda</span>. Además, se muestra el error de <code>Monte-Carlo</code>, dicho error debe ser cercano a 0, valores muy grandes indican alta dispersión de las simulaciones que se interpreta como una mala aproximación del método.</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb15"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Preliminar</span></span>
<span id="cb15-2"><a href="#cb15-2" aria-hidden="true" tabindex="-1"></a><span class="fu">bayesplot_theme_set</span>(<span class="fu">theme_grey</span>())</span>
<span id="cb15-3"><a href="#cb15-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-4"><a href="#cb15-4" aria-hidden="true" tabindex="-1"></a>x <span class="ot">=</span> <span class="fu">c</span>(<span class="fu">rnorm</span>(<span class="dv">600</span>,<span class="dv">8</span>,<span class="dv">1</span>),pdf<span class="sc">$</span>lambda[<span class="dv">1001</span><span class="sc">:</span><span class="dv">1600</span>])</span>
<span id="cb15-5"><a href="#cb15-5" aria-hidden="true" tabindex="-1"></a>y <span class="ot">=</span> <span class="fu">c</span>(<span class="fu">rep</span>(<span class="st">"Prior"</span>,<span class="dv">600</span>),<span class="fu">rep</span>(<span class="st">"Posterior"</span>,<span class="dv">600</span>))</span>
<span id="cb15-6"><a href="#cb15-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-7"><a href="#cb15-7" aria-hidden="true" tabindex="-1"></a>df <span class="ot">=</span> <span class="fu">data.frame</span>(<span class="at">sim =</span> x, <span class="at">dist =</span> y)</span>
<span id="cb15-8"><a href="#cb15-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-9"><a href="#cb15-9" aria-hidden="true" tabindex="-1"></a><span class="co"># Predictive</span></span>
<span id="cb15-10"><a href="#cb15-10" aria-hidden="true" tabindex="-1"></a>yrep <span class="ot">=</span> <span class="fu">rep</span>(<span class="fu">rpois</span>(<span class="dv">600</span>,pdf<span class="sc">$</span>lambda[<span class="dv">1001</span><span class="sc">:</span><span class="dv">1600</span>]),<span class="dv">72</span>)</span>
<span id="cb15-11"><a href="#cb15-11" aria-hidden="true" tabindex="-1"></a>yrep <span class="ot">=</span> <span class="fu">matrix</span>(yrep,<span class="at">ncol =</span> <span class="dv">72</span>,<span class="at">byrow =</span> <span class="cn">TRUE</span>)</span>
<span id="cb15-12"><a href="#cb15-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-13"><a href="#cb15-13" aria-hidden="true" tabindex="-1"></a>y <span class="ot">=</span> InsectSprays<span class="sc">$</span>count</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div>
<div class="sourceCode cell-code" id="cb16"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> sim,<span class="at">fill =</span> dist),<span class="at">data =</span> df)<span class="sc">+</span></span>
<span id="cb16-2"><a href="#cb16-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_density</span>(<span class="at">alpha =</span> <span class="fl">0.4</span>)<span class="sc">+</span></span>
<span id="cb16-3"><a href="#cb16-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"Comparación Prior | Posterior"</span>,</span>
<span id="cb16-4"><a href="#cb16-4" aria-hidden="true" tabindex="-1"></a>       <span class="at">subtitle =</span> <span class="st">"Modelo Poisson con prior normal"</span>,</span>
<span id="cb16-5"><a href="#cb16-5" aria-hidden="true" tabindex="-1"></a>       <span class="at">x =</span> <span class="st">"Simulaciones"</span>,<span class="at">y =</span> <span class="st">"densidades"</span>)</span>
<span id="cb16-6"><a href="#cb16-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-7"><a href="#cb16-7" aria-hidden="true" tabindex="-1"></a><span class="fu">ppc_dens_overlay</span>(y, yrep[<span class="dv">1</span><span class="sc">:</span><span class="dv">200</span>,])<span class="sc">+</span></span>
<span id="cb16-8"><a href="#cb16-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"Posterior Predictive Checks"</span>,</span>
<span id="cb16-9"><a href="#cb16-9" aria-hidden="true" tabindex="-1"></a>       <span class="at">subtitle =</span> <span class="st">"Modelo Poisson con Prior débil"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div id="fig-reslt3" class="cell quarto-layout-panel">
<figure class="figure">
<div class="quarto-layout-row quarto-layout-valign-top">
<div class="cell-output-display quarto-layout-cell quarto-layout-cell-subref" style="flex-basis: 50.0%;justify-content: center;">
<div id="fig-reslt3-1" class="quarto-figure quarto-figure-center anchored">
<figure class="figure">
<p><img src="index_files/figure-html/fig-reslt3-1.png" class="img-fluid figure-img" data-ref-parent="fig-reslt3" width="672"></p>
<p></p><figcaption class="figure-caption">(a) Comparamos la densidades a Priori | Posteriori y obtenemos una posterior muy especifica pese lo dispersa que es la prior.”</figcaption><p></p>
</figure>
</div>
</div>
<div class="cell-output-display quarto-layout-cell quarto-layout-cell-subref" style="flex-basis: 50.0%;justify-content: center;">
<div id="fig-reslt3-2" class="quarto-figure quarto-figure-center anchored">
<figure class="figure">
<p><img src="index_files/figure-html/fig-reslt3-2.png" class="img-fluid figure-img" data-ref-parent="fig-reslt3" width="672"></p>
<p></p><figcaption class="figure-caption">(b) La densidad predictiva del modelo muestra el mal ajuste a los datos, el modelo no captura la dispersion y asimetría de la muestra.”</figcaption><p></p>
</figure>
</div>
</div>
</div>
<p></p><figcaption class="figure-caption">Figure&nbsp;7: Comparación de la posterior vs prior y análisis del ajuste del modelo mediante la densidad predictiva, modelo de Poisson con prior no conjugada.</figcaption><p></p>
</figure>
</div>
</div>
<p><a href="#fig-reslt3">Figure&nbsp;7</a> muestra la comparación de las densidades prior y posterior para el modelo Poisson, la dinámica entre la prior y posterior es mas natural, pero la influencia de los datos hace que la prior sea de leve influencia en la posterior. El gráfico derecho compara las predictivas obtenidas, notamos que la función predictiva está muy centrada en el valor esperado de los datos, y provee un ajuste muy pobre.</p>
<section id="selección-de-modelos" class="level3">
<h3 class="anchored" data-anchor-id="selección-de-modelos">Selección de Modelos</h3>
<p>Para seleccionar el mejor modelo de los tres, utilizaremos los cuatro criterios definidos, Factor de Bayes, log-likelihood elpd, y WAIC.</p>
<section id="factores-de-bayes" class="level4">
<h4 class="anchored" data-anchor-id="factores-de-bayes">Factores de Bayes</h4>
<p>El código para calcular la densidad marginal de cada modelo es:</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb17"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a>Marginal1 <span class="ot">=</span> <span class="cf">function</span>(y,<span class="at">iter =</span> <span class="dv">10000</span>){</span>
<span id="cb17-2"><a href="#cb17-2" aria-hidden="true" tabindex="-1"></a>  mar <span class="ot">=</span> <span class="dv">1</span><span class="sc">:</span>iter</span>
<span id="cb17-3"><a href="#cb17-3" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb17-4"><a href="#cb17-4" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>iter) {</span>
<span id="cb17-5"><a href="#cb17-5" aria-hidden="true" tabindex="-1"></a>    mar[i] <span class="ot">=</span> <span class="fu">sum</span>(<span class="fu">dpois</span>(<span class="at">x =</span> y,<span class="at">lambda =</span> <span class="fu">rgamma</span>(<span class="at">n =</span> <span class="dv">1</span>,<span class="at">shape =</span> <span class="dv">3</span>,<span class="dv">3</span>),<span class="at">log =</span> <span class="cn">TRUE</span>))</span>
<span id="cb17-6"><a href="#cb17-6" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb17-7"><a href="#cb17-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(<span class="fu">mean</span>( <span class="fu">exp</span>(mar) ))</span>
<span id="cb17-8"><a href="#cb17-8" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb17-9"><a href="#cb17-9" aria-hidden="true" tabindex="-1"></a>Marginal2 <span class="ot">=</span> <span class="cf">function</span>(y,<span class="at">iter =</span> <span class="dv">10000</span>){</span>
<span id="cb17-10"><a href="#cb17-10" aria-hidden="true" tabindex="-1"></a>  mar <span class="ot">=</span> <span class="dv">1</span><span class="sc">:</span>iter</span>
<span id="cb17-11"><a href="#cb17-11" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb17-12"><a href="#cb17-12" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>iter) {</span>
<span id="cb17-13"><a href="#cb17-13" aria-hidden="true" tabindex="-1"></a>    mar[i] <span class="ot">=</span> <span class="fu">sum</span>(<span class="fu">dnbinom</span>(<span class="at">x =</span> y,<span class="at">prob =</span> <span class="fu">rbeta</span>(<span class="dv">1</span>,<span class="dv">1</span>,<span class="dv">1</span>),<span class="at">size =</span> <span class="dv">30</span>,<span class="at">log =</span> <span class="cn">TRUE</span>))</span>
<span id="cb17-14"><a href="#cb17-14" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb17-15"><a href="#cb17-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(<span class="fu">mean</span>( <span class="fu">exp</span>(mar) ))</span>
<span id="cb17-16"><a href="#cb17-16" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb17-17"><a href="#cb17-17" aria-hidden="true" tabindex="-1"></a>Marginal3 <span class="ot">=</span> <span class="cf">function</span>(y,<span class="at">iter =</span> <span class="dv">10000</span>){</span>
<span id="cb17-18"><a href="#cb17-18" aria-hidden="true" tabindex="-1"></a>  mar <span class="ot">=</span> <span class="dv">1</span><span class="sc">:</span>iter</span>
<span id="cb17-19"><a href="#cb17-19" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb17-20"><a href="#cb17-20" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>iter) {</span>
<span id="cb17-21"><a href="#cb17-21" aria-hidden="true" tabindex="-1"></a>    mar[i] <span class="ot">=</span> <span class="fu">sum</span>(<span class="fu">dpois</span>(<span class="at">x =</span> y,<span class="at">lambda =</span> <span class="fu">rnorm</span>(<span class="at">n =</span> <span class="dv">1</span>,<span class="at">mean =</span> <span class="dv">8</span>,<span class="at">sd =</span> <span class="dv">1</span>),<span class="at">log =</span> <span class="cn">TRUE</span>))</span>
<span id="cb17-22"><a href="#cb17-22" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb17-23"><a href="#cb17-23" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(<span class="fu">mean</span>( <span class="fu">exp</span>(mar) ))</span>
<span id="cb17-24"><a href="#cb17-24" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>Las estimaciones de Monte-Carlo, con <span class="math inline">m = 50,000</span> iteraciones para cada modelo son:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb18"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a>m1 <span class="ot">=</span> <span class="fu">Marginal1</span>(<span class="at">y =</span> InsectSprays<span class="sc">$</span>count,<span class="at">iter =</span> <span class="dv">50000</span>)</span>
<span id="cb18-2"><a href="#cb18-2" aria-hidden="true" tabindex="-1"></a>m2 <span class="ot">=</span> <span class="fu">Marginal2</span>(<span class="at">y =</span> InsectSprays<span class="sc">$</span>count,<span class="at">iter =</span> <span class="dv">50000</span>)</span>
<span id="cb18-3"><a href="#cb18-3" aria-hidden="true" tabindex="-1"></a>m3 <span class="ot">=</span> <span class="fu">Marginal1</span>(<span class="at">y =</span> InsectSprays<span class="sc">$</span>count,<span class="at">iter =</span> <span class="dv">50000</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Los factores de Bayes para comparar los 3 modelos son:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb19"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a>FB <span class="ot">=</span> <span class="fu">log</span>(<span class="fu">c</span>(m1<span class="sc">/</span>m2,m1<span class="sc">/</span>m3,m2<span class="sc">/</span>m3))</span>
<span id="cb19-2"><a href="#cb19-2" aria-hidden="true" tabindex="-1"></a><span class="fu">names</span>(FB) <span class="ot">=</span><span class="fu">c</span>(<span class="st">"log FB12"</span>,<span class="st">"log FB13"</span>,<span class="st">"log FB23"</span>) </span>
<span id="cb19-3"><a href="#cb19-3" aria-hidden="true" tabindex="-1"></a>FB</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>  log FB12   log FB13   log FB23 
-156.14747  -34.27028  121.87719 </code></pre>
</div>
</div>
<p>Las estimaciones obtenidas muestran una evidencia rotunda a preferir el modelo <span class="math inline">M_2</span> sobre el modelo <span class="math inline">M_1</span> y una evidencia fuerte de preferir el modelo <span class="math inline">M_1</span> sobre el modelo <span class="math inline">M_3</span>. Finalmente, hay evidencia rotunda a predecir el modelo <span class="math inline">M_2</span> sobre el modelo <span class="math inline">M_3</span>.</p>
<p>Por lo tanto, el modelo selecionado es: <span class="math inline">M_2:</span> Binomial negativa, con prior dispersa.</p>
<p>El mayor problema de los factores de Bayes son:</p>
<ul>
<li><p>Los modelos son inestables</p></li>
<li><p>El modelo es muy sensible a modelos priors no informativas o muy dispersas.</p></li>
</ul>
</section>
<section id="log-verosimilitud" class="level4">
<h4 class="anchored" data-anchor-id="log-verosimilitud">log-Verosimilitud</h4>
<p>Un estimador muy importante para la selección de modelos es la matriz de log-verosimilitudes, esta se estima por métodos de Monte-Carlo usando una muestra de la posterior <span class="math inline">\theta_1,\theta_2,\ldots,\theta_S</span>, de la siguiente forma</p>
<p><span class="math display">\log f(y|\theta) = [\log f(y_i|\theta_j)] \in \mathbb R^{S \times n}</span> Las siguientes lineas de código generan la matriz de verosimilitudes</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb21"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a>loglik1 <span class="ot">=</span> <span class="cf">function</span>(y,<span class="at">iter =</span> <span class="dv">10000</span>){</span>
<span id="cb21-2"><a href="#cb21-2" aria-hidden="true" tabindex="-1"></a>  loglik  <span class="ot">=</span> <span class="fu">matrix</span>(<span class="at">nrow =</span> iter, <span class="at">ncol =</span> <span class="fu">length</span>(y))</span>
<span id="cb21-3"><a href="#cb21-3" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb21-4"><a href="#cb21-4" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>iter)  </span>
<span id="cb21-5"><a href="#cb21-5" aria-hidden="true" tabindex="-1"></a>    loglik[i, ] <span class="ot">=</span> <span class="fu">dpois</span>(y,<span class="at">lambda =</span> <span class="fu">rgamma</span>(<span class="dv">1</span>,<span class="dv">687</span>,<span class="dv">75</span>),<span class="at">log =</span> <span class="cn">TRUE</span>)</span>
<span id="cb21-6"><a href="#cb21-6" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb21-7"><a href="#cb21-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(loglik)</span>
<span id="cb21-8"><a href="#cb21-8" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb21-9"><a href="#cb21-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-10"><a href="#cb21-10" aria-hidden="true" tabindex="-1"></a>loglik2 <span class="ot">=</span> <span class="cf">function</span>(y,<span class="at">iter =</span> <span class="dv">10000</span>){</span>
<span id="cb21-11"><a href="#cb21-11" aria-hidden="true" tabindex="-1"></a>  loglik  <span class="ot">=</span> <span class="fu">matrix</span>(<span class="at">nrow =</span> iter, <span class="at">ncol =</span> <span class="fu">length</span>(y))</span>
<span id="cb21-12"><a href="#cb21-12" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb21-13"><a href="#cb21-13" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>iter)  </span>
<span id="cb21-14"><a href="#cb21-14" aria-hidden="true" tabindex="-1"></a>    loglik[i, ] <span class="ot">=</span> <span class="fu">dnbinom</span>(y,<span class="at">size =</span> <span class="dv">30</span>,<span class="at">prob =</span> <span class="fu">rbeta</span>(<span class="dv">1</span>,<span class="dv">2160</span>,<span class="dv">685</span>),<span class="at">log =</span> <span class="cn">TRUE</span>)</span>
<span id="cb21-15"><a href="#cb21-15" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb21-16"><a href="#cb21-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(loglik)</span>
<span id="cb21-17"><a href="#cb21-17" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb21-18"><a href="#cb21-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-19"><a href="#cb21-19" aria-hidden="true" tabindex="-1"></a>loglik3 <span class="ot">=</span> <span class="cf">function</span>(y,lbd){</span>
<span id="cb21-20"><a href="#cb21-20" aria-hidden="true" tabindex="-1"></a>  loglik  <span class="ot">=</span> <span class="fu">matrix</span>(<span class="at">nrow =</span> <span class="fu">length</span>(lbd), <span class="at">ncol =</span> <span class="fu">length</span>(y))</span>
<span id="cb21-21"><a href="#cb21-21" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb21-22"><a href="#cb21-22" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">length</span>(lbd))  </span>
<span id="cb21-23"><a href="#cb21-23" aria-hidden="true" tabindex="-1"></a>    loglik[i, ] <span class="ot">=</span> <span class="fu">dpois</span>(y,<span class="at">lambda =</span> lbd[i],<span class="at">log =</span> <span class="cn">TRUE</span>)</span>
<span id="cb21-24"><a href="#cb21-24" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb21-25"><a href="#cb21-25" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(loglik)</span>
<span id="cb21-26"><a href="#cb21-26" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>A partir de las matrices de log-verosimilitudes se puede estimar una muestra a posteriori de la log-verosimilitud del modelo a partir de la siguiente ecuación</p>
<p><span class="math display">\log f(y| \theta) = -\sum_{i=1}^n \log f(y_i | \theta).</span> Estos valores pueden utilizarse para comparación preliminar de modelos, pero como una medida absoluta, la siguiente figura muestra las posteriors de las log verosimilitudes:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb22"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a>ll1 <span class="ot">=</span> <span class="fu">loglik1</span>(<span class="at">y =</span> InsectSprays<span class="sc">$</span>count,<span class="at">iter =</span> <span class="dv">8000</span>)</span>
<span id="cb22-2"><a href="#cb22-2" aria-hidden="true" tabindex="-1"></a>ll2 <span class="ot">=</span> <span class="fu">loglik2</span>(<span class="at">y =</span> InsectSprays<span class="sc">$</span>count,<span class="at">iter =</span> <span class="dv">8000</span>)</span>
<span id="cb22-3"><a href="#cb22-3" aria-hidden="true" tabindex="-1"></a>ll3 <span class="ot">=</span> <span class="fu">loglik3</span>(<span class="at">y =</span> InsectSprays<span class="sc">$</span>count,<span class="at">lbd =</span> df1<span class="sc">$</span>lambda)</span>
<span id="cb22-4"><a href="#cb22-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-5"><a href="#cb22-5" aria-hidden="true" tabindex="-1"></a>logVero <span class="ot">=</span> <span class="fu">data.frame</span>(</span>
<span id="cb22-6"><a href="#cb22-6" aria-hidden="true" tabindex="-1"></a>      <span class="at">loglik =</span> <span class="fu">c</span>(<span class="fu">apply</span>(<span class="sc">-</span>ll1,<span class="dv">1</span>,sum),<span class="fu">apply</span>(<span class="sc">-</span>ll2,<span class="dv">1</span>,sum),<span class="fu">apply</span>(<span class="sc">-</span>ll3,<span class="dv">1</span>,sum)),</span>
<span id="cb22-7"><a href="#cb22-7" aria-hidden="true" tabindex="-1"></a>      <span class="at">models =</span> <span class="fu">c</span>(<span class="fu">rep</span>(<span class="st">"M1"</span>,<span class="dv">8000</span>),<span class="fu">rep</span>(<span class="st">"M2"</span>,<span class="dv">8000</span>),<span class="fu">rep</span>(<span class="st">"M3"</span>,<span class="dv">8000</span>))</span>
<span id="cb22-8"><a href="#cb22-8" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb22-9"><a href="#cb22-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-10"><a href="#cb22-10" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> loglik,<span class="at">fill =</span> models),<span class="at">data =</span> logVero)<span class="sc">+</span></span>
<span id="cb22-11"><a href="#cb22-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_density</span>(<span class="at">alpha =</span> <span class="fl">0.4</span>)<span class="sc">+</span></span>
<span id="cb22-12"><a href="#cb22-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"Comparación de Modelos"</span>,</span>
<span id="cb22-13"><a href="#cb22-13" aria-hidden="true" tabindex="-1"></a>       <span class="at">subtitle =</span> <span class="st">"Log-verosimilitudes"</span>,</span>
<span id="cb22-14"><a href="#cb22-14" aria-hidden="true" tabindex="-1"></a>       <span class="at">x =</span> <span class="st">"Simulaciones"</span>,<span class="at">y =</span> <span class="st">"densidades"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="index_files/figure-html/unnamed-chunk-19-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>Las log-verosimilitudes indican que el modelo <span class="math inline">M_22</span> con verosimilitud Binomial Negativa estima mucho mejor que los dos modelos con verosimilitud de Poisson.</p>
</section>
<section id="expected-log-predictive-density-elpd" class="level4">
<h4 class="anchored" data-anchor-id="expected-log-predictive-density-elpd">Expected log-Predictive density (elpd)</h4>
<p>La elpd es una medida de divergencia entre el modelo ajustado y la distribución real de los datos que se calcula mediante la siguiente ecuación</p>
<p><span class="math display">elpd(M_k|y) = - \int\log f(y^*|y) f_t(y)dy</span> Esta propuesta esta implementada en el paquete <a href="http://mc-stan.org/loo/reference/loo-package.html">loo</a>, y se puede obtener a partir de la matriz log-verosimilitudes.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb23"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(loo)</span>
<span id="cb23-2"><a href="#cb23-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-3"><a href="#cb23-3" aria-hidden="true" tabindex="-1"></a>loo1 <span class="ot">=</span> <span class="fu">loo</span>(ll1)</span>
<span id="cb23-4"><a href="#cb23-4" aria-hidden="true" tabindex="-1"></a>loo2 <span class="ot">=</span> <span class="fu">loo</span>(ll2)</span>
<span id="cb23-5"><a href="#cb23-5" aria-hidden="true" tabindex="-1"></a>loo3 <span class="ot">=</span> <span class="fu">loo</span>(ll3)</span>
<span id="cb23-6"><a href="#cb23-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-7"><a href="#cb23-7" aria-hidden="true" tabindex="-1"></a><span class="fu">compare</span>(loo1,loo2,loo3)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>     elpd_diff se_diff elpd_loo p_loo  looic 
loo2    0.0       0.0  -304.1      4.1  608.2
loo3  -36.5       5.8  -340.6      4.8  681.2
loo1  -37.2       6.5  -341.3      5.3  682.6</code></pre>
</div>
</div>
<p>En este criterio el modelo <span class="math inline">M_2</span> representa el mejor modelo de los datos.</p>
</section>
<section id="criterios-de-información-de-watanabe" class="level4">
<h4 class="anchored" data-anchor-id="criterios-de-información-de-watanabe">Criterios de información de Watanabe</h4>
<p>El criterio de información de Watanabe es asintomático al valor obtenido por la <span class="math inline">elpd</span>, por lo tanto, puede ser aproximado con validación cruzada.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb25"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb25-1"><a href="#cb25-1" aria-hidden="true" tabindex="-1"></a>waic1 <span class="ot">=</span> <span class="fu">waic</span>(ll1)</span>
<span id="cb25-2"><a href="#cb25-2" aria-hidden="true" tabindex="-1"></a>waic2 <span class="ot">=</span> <span class="fu">waic</span>(ll2)</span>
<span id="cb25-3"><a href="#cb25-3" aria-hidden="true" tabindex="-1"></a>waic3 <span class="ot">=</span> <span class="fu">waic</span>(ll3)</span>
<span id="cb25-4"><a href="#cb25-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-5"><a href="#cb25-5" aria-hidden="true" tabindex="-1"></a><span class="fu">compare</span>(waic1,waic2,waic3)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>      elpd_diff se_diff elpd_waic p_waic waic  
waic2    0.0       0.0  -304.1       4.1  608.2
waic3  -36.5       5.8  -340.6       4.8  681.2
waic1  -37.2       6.5  -341.3       5.3  682.6</code></pre>
</div>
</div>
<p>Finalmente, elegimos al modelo <span class="math inline">M_2</span> como el mejor modelo que explica el número de insectos al aplicar un pesticida.</p>
</section>
</section>
</section>
<section id="referencias" class="level2">




</section>

<div id="quarto-appendix" class="default"><section class="quarto-appendix-contents" role="doc-bibliography"><h2 class="anchored quarto-appendix-heading">Referencias</h2><div id="refs" class="references csl-bib-body hanging-indent" role="doc-bibliography">
<div id="ref-Casella" class="csl-entry" role="doc-biblioentry">
Casella, George, and Roger Berger. 2001. <em>Statistical Inference</em>. Duxbury Resource Center. <a href="http://www.amazon.fr/exec/obidos/ASIN/0534243126/citeulike04-21">http://www.amazon.fr/exec/obidos/ASIN/0534243126/citeulike04-21</a>.
</div>
<div id="ref-degroot2012" class="csl-entry" role="doc-biblioentry">
DeGroot, M. H., and M. J. Schervish. 2012. <em>Probability and Statistics</em>. Addison-Wesley. <a href="https://books.google.es/books?id=4TlEPgAACAAJ">https://books.google.es/books?id=4TlEPgAACAAJ</a>.
</div>
<div id="ref-gelman2013" class="csl-entry" role="doc-biblioentry">
Gelman, A., J. B. Carlin, H. S. Stern, D. B. Dunson, A. Vehtari, and D. B. Rubin. 2013. <em>Bayesian Data Analysis, Third Edition</em>. Chapman &amp; Hall/CRC Texts in Statistical Science. Taylor &amp; Francis. <a href="https://books.google.nl/books?id=ZXL6AQAAQBAJ">https://books.google.nl/books?id=ZXL6AQAAQBAJ</a>.
</div>
<div id="ref-metropolis1953" class="csl-entry" role="doc-biblioentry">
Metropolis, Nicholas, Arianna W. Rosenbluth, Marshall N. Rosenbluth, Augusta H. Teller, and Edward Teller. 1953. <span>“Equation of State Calculations by Fast Computing Machines.”</span> <em>The Journal of Chemical Physics</em> 21 (6): 1087–92. <a href="https://doi.org/10.1063/1.1699114">https://doi.org/10.1063/1.1699114</a>.
</div>
<div id="ref-Miggon2014" class="csl-entry" role="doc-biblioentry">
Migon, Helio, Dani Gamerman, and Francisco Louzada. 2014. <em>Statistical Inference. An Integrated Approach</em>. Chapman and Hall CRC Texts in Statistical Science. Chapman; Hall.
</div>
<div id="ref-BMLR2021" class="csl-entry" role="doc-biblioentry">
Roback, paul., and Julie. Legler. 2021. <em><span class="nocase">Beyond Multiple Linear Regression: Applied Generalized Linear Models an Multilevel Models in R</span></em>. <span>Boca Raton</span>.
</div>
</div></section></div></main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const disableStylesheet = (stylesheets) => {
    for (let i=0; i < stylesheets.length; i++) {
      const stylesheet = stylesheets[i];
      stylesheet.rel = 'prefetch';
    }
  }
  const enableStylesheet = (stylesheets) => {
    for (let i=0; i < stylesheets.length; i++) {
      const stylesheet = stylesheets[i];
      stylesheet.rel = 'stylesheet';
    }
  }
  const manageTransitions = (selector, allowTransitions) => {
    const els = window.document.querySelectorAll(selector);
    for (let i=0; i < els.length; i++) {
      const el = els[i];
      if (allowTransitions) {
        el.classList.remove('notransition');
      } else {
        el.classList.add('notransition');
      }
    }
  }
  const toggleColorMode = (alternate) => {
    // Switch the stylesheets
    const alternateStylesheets = window.document.querySelectorAll('link.quarto-color-scheme.quarto-color-alternate');
    manageTransitions('#quarto-margin-sidebar .nav-link', false);
    if (alternate) {
      enableStylesheet(alternateStylesheets);
      for (const sheetNode of alternateStylesheets) {
        if (sheetNode.id === "quarto-bootstrap") {
          toggleBodyColorMode(sheetNode);
        }
      }
    } else {
      disableStylesheet(alternateStylesheets);
      toggleBodyColorPrimary();
    }
    manageTransitions('#quarto-margin-sidebar .nav-link', true);
    // Switch the toggles
    const toggles = window.document.querySelectorAll('.quarto-color-scheme-toggle');
    for (let i=0; i < toggles.length; i++) {
      const toggle = toggles[i];
      if (toggle) {
        if (alternate) {
          toggle.classList.add("alternate");     
        } else {
          toggle.classList.remove("alternate");
        }
      }
    }
    // Hack to workaround the fact that safari doesn't
    // properly recolor the scrollbar when toggling (#1455)
    if (navigator.userAgent.indexOf('Safari') > 0 && navigator.userAgent.indexOf('Chrome') == -1) {
      manageTransitions("body", false);
      window.scrollTo(0, 1);
      setTimeout(() => {
        window.scrollTo(0, 0);
        manageTransitions("body", true);
      }, 40);  
    }
  }
  const isFileUrl = () => { 
    return window.location.protocol === 'file:';
  }
  const hasAlternateSentinel = () => {  
    let styleSentinel = getColorSchemeSentinel();
    if (styleSentinel !== null) {
      return styleSentinel === "alternate";
    } else {
      return false;
    }
  }
  const setStyleSentinel = (alternate) => {
    const value = alternate ? "alternate" : "default";
    if (!isFileUrl()) {
      window.localStorage.setItem("quarto-color-scheme", value);
    } else {
      localAlternateSentinel = value;
    }
  }
  const getColorSchemeSentinel = () => {
    if (!isFileUrl()) {
      const storageValue = window.localStorage.getItem("quarto-color-scheme");
      return storageValue != null ? storageValue : localAlternateSentinel;
    } else {
      return localAlternateSentinel;
    }
  }
  let localAlternateSentinel = 'default';
  // Dark / light mode switch
  window.quartoToggleColorScheme = () => {
    // Read the current dark / light value 
    let toAlternate = !hasAlternateSentinel();
    toggleColorMode(toAlternate);
    setStyleSentinel(toAlternate);
  };
  // Ensure there is a toggle, if there isn't float one in the top right
  if (window.document.querySelector('.quarto-color-scheme-toggle') === null) {
    const a = window.document.createElement('a');
    a.classList.add('top-right');
    a.classList.add('quarto-color-scheme-toggle');
    a.href = "";
    a.onclick = function() { try { window.quartoToggleColorScheme(); } catch {} return false; };
    const i = window.document.createElement("i");
    i.classList.add('bi');
    a.appendChild(i);
    window.document.body.appendChild(a);
  }
  // Switch to dark mode if need be
  if (hasAlternateSentinel()) {
    toggleColorMode(true);
  } 
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    target: function(trigger) {
      return trigger.previousElementSibling;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    setTimeout(function() {
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const cites = ref.parentNode.getAttribute('data-cites').split(' ');
    tippyHover(ref, function() {
      var popup = window.document.createElement('div');
      cites.forEach(function(cite) {
        var citeDiv = window.document.createElement('div');
        citeDiv.classList.add('hanging-indent');
        citeDiv.classList.add('csl-entry');
        var biblioDiv = window.document.getElementById('ref-' + cite);
        if (biblioDiv) {
          citeDiv.innerHTML = biblioDiv.innerHTML;
        }
        popup.appendChild(citeDiv);
      });
      return popup.innerHTML;
    });
  }
});
</script>
</div> <!-- /content -->



<script src="../../../site_libs/quarto-html/zenscroll-min.js"></script>
</body></html>