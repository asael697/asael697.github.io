<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.1.179">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="Asael Alonzo Matamoros">
<meta name="dcterms.date" content="2022-11-18">

<title>asael_am - Tratamiento para cucarachas</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1.6em;
  vertical-align: middle;
}
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { color: #008000; } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { color: #008000; font-weight: bold; } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
div.csl-bib-body { }
div.csl-entry {
  clear: both;
}
.hanging div.csl-entry {
  margin-left:2em;
  text-indent:-2em;
}
div.csl-left-margin {
  min-width:2em;
  float:left;
}
div.csl-right-inline {
  margin-left:2em;
  padding-left:1em;
}
div.csl-indent {
  margin-left: 2em;
}
</style>


<script src="../../../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../../../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../../../site_libs/clipboard/clipboard.min.js"></script>
<script src="../../../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../../../site_libs/quarto-search/fuse.min.js"></script>
<script src="../../../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../../../">
<script src="../../../site_libs/quarto-html/quarto.js"></script>
<script src="../../../site_libs/quarto-html/popper.min.js"></script>
<script src="../../../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../../../site_libs/quarto-html/anchor.min.js"></script>
<link href="../../../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../../../site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" class="quarto-color-scheme" id="quarto-text-highlighting-styles">
<link href="../../../site_libs/quarto-html/quarto-syntax-highlighting-dark.css" rel="prefetch" class="quarto-color-scheme quarto-color-alternate" id="quarto-text-highlighting-styles">
<script src="../../../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../../../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../../../site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" class="quarto-color-scheme" id="quarto-bootstrap" data-mode="light">
<link href="../../../site_libs/bootstrap/bootstrap-dark.min.css" rel="prefetch" class="quarto-color-scheme quarto-color-alternate" id="quarto-bootstrap" data-mode="dark">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 20,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit"
  }
}</script>
<style>html{ scroll-behavior: smooth; }</style>
<link href="../../../site_libs/tabwid-1.1.0/tabwid.css" rel="stylesheet">
<link href="../../../site_libs/tabwid-1.1.0/scrool.css" rel="stylesheet">

  <script>window.backupDefine = window.define; window.define = undefined;</script><script src="https://cdn.jsdelivr.net/npm/katex@0.15.1/dist/katex.min.js"></script>
  <script>document.addEventListener("DOMContentLoaded", function () {
 var mathElements = document.getElementsByClassName("math");
 var macros = [];
 for (var i = 0; i < mathElements.length; i++) {
  var texText = mathElements[i].firstChild;
  if (mathElements[i].tagName == "SPAN") {
   katex.render(texText.data, mathElements[i], {
    displayMode: mathElements[i].classList.contains('display'),
    throwOnError: false,
    macros: macros,
    fleqn: false
   });
}}});
  </script>
  <script>window.define = window.backupDefine; window.backupDefine = undefined;</script><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.15.1/dist/katex.min.css">

<link rel="stylesheet" href="../../../styles.css">
</head>

<body class="nav-fixed">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg navbar-dark ">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container">
    <a class="navbar-brand" href="../../../index.html">
    <span class="navbar-title">asael_am</span>
    </a>
  </div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll me-auto">
  <li class="nav-item">
    <a class="nav-link" href="../../../about.html">CV</a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../../ABM/index.html">Applied Bayesian Modeling</a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../../DOF/index.html">Depression and other stories</a>
  </li>  
</ul>
            <ul class="navbar-nav navbar-nav-scroll ms-auto">
  <li class="nav-item compact">
    <a class="nav-link" href="https://twitter.com/Asael_am"><i class="bi bi-twitter" role="img">
</i> 
 </a>
  </li>  
  <li class="nav-item compact">
    <a class="nav-link" href="https://github.com/asael697"><i class="bi bi-github" role="img">
</i> 
 </a>
  </li>  
  <li class="nav-item compact">
    <a class="nav-link" href="https://www.linkedin.com/in/asael-alonzo-matamoros-8466836a/"><i class="bi bi-linkedin" role="img">
</i> 
 </a>
  </li>  
</ul>
              <div class="quarto-toggle-container">
                  <a href="" class="quarto-color-scheme-toggle nav-link" onclick="window.quartoToggleColorScheme(); return false;" title="Toggle dark mode"><i class="bi"></i></a>
              </div>
              <div id="quarto-search" class="" title="Search"></div>
          </div> <!-- /navcollapse -->
      </div> <!-- /container-fluid -->
    </nav>
</header>
<!-- content -->
<header id="title-block-header" class="quarto-title-block default page-columns page-full">
  <div class="quarto-title-banner page-columns page-full">
    <div class="quarto-title column-body">
      <h1 class="title">Tratamiento para cucarachas</h1>
            <p class="subtitle lead">GLMs de conteo</p>
                                <div class="quarto-categories">
                <div class="quarto-category">Poisson</div>
                <div class="quarto-category">GLM</div>
                <div class="quarto-category">code</div>
                <div class="quarto-category">analysis</div>
              </div>
                  </div>
  </div>
    
  
  <div class="quarto-title-meta">

      <div>
      <div class="quarto-title-meta-heading">Author</div>
      <div class="quarto-title-meta-contents">
               <p>Asael Alonzo Matamoros </p>
            </div>
    </div>
      
      <div>
      <div class="quarto-title-meta-heading">Published</div>
      <div class="quarto-title-meta-contents">
        <p class="date">November 18, 2022</p>
      </div>
    </div>
      
    </div>
    
  
  </header><div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">On this page</h2>
   
  <ul>
  <li><a href="#verosimilitud" id="toc-verosimilitud" class="nav-link active" data-scroll-target="#verosimilitud">Verosimilitud</a></li>
  <li><a href="#ajuste-del-modelo-de-conteo-de-poisson" id="toc-ajuste-del-modelo-de-conteo-de-poisson" class="nav-link" data-scroll-target="#ajuste-del-modelo-de-conteo-de-poisson">Ajuste del modelo de Conteo de Poisson</a></li>
  <li><a href="#ajuste-del-modelo-log-normal" id="toc-ajuste-del-modelo-log-normal" class="nav-link" data-scroll-target="#ajuste-del-modelo-log-normal">Ajuste del modelo log-normal</a></li>
  <li><a href="#modelo-de-conteo-binomial-negativa" id="toc-modelo-de-conteo-binomial-negativa" class="nav-link" data-scroll-target="#modelo-de-conteo-binomial-negativa">Modelo de Conteo, Binomial Negativa</a></li>
  <li><a href="#selección-de-modelos-5-fold-cv" id="toc-selección-de-modelos-5-fold-cv" class="nav-link" data-scroll-target="#selección-de-modelos-5-fold-cv">Selección de modelos, 5-fold CV</a></li>
  <li><a href="#referencias" id="toc-referencias" class="nav-link" data-scroll-target="#referencias">Referencias</a></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content quarto-banner-title-block" id="quarto-document-content">




<p>Este post presenta un análisis la base `roaches`` usando un modelo lineal generalizado de conteo.</p>
<p>Se desea establecer la eficacia de cierto pesticida para el reducir el número de cucarachas en apartamentos urbanos. El tratamiento se aplicó a 158 de 262 apartamentos, <span class="math inline">y</span> es el número de cucarachas atrapadas después de aplicar dicho tratamiento.</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(caret)</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(GGally)</span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggplot2)</span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(rstanarm)</span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(flextable)</span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(bayesplot)</span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggfortify)</span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-9"><a href="#cb1-9" aria-hidden="true" tabindex="-1"></a><span class="fu">bayesplot_theme_set</span>(<span class="fu">theme_grey</span>())</span>
<span id="cb1-10"><a href="#cb1-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-11"><a href="#cb1-11" aria-hidden="true" tabindex="-1"></a><span class="fu">data</span>(roaches)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>Los resultados del estudio se almacenan en la base de datos <code>roaches</code>, que contiene las siguiente variables.</p>
<ul>
<li><p><code>y</code>: número de cucarachas, después de aplicar el tratamiento. (<strong>Dependiente</strong>)</p></li>
<li><p><code>roach1</code>: Número de cucarachas inicial.</p></li>
<li><p><code>treatment</code>: Indicador de si recibió el tratamiento.</p></li>
<li><p><code>senior</code>: Indicador si el residente era mayor.</p></li>
<li><p><code>eposure2</code>: Número de días que se aplicó el tratamiento.</p></li>
</ul>
<section id="verosimilitud" class="level2">
<h2 class="anchored" data-anchor-id="verosimilitud">Verosimilitud</h2>
<p>La variable <code>y</code> representa el número de cucarachas registradas al finalizar el tratamiento, dicha característica es representada por una v.a. discreta y positiva, y dicha característica debe ser considerada en el modelo.</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="fu">mcmc_dens</span>(roaches,<span class="at">pars =</span> <span class="fu">c</span>(<span class="st">"y"</span>,<span class="st">"roach1"</span>))<span class="sc">+</span></span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"Gráfico de densidades para el número de cucarachas"</span>,</span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a>       <span class="at">subtitle =</span> <span class="st">"Pre|Post tratamiento"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div id="fig-dens" class="quarto-figure quarto-figure-center anchored">
<figure class="figure">
<p><img src="index_files/figure-html/fig-dens-1.png" class="img-fluid figure-img" width="672"></p>
<p></p><figcaption class="figure-caption">Figure&nbsp;1: El gráfico izquierdo presenta las densidades de las dos variables de interés, el número de cucarachas previo y post exposición al tratamiento. Ambas variables muestran medias centradas en cero pero con colas bastante pesadas.</figcaption><p></p>
</figure>
</div>
</div>
</div>
<p><a href="#fig-dens">Figure&nbsp;1</a> muestra que ambas variables <code>y</code> y <code>roach1</code> son positivas, con colas derechas muy pesadas, para este tipo de datos existen dos alternativas:</p>
<ul>
<li><p>Modelar los datos con una distribución <span class="math inline">\log N(\mu,\sigma^2)</span>.</p></li>
<li><p>Modelar los datos con GLMs de conteo</p></li>
</ul>
<p>En GLMs de conteo, la distribución mas popular debido a su simpleza es Poisson pero con una fuerte limitación que los datos poseen media y varianza iguales. Para medir los efectos del tratamiento mediante un GLM de conteo de Poisson definimos la verosimilitud de tal forma que:</p>
<p><span class="math display">y_i \sim \text{Poisson}(\mu_i),\quad g(\mu_i) = \log(\mu_i), \text{ y } \mu_i = \mu_0e^{\beta X_i}.</span> Donde:</p>
<ul>
<li><p><span class="math inline">\mu_0</span> se le conoce como la información previo a la exposición.</p></li>
<li><p><span class="math inline">g:\mathbb R \to \mathbb R</span>, es la función de enlace logarítmica <span class="math inline">g(x) = \log x</span></p></li>
<li><p>y <span class="math inline">X</span> son las covariables.</p></li>
</ul>
<p>En un modelo log-normal, asumimos que los datos en escala logarítmica siguen un modelo normal</p>
<p><span class="math display">\log y_i\sim N(\mu_i,\sigma^2), \quad  g(\mu_i) = \mu_i, \text{ y } \mu_i = \beta X_i.</span> Es importante tener en cuenta que la función logarítmica es convexa, por ende no se puede aplicar la transformación inversa para obtener las predicciones en las escalas originales. Recordar que si <span class="math inline">y \sim \log N(\mu,\sigma^2)</span> entonces:</p>
<p><span class="math display">E[y] = e^{\mu +1/2\sigma}.</span> Finalmente realizamos un gráfico de correlaciones para identificar las interacciones lineales entre variables.</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggpairs</span>(roaches )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div id="fig-pairs" class="quarto-figure quarto-figure-center anchored">
<figure class="figure">
<p><img src="index_files/figure-html/fig-pairs-1.png" class="img-fluid figure-img" width="672"></p>
<p></p><figcaption class="figure-caption">Figure&nbsp;2: Gráfico de pares. La diagonal principal muestra histogramas densidades de cada una de las variables. La parte superior muestra el coeficiente de correlación entre dos variables, fila y columna. La parte inferior muestra un gráfico de dispersión entre dos variables.</figcaption><p></p>
</figure>
</div>
</div>
</div>
<p><a href="#fig-pairs">Figure&nbsp;2</a> muestra resultados anti-intuitivos, se esperaría una alta correlación entre las variables <code>y</code> y <code>roach1</code>, dado que ambas miden la misma información pero en tiempos diferentes. Dado la poca correlación entre las variables consideramos un modelo completo que incluya todas las interacciones en el modelo.</p>
</section>
<section id="ajuste-del-modelo-de-conteo-de-poisson" class="level2">
<h2 class="anchored" data-anchor-id="ajuste-del-modelo-de-conteo-de-poisson">Ajuste del modelo de Conteo de Poisson</h2>
<p>Ajustamos el modelo GLM de conteo completo que consiste en usar todas las variables, y revisamos el ajuste e inferencia de los parámetros.</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a>m1  <span class="ot">=</span> <span class="fu">glm</span>(y <span class="sc">~</span> roach1 <span class="sc">+</span> treatment <span class="sc">+</span> senior, <span class="at">offset =</span> <span class="fu">log</span>(exposure2),</span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a>            <span class="at">data =</span> roaches, <span class="at">family =</span> poisson)</span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-4"><a href="#cb4-4" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(m1)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>
Call:
glm(formula = y ~ roach1 + treatment + senior, family = poisson, 
    data = roaches, offset = log(exposure2))

Deviance Residuals: 
     Min        1Q    Median        3Q       Max  
-17.9430   -5.1529   -3.8059    0.1452   26.7771  

Coefficients:
              Estimate Std. Error z value Pr(&gt;|z|)    
(Intercept)  3.089e+00  2.123e-02  145.49   &lt;2e-16 ***
roach1       6.983e-03  8.874e-05   78.69   &lt;2e-16 ***
treatment   -5.167e-01  2.474e-02  -20.89   &lt;2e-16 ***
senior      -3.799e-01  3.342e-02  -11.37   &lt;2e-16 ***
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

(Dispersion parameter for poisson family taken to be 1)

    Null deviance: 16954  on 261  degrees of freedom
Residual deviance: 11429  on 258  degrees of freedom
AIC: 12192

Number of Fisher Scoring iterations: 6</code></pre>
</div>
</div>
<p>El modelo completo da una impresión con buenos resultados, todas las variables son significativas pero los residuos no están centrados en cero, por ende no cumplen los supuestos iniciales. El siguiente código genera una muestra Bootstrap para los parámetros del modelo <span class="math inline">M_1</span>.</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a>glm_boots <span class="ot">=</span> <span class="cf">function</span>(y,x,exposure,<span class="at">B =</span> <span class="dv">1000</span>){</span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a>  n <span class="ot">=</span> <span class="fu">length</span>(y)</span>
<span id="cb6-3"><a href="#cb6-3" aria-hidden="true" tabindex="-1"></a>  est <span class="ot">=</span> <span class="cn">NULL</span></span>
<span id="cb6-4"><a href="#cb6-4" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>B) {</span>
<span id="cb6-5"><a href="#cb6-5" aria-hidden="true" tabindex="-1"></a>    si <span class="ot">=</span> <span class="fu">sample</span>(<span class="at">x =</span> <span class="dv">1</span><span class="sc">:</span>n,<span class="at">size =</span> n,<span class="at">replace =</span> <span class="cn">TRUE</span>)</span>
<span id="cb6-6"><a href="#cb6-6" aria-hidden="true" tabindex="-1"></a>    mli <span class="ot">=</span> <span class="fu">glm</span>(y[si]<span class="sc">~</span>x[si,], <span class="at">offset =</span> <span class="fu">log</span>(exposure[si]),<span class="at">family =</span> poisson)</span>
<span id="cb6-7"><a href="#cb6-7" aria-hidden="true" tabindex="-1"></a>    ci <span class="ot">=</span> <span class="fu">as.array</span>(mli<span class="sc">$</span>coefficients)</span>
<span id="cb6-8"><a href="#cb6-8" aria-hidden="true" tabindex="-1"></a>    est <span class="ot">=</span> <span class="fu">rbind</span>(est,ci)</span>
<span id="cb6-9"><a href="#cb6-9" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb6-10"><a href="#cb6-10" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Estética</span></span>
<span id="cb6-11"><a href="#cb6-11" aria-hidden="true" tabindex="-1"></a>  cn <span class="ot">=</span> <span class="fu">colnames</span>(x)</span>
<span id="cb6-12"><a href="#cb6-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">colnames</span>(est) <span class="ot">=</span> <span class="fu">c</span>(<span class="st">"intercepto"</span>,cn)</span>
<span id="cb6-13"><a href="#cb6-13" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb6-14"><a href="#cb6-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(est)</span>
<span id="cb6-15"><a href="#cb6-15" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>Obtenemos una muestra Bootstrap para los estimadores <span class="math inline">\hat \beta</span> de tamaño <span class="math inline">B = 2,000</span> repeticiones</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a>btp <span class="ot">=</span> <span class="fu">glm_boots</span>(<span class="at">y =</span> roaches<span class="sc">$</span>y,</span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a>               <span class="at">x =</span> <span class="fu">as.matrix</span>(roaches[,<span class="dv">2</span><span class="sc">:</span><span class="dv">4</span>]),</span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a>               <span class="at">exposure =</span> roaches<span class="sc">$</span>exposure2,<span class="at">B =</span> <span class="dv">2000</span>)</span>
<span id="cb7-4"><a href="#cb7-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-5"><a href="#cb7-5" aria-hidden="true" tabindex="-1"></a><span class="fu">color_scheme_set</span>(<span class="st">"green"</span>)</span>
<span id="cb7-6"><a href="#cb7-6" aria-hidden="true" tabindex="-1"></a><span class="fu">mcmc_dens</span>(btp)<span class="sc">+</span><span class="fu">labs</span>(<span class="at">title=</span><span class="st">"Distribución muestral de los estimadores, GLM Poisson"</span>,</span>
<span id="cb7-7"><a href="#cb7-7" aria-hidden="true" tabindex="-1"></a>                    <span class="at">subtitle =</span><span class="st">"Bootstrap B = 2,000 iteraciones"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div id="fig-btp1" class="quarto-figure quarto-figure-center anchored">
<figure class="figure">
<p><img src="index_files/figure-html/fig-btp1-1.png" class="img-fluid figure-img" width="672"></p>
<p></p><figcaption class="figure-caption">Figure&nbsp;3: Gráfico de densidades. Cada densidad representa la distribución muestral aproximada para cada uno de los estimadores usando un Bootstrap de B = 2,000 iteraciones.</figcaption><p></p>
</figure>
</div>
</div>
</div>
<p>Los intervalos de confianza al 95% son:</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a>x <span class="ot">=</span> <span class="fu">apply</span>(btp,<span class="at">MARGIN =</span> <span class="dv">2</span>, <span class="at">FUN =</span> quantile, <span class="at">probs =</span> <span class="fu">c</span>(<span class="fl">0.025</span>,<span class="fl">0.5</span>,<span class="fl">0.975</span>)) </span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Estética</span></span>
<span id="cb8-4"><a href="#cb8-4" aria-hidden="true" tabindex="-1"></a>x <span class="ot">=</span> <span class="fu">data.frame</span>( <span class="fu">t</span>(x) )</span>
<span id="cb8-5"><a href="#cb8-5" aria-hidden="true" tabindex="-1"></a>x<span class="sc">$</span>pars <span class="ot">=</span> <span class="fu">c</span>(<span class="st">"intercepto"</span>,<span class="st">"roach1"</span>,<span class="st">"treatment"</span>,<span class="st">"senior"</span>)</span>
<span id="cb8-6"><a href="#cb8-6" aria-hidden="true" tabindex="-1"></a><span class="fu">colnames</span>(x) <span class="ot">=</span> <span class="fu">c</span>(<span class="st">"q2.5%"</span>,<span class="st">"Median"</span>,<span class="st">"q97.5%"</span>,<span class="st">"parámetros"</span>)</span>
<span id="cb8-7"><a href="#cb8-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-8"><a href="#cb8-8" aria-hidden="true" tabindex="-1"></a>ft <span class="ot">=</span> <span class="fu">flextable</span>(x[<span class="fu">c</span>(<span class="dv">4</span>,<span class="dv">1</span>,<span class="dv">2</span>,<span class="dv">3</span>)])</span>
<span id="cb8-9"><a href="#cb8-9" aria-hidden="true" tabindex="-1"></a><span class="fu">autofit</span>(ft)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div id="tbl-btp1" class="anchored">

<div class="tabwid"><style>.cl-19c5b7d0{}.cl-19c05114{font-family:'Helvetica';font-size:11pt;font-weight:normal;font-style:normal;text-decoration:none;color:rgba(0, 0, 0, 1.00);background-color:transparent;}.cl-19c2a11c{margin:0;text-align:left;border-bottom: 0 solid rgba(0, 0, 0, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);padding-bottom:5pt;padding-top:5pt;padding-left:5pt;padding-right:5pt;line-height: 1;background-color:transparent;}.cl-19c2a126{margin:0;text-align:right;border-bottom: 0 solid rgba(0, 0, 0, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);padding-bottom:5pt;padding-top:5pt;padding-left:5pt;padding-right:5pt;line-height: 1;background-color:transparent;}.cl-19c2b120{width:1.058in;background-color:transparent;vertical-align: middle;border-bottom: 2pt solid rgba(102, 102, 102, 1.00);border-top: 2pt solid rgba(102, 102, 102, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-19c2b121{width:1.228in;background-color:transparent;vertical-align: middle;border-bottom: 2pt solid rgba(102, 102, 102, 1.00);border-top: 2pt solid rgba(102, 102, 102, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-19c2b12a{width:1.058in;background-color:transparent;vertical-align: middle;border-bottom: 0 solid rgba(0, 0, 0, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-19c2b12b{width:1.228in;background-color:transparent;vertical-align: middle;border-bottom: 0 solid rgba(0, 0, 0, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-19c2b134{width:1.058in;background-color:transparent;vertical-align: middle;border-bottom: 0 solid rgba(0, 0, 0, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-19c2b135{width:1.228in;background-color:transparent;vertical-align: middle;border-bottom: 0 solid rgba(0, 0, 0, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-19c2b13e{width:1.058in;background-color:transparent;vertical-align: middle;border-bottom: 0 solid rgba(0, 0, 0, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-19c2b13f{width:1.228in;background-color:transparent;vertical-align: middle;border-bottom: 0 solid rgba(0, 0, 0, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-19c2b140{width:1.058in;background-color:transparent;vertical-align: middle;border-bottom: 2pt solid rgba(102, 102, 102, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-19c2b148{width:1.228in;background-color:transparent;vertical-align: middle;border-bottom: 2pt solid rgba(102, 102, 102, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}</style><table class="cl-19c5b7d0"><caption>Table&nbsp;1:  Intervalos de confianza al 95%, obtenidos a partir de una muestra bootstrap de B = 2,000 iteraciones </caption><thead><tr style="overflow-wrap:break-word;"><td class="cl-19c2b120"><p class="cl-19c2a11c"><span class="cl-19c05114">parámetros</span></p></td><td class="cl-19c2b121"><p class="cl-19c2a126"><span class="cl-19c05114">q2.5%</span></p></td><td class="cl-19c2b121"><p class="cl-19c2a126"><span class="cl-19c05114">Median</span></p></td><td class="cl-19c2b121"><p class="cl-19c2a126"><span class="cl-19c05114">q97.5%</span></p></td></tr></thead><tbody><tr style="overflow-wrap:break-word;"><td class="cl-19c2b12a"><p class="cl-19c2a11c"><span class="cl-19c05114">intercepto</span></p></td><td class="cl-19c2b12b"><p class="cl-19c2a126"><span class="cl-19c05114">2.649627708</span></p></td><td class="cl-19c2b12b"><p class="cl-19c2a126"><span class="cl-19c05114">3.068413734</span></p></td><td class="cl-19c2b12b"><p class="cl-19c2a126"><span class="cl-19c05114">3.432606996</span></p></td></tr><tr style="overflow-wrap:break-word;"><td class="cl-19c2b134"><p class="cl-19c2a11c"><span class="cl-19c05114">roach1</span></p></td><td class="cl-19c2b135"><p class="cl-19c2a126"><span class="cl-19c05114">0.005607099</span></p></td><td class="cl-19c2b135"><p class="cl-19c2a126"><span class="cl-19c05114">0.007154547</span></p></td><td class="cl-19c2b135"><p class="cl-19c2a126"><span class="cl-19c05114">0.009544093</span></p></td></tr><tr style="overflow-wrap:break-word;"><td class="cl-19c2b13e"><p class="cl-19c2a11c"><span class="cl-19c05114">treatment</span></p></td><td class="cl-19c2b13f"><p class="cl-19c2a126"><span class="cl-19c05114">-0.985689844</span></p></td><td class="cl-19c2b13f"><p class="cl-19c2a126"><span class="cl-19c05114">-0.546835384</span></p></td><td class="cl-19c2b13f"><p class="cl-19c2a126"><span class="cl-19c05114">-0.050803652</span></p></td></tr><tr style="overflow-wrap:break-word;"><td class="cl-19c2b140"><p class="cl-19c2a11c"><span class="cl-19c05114">senior</span></p></td><td class="cl-19c2b148"><p class="cl-19c2a126"><span class="cl-19c05114">-1.078203744</span></p></td><td class="cl-19c2b148"><p class="cl-19c2a126"><span class="cl-19c05114">-0.368706622</span></p></td><td class="cl-19c2b148"><p class="cl-19c2a126"><span class="cl-19c05114">0.164622627</span></p></td></tr></tbody></table></div>
</div>
</div>
</div>
<p>Los intervalos de confianza muestran que el efecto de la variable <code>roach1</code> esta concentrado en cero, por lo tanto, se deberá considerar un GLM de Poisson excluyendo dicha variable.</p>
</section>
<section id="ajuste-del-modelo-log-normal" class="level2">
<h2 class="anchored" data-anchor-id="ajuste-del-modelo-log-normal">Ajuste del modelo log-normal</h2>
<p>Ajustamos el modelo GLM log-normal completo que consiste en usar todas las variables, y revisamos el ajuste e inferencia de los parámetros. Hay que tomar en cuenta que al tomar <code>y</code> y <code>roach1</code> en escala logarítmica, se tendrán que descartar los valores infinitos obtenidos, dado que las distribuciones se acumulan en cero</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a>df <span class="ot">=</span> roaches</span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a>df[,<span class="dv">1</span><span class="sc">:</span><span class="dv">2</span>] <span class="ot">=</span> <span class="fu">log</span>(df[,<span class="dv">1</span><span class="sc">:</span><span class="dv">2</span>])</span>
<span id="cb9-3"><a href="#cb9-3" aria-hidden="true" tabindex="-1"></a>df <span class="ot">=</span> <span class="fu">subset</span>(df,<span class="at">subset =</span> df<span class="sc">$</span>y <span class="sc">!=</span> <span class="sc">-</span><span class="cn">Inf</span> <span class="sc">&amp;</span> df<span class="sc">$</span>roach1 <span class="sc">!=</span> <span class="sc">-</span><span class="cn">Inf</span>)</span>
<span id="cb9-4"><a href="#cb9-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-5"><a href="#cb9-5" aria-hidden="true" tabindex="-1"></a>m2 <span class="ot">=</span> <span class="fu">lm</span>(y<span class="sc">~</span>.,<span class="at">data =</span> df)</span>
<span id="cb9-6"><a href="#cb9-6" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(m2)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>
Call:
lm(formula = y ~ ., data = df)

Residuals:
    Min      1Q  Median      3Q     Max 
-3.0679 -1.0726  0.2976  0.9884  2.8697 

Coefficients:
            Estimate Std. Error t value Pr(&gt;|t|)    
(Intercept)  1.58442    0.40132   3.948 0.000122 ***
roach1       0.52136    0.06408   8.137 1.62e-13 ***
treatment   -0.38609    0.21808  -1.770 0.078746 .  
senior      -0.38632    0.25848  -1.495 0.137187    
exposure2   -0.19054    0.30949  -0.616 0.539082    
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

Residual standard error: 1.299 on 146 degrees of freedom
Multiple R-squared:  0.3315,    Adjusted R-squared:  0.3132 
F-statistic:  18.1 on 4 and 146 DF,  p-value: 4.281e-12</code></pre>
</div>
</div>
<p>El modelo completo da una mala impresión,hay variables no significativas, el coeficiente de determinación <span class="math inline">\hat R = 0.31</span> es bastante cercano a cero, y los residuos no están centrados en cero, por ende no cumplen los supuestos iniciales. Finalmente, revisamos los residuos del modelo, dado que los supuestos de normalidad pueden ser evaluados.</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a><span class="fu">autoplot</span>(m2)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div id="fig-res1" class="quarto-figure quarto-figure-center anchored">
<figure class="figure">
<p><img src="index_files/figure-html/fig-res1-1.png" class="img-fluid figure-img" width="672"></p>
<p></p><figcaption class="figure-caption">Figure&nbsp;4: Gráfico diagnóstico de los residuos, estos cuatro gráficos evaluan el ajuste y supuestos del modelo, si algún comportamiento polinómico es persistente, entonces los supuestos del modelo no se satisfacen.</figcaption><p></p>
</figure>
</div>
</div>
</div>
<p><a href="#fig-res1">Figure&nbsp;4</a> muestra que los supuestos de normalidad en su mayoría si se cumplen, el gráfico inferior izquierdo muestra un comportamiento irregular, pero debido a que una observación es anómala e influenciable, por lo tanto, otro modelo a considerar es usando una distribución Student-t con grados de libertad cercanos a <span class="math inline">v = 3</span>.</p>
</section>
<section id="modelo-de-conteo-binomial-negativa" class="level2">
<h2 class="anchored" data-anchor-id="modelo-de-conteo-binomial-negativa">Modelo de Conteo, Binomial Negativa</h2>
<p>La distribución Binomial negativa mide el número de éxitos que ocurren hasta el k-ésimo fracaso. Una v.a.d se distribuye Binomial Negativa (<span class="math inline">y_i \sim BN(k,p)</span>) si:</p>
<p><span class="math display">f(y|p) = \binom{y+k-1}{y}(1-p)^k p^y.</span></p>
<p>Donde:</p>
<ul>
<li><p>p es la probabilidad de éxito de un experimento Bernoulli.</p></li>
<li><p>k es el número de fracasos hasta tener el primer éxito</p></li>
<li><p><span class="math inline">E[y_i] = \frac{pk}{1-p}</span> es el valor esperado.</p></li>
<li><p><span class="math inline">V[y_i] = \frac{pk}{(1-p)^2}</span>, es la varianza.</p></li>
</ul>
<p>Esta distribución se puede re-parametrizar en términos de su media <span class="math inline">E[y_i] = \mu</span> y varianza <span class="math inline">V[y] = \sigma^2</span>.</p>
<ul>
<li><p><span class="math inline">p = \frac{\sigma^2 - \mu}{\sigma^2},</span></p></li>
<li><p><span class="math inline">k = \frac{\mu^2}{\sigma^2 - \mu}.</span></p></li>
</ul>
<p><span class="math display">f(y) = \binom{y+\frac{\mu^2}{\sigma^2 - \mu}-1}{y}\left(\frac{\sigma^2 - \mu}{\sigma^2}\right)^y \left(\frac{\mu}{\sigma^2}\right)^{\frac{\mu^2}{\sigma^2 - \mu}}</span></p>
<p>Para medir los efectos del tratamiento mediante un GLM de conteo de Binomial negativa, definimos la verosimilitud de tal forma que:</p>
<p><span class="math display">y_i \sim BN(\mu_i,\sigma^2)\quad g(\mu_i) = \log(\mu_i), \text{ y } \mu_i = \mu_0e^{\beta X_i}.</span></p>
<p>Donde:</p>
<ul>
<li><p><span class="math inline">\mu_0</span> se le conoce como la información previo a la exposición.</p></li>
<li><p><span class="math inline">g:\mathbb R \to \mathbb R</span>, es la función de enlace logarítmica <span class="math inline">g(x) = \log x</span></p></li>
<li><p>y <span class="math inline">X</span> son las covariables.</p></li>
<li><p>El modelo no tiene la limitante que la varianza es la media <span class="math inline">V[y_i] \neq \mu_i</span>.</p></li>
</ul>
<p>Ajustamos el modelo GLM de conteo completo que consiste en usar todas las variables, y revisamos el ajuste e inferencia de los parámetros.</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(MASS)</span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-3"><a href="#cb12-3" aria-hidden="true" tabindex="-1"></a>m3 <span class="ot">=</span> <span class="fu">glm.nb</span>(y <span class="sc">~</span> roach1 <span class="sc">+</span> treatment <span class="sc">+</span> senior <span class="sc">+</span> exposure2,<span class="at">data =</span> roaches)</span>
<span id="cb12-4"><a href="#cb12-4" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(m3)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>
Call:
glm.nb(formula = y ~ roach1 + treatment + senior + exposure2, 
    data = roaches, init.theta = 0.2717608411, link = log)

Deviance Residuals: 
    Min       1Q   Median       3Q      Max  
-1.8052  -1.3452  -0.6815  -0.0344   3.1831  

Coefficients:
             Estimate Std. Error z value Pr(&gt;|z|)    
(Intercept)  2.393790   0.441811   5.418 6.02e-08 ***
roach1       0.012764   0.001601   7.975 1.52e-15 ***
treatment   -0.764550   0.245659  -3.112  0.00186 ** 
senior      -0.341062   0.264555  -1.289  0.19733    
exposure2    0.435159   0.374132   1.163  0.24478    
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

(Dispersion parameter for Negative Binomial(0.2718) family taken to be 1)

    Null deviance: 338.89  on 261  degrees of freedom
Residual deviance: 277.87  on 257  degrees of freedom
AIC: 1792.7

Number of Fisher Scoring iterations: 1

              Theta:  0.2718 
          Std. Err.:  0.0259 

 2 x log-likelihood:  -1780.7380 </code></pre>
</div>
</div>
<p>El modelo completo presenta mejores resultados que el modelo de Poisson pese que no todas las variables son significativas. Los residuos están centrados en cero y menos disperso, cumpliendo los supuestos iniciales.</p>
</section>
<section id="selección-de-modelos-5-fold-cv" class="level2">
<h2 class="anchored" data-anchor-id="selección-de-modelos-5-fold-cv">Selección de modelos, 5-fold CV</h2>
<p>Para seleccionar el mejor modelo usaremos validación cruzada, 5-fold, esto implica que ajustaremos cinco veces cada modelo, evaluando la capacidad de aprendizaje usando <span class="math inline">AIC</span>, <span class="math inline">RMSE</span> y <span class="math inline">MAE</span>. Los modelos que se consideraran son los siguientes:</p>
<ul>
<li><p><span class="math inline">M_1:</span> Modelo de Poisson completo</p></li>
<li><p><span class="math inline">M_2:</span> Modelo log-normal completo.</p></li>
<li><p><span class="math inline">M_3:</span> Modelo Binomial Negativa completo.</p></li>
<li><p><span class="math inline">M_{3.1}:</span> Modelo BN reducido, sin la variable <code>roach1</code>.</p></li>
</ul>
<p>El siguiente código presenta una función para realizar <strong>k-fold-CV</strong> para cualquier valor de <span class="math inline">k</span>. En caso de querer añadir otros modelos o criterios, la función deberá ser modificada.</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb14"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a>kfold <span class="ot">=</span> <span class="cf">function</span>(df,k){</span>
<span id="cb14-2"><a href="#cb14-2" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Generar la particion</span></span>
<span id="cb14-3"><a href="#cb14-3" aria-hidden="true" tabindex="-1"></a>  kfld <span class="ot">=</span> <span class="fu">createFolds</span>(df[,<span class="dv">1</span>],<span class="at">k =</span> k)</span>
<span id="cb14-4"><a href="#cb14-4" aria-hidden="true" tabindex="-1"></a>  mat <span class="ot">=</span> <span class="cn">NULL</span></span>
<span id="cb14-5"><a href="#cb14-5" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb14-6"><a href="#cb14-6" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>k) {</span>
<span id="cb14-7"><a href="#cb14-7" aria-hidden="true" tabindex="-1"></a>    <span class="co"># separar los datos en conjuntos de prueba y entrenamiento</span></span>
<span id="cb14-8"><a href="#cb14-8" aria-hidden="true" tabindex="-1"></a>    dfE<span class="ot">=</span> df[<span class="sc">-</span>kfld[[i]],]</span>
<span id="cb14-9"><a href="#cb14-9" aria-hidden="true" tabindex="-1"></a>    dfP <span class="ot">=</span> df[kfld[[i]],]</span>
<span id="cb14-10"><a href="#cb14-10" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Ajustar los modelos</span></span>
<span id="cb14-11"><a href="#cb14-11" aria-hidden="true" tabindex="-1"></a>    m1  <span class="ot">=</span> <span class="fu">glm</span>(y <span class="sc">~</span> roach1 <span class="sc">+</span> treatment <span class="sc">+</span> senior, <span class="at">offset =</span> <span class="fu">log</span>(exposure2),</span>
<span id="cb14-12"><a href="#cb14-12" aria-hidden="true" tabindex="-1"></a>            <span class="at">data =</span> dfE, <span class="at">family =</span> poisson)</span>
<span id="cb14-13"><a href="#cb14-13" aria-hidden="true" tabindex="-1"></a>    m3  <span class="ot">=</span> <span class="fu">glm.nb</span>(y <span class="sc">~</span> roach1 <span class="sc">+</span> treatment <span class="sc">+</span> senior <span class="sc">+</span> exposure2,<span class="at">data =</span> roaches)</span>
<span id="cb14-14"><a href="#cb14-14" aria-hidden="true" tabindex="-1"></a>    m31 <span class="ot">=</span>  <span class="fu">glm.nb</span>(y <span class="sc">~</span> treatment <span class="sc">+</span> senior <span class="sc">+</span> exposure2,<span class="at">data =</span> roaches)</span>
<span id="cb14-15"><a href="#cb14-15" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb14-16"><a href="#cb14-16" aria-hidden="true" tabindex="-1"></a>    p1  <span class="ot">=</span> <span class="fu">predict</span>(m1,dfP)</span>
<span id="cb14-17"><a href="#cb14-17" aria-hidden="true" tabindex="-1"></a>    p3  <span class="ot">=</span> <span class="fu">predict</span>(m3,dfP)</span>
<span id="cb14-18"><a href="#cb14-18" aria-hidden="true" tabindex="-1"></a>    p31 <span class="ot">=</span> <span class="fu">predict</span>(m31,dfP)</span>
<span id="cb14-19"><a href="#cb14-19" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb14-20"><a href="#cb14-20" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Calcular AIC y RMSE</span></span>
<span id="cb14-21"><a href="#cb14-21" aria-hidden="true" tabindex="-1"></a>    aic <span class="ot">=</span> <span class="fu">c</span>(</span>
<span id="cb14-22"><a href="#cb14-22" aria-hidden="true" tabindex="-1"></a>            <span class="fu">AIC</span>(m1),</span>
<span id="cb14-23"><a href="#cb14-23" aria-hidden="true" tabindex="-1"></a>            <span class="fu">AIC</span>(m3),</span>
<span id="cb14-24"><a href="#cb14-24" aria-hidden="true" tabindex="-1"></a>            <span class="fu">AIC</span>(m31)</span>
<span id="cb14-25"><a href="#cb14-25" aria-hidden="true" tabindex="-1"></a>            )</span>
<span id="cb14-26"><a href="#cb14-26" aria-hidden="true" tabindex="-1"></a>    rmse <span class="ot">=</span> <span class="fu">c</span>(</span>
<span id="cb14-27"><a href="#cb14-27" aria-hidden="true" tabindex="-1"></a>             <span class="fu">RMSE</span>(<span class="at">pred =</span>  p1,<span class="at">obs =</span> dfP[,<span class="dv">1</span>]),</span>
<span id="cb14-28"><a href="#cb14-28" aria-hidden="true" tabindex="-1"></a>             <span class="fu">RMSE</span>(<span class="at">pred =</span>  p3,<span class="at">obs =</span> dfP[,<span class="dv">1</span>]),</span>
<span id="cb14-29"><a href="#cb14-29" aria-hidden="true" tabindex="-1"></a>             <span class="fu">RMSE</span>(<span class="at">pred =</span>  p31,<span class="at">obs =</span> dfP[,<span class="dv">1</span>])</span>
<span id="cb14-30"><a href="#cb14-30" aria-hidden="true" tabindex="-1"></a>             )</span>
<span id="cb14-31"><a href="#cb14-31" aria-hidden="true" tabindex="-1"></a>    mae <span class="ot">=</span> <span class="fu">c</span>(</span>
<span id="cb14-32"><a href="#cb14-32" aria-hidden="true" tabindex="-1"></a>             <span class="fu">MAE</span>(<span class="at">pred =</span>  p1,<span class="at">obs =</span> dfP[,<span class="dv">1</span>]),</span>
<span id="cb14-33"><a href="#cb14-33" aria-hidden="true" tabindex="-1"></a>             <span class="fu">MAE</span>(<span class="at">pred =</span>  p3,<span class="at">obs =</span> dfP[,<span class="dv">1</span>]),</span>
<span id="cb14-34"><a href="#cb14-34" aria-hidden="true" tabindex="-1"></a>             <span class="fu">MAE</span>(<span class="at">pred =</span>  p31,<span class="at">obs =</span> dfP[,<span class="dv">1</span>])</span>
<span id="cb14-35"><a href="#cb14-35" aria-hidden="true" tabindex="-1"></a>            )</span>
<span id="cb14-36"><a href="#cb14-36" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-37"><a href="#cb14-37" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Unir los datos</span></span>
<span id="cb14-38"><a href="#cb14-38" aria-hidden="true" tabindex="-1"></a>    mat <span class="ot">=</span> <span class="fu">rbind</span>(mat,<span class="fu">c</span>(aic,rmse,mae)) </span>
<span id="cb14-39"><a href="#cb14-39" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb14-40"><a href="#cb14-40" aria-hidden="true" tabindex="-1"></a>  <span class="fu">colnames</span>(mat) <span class="ot">=</span> <span class="fu">c</span>(<span class="st">"AIC1"</span>, <span class="st">"AIC3"</span>, <span class="st">"AIC31"</span>,</span>
<span id="cb14-41"><a href="#cb14-41" aria-hidden="true" tabindex="-1"></a>                    <span class="st">"RMSE1"</span>,<span class="st">"RMSE3"</span>,<span class="st">"RMSE31"</span>,</span>
<span id="cb14-42"><a href="#cb14-42" aria-hidden="true" tabindex="-1"></a>                    <span class="st">"MAE1"</span>,<span class="st">"MAE3"</span>,<span class="st">"MAE31"</span>)</span>
<span id="cb14-43"><a href="#cb14-43" aria-hidden="true" tabindex="-1"></a>  <span class="fu">row.names</span>(mat) <span class="ot">=</span> <span class="cn">NULL</span></span>
<span id="cb14-44"><a href="#cb14-44" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(mat)</span>
<span id="cb14-45"><a href="#cb14-45" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p><a href="#tbl-cv">Table&nbsp;2</a> presenta los resultados obtenidos al realizar 5-fold-cv, bajo todos los criterios presentados, el modelo <span class="math inline">M_3</span> presenta las mejores predicciones. Por lo tanto, <span class="math inline">M_3</span> es el modelo con Mayor aprendizaje.</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb15"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a>rst <span class="ot">=</span> <span class="fu">kfold</span>(<span class="at">df =</span> roaches,<span class="at">k =</span> <span class="dv">5</span>)</span>
<span id="cb15-2"><a href="#cb15-2" aria-hidden="true" tabindex="-1"></a>x <span class="ot">=</span> <span class="fu">t</span>(<span class="fu">apply</span>(rst,<span class="at">MARGIN =</span> <span class="dv">2</span>,<span class="at">FUN =</span> <span class="st">"quantile"</span>,<span class="at">probs =</span> <span class="fu">c</span>(<span class="fl">0.025</span>,<span class="fl">0.5</span>,<span class="fl">0.975</span>)))</span>
<span id="cb15-3"><a href="#cb15-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-4"><a href="#cb15-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Estética</span></span>
<span id="cb15-5"><a href="#cb15-5" aria-hidden="true" tabindex="-1"></a>x <span class="ot">=</span> <span class="fu">data.frame</span>(x)</span>
<span id="cb15-6"><a href="#cb15-6" aria-hidden="true" tabindex="-1"></a>x<span class="sc">$</span>pars <span class="ot">=</span>  <span class="fu">c</span>(<span class="st">"AIC1"</span>, <span class="st">"AIC3"</span>, <span class="st">"AIC31"</span>,</span>
<span id="cb15-7"><a href="#cb15-7" aria-hidden="true" tabindex="-1"></a>            <span class="st">"RMSE1"</span>,<span class="st">"RMSE3"</span>,<span class="st">"RMSE31"</span>,</span>
<span id="cb15-8"><a href="#cb15-8" aria-hidden="true" tabindex="-1"></a>            <span class="st">"MAE1"</span>,<span class="st">"MAE3"</span>,<span class="st">"MAE31"</span>)</span>
<span id="cb15-9"><a href="#cb15-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-10"><a href="#cb15-10" aria-hidden="true" tabindex="-1"></a><span class="fu">colnames</span>(x) <span class="ot">=</span> <span class="fu">c</span>(<span class="st">"q2.5%"</span>,<span class="st">"Median"</span>,<span class="st">"q97.5%"</span>,<span class="st">"Criterio"</span>)</span>
<span id="cb15-11"><a href="#cb15-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-12"><a href="#cb15-12" aria-hidden="true" tabindex="-1"></a>ft <span class="ot">=</span> <span class="fu">flextable</span>(x[<span class="fu">c</span>(<span class="dv">4</span>,<span class="dv">1</span>,<span class="dv">2</span>,<span class="dv">3</span>)])</span>
<span id="cb15-13"><a href="#cb15-13" aria-hidden="true" tabindex="-1"></a><span class="fu">autofit</span>(ft)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div id="tbl-cv" class="anchored">

<div class="tabwid"><style>.cl-1ab89b4e{}.cl-1ab3f27e{font-family:'Helvetica';font-size:11pt;font-weight:normal;font-style:normal;text-decoration:none;color:rgba(0, 0, 0, 1.00);background-color:transparent;}.cl-1ab5da3a{margin:0;text-align:left;border-bottom: 0 solid rgba(0, 0, 0, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);padding-bottom:5pt;padding-top:5pt;padding-left:5pt;padding-right:5pt;line-height: 1;background-color:transparent;}.cl-1ab5da44{margin:0;text-align:right;border-bottom: 0 solid rgba(0, 0, 0, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);padding-bottom:5pt;padding-top:5pt;padding-left:5pt;padding-right:5pt;line-height: 1;background-color:transparent;}.cl-1ab5e624{width:0.897in;background-color:transparent;vertical-align: middle;border-bottom: 2pt solid rgba(102, 102, 102, 1.00);border-top: 2pt solid rgba(102, 102, 102, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-1ab5e625{width:1.135in;background-color:transparent;vertical-align: middle;border-bottom: 2pt solid rgba(102, 102, 102, 1.00);border-top: 2pt solid rgba(102, 102, 102, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-1ab5e62e{width:1.22in;background-color:transparent;vertical-align: middle;border-bottom: 2pt solid rgba(102, 102, 102, 1.00);border-top: 2pt solid rgba(102, 102, 102, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-1ab5e62f{width:0.897in;background-color:transparent;vertical-align: middle;border-bottom: 0 solid rgba(0, 0, 0, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-1ab5e638{width:1.135in;background-color:transparent;vertical-align: middle;border-bottom: 0 solid rgba(0, 0, 0, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-1ab5e639{width:1.22in;background-color:transparent;vertical-align: middle;border-bottom: 0 solid rgba(0, 0, 0, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-1ab5e642{width:0.897in;background-color:transparent;vertical-align: middle;border-bottom: 0 solid rgba(0, 0, 0, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-1ab5e643{width:1.135in;background-color:transparent;vertical-align: middle;border-bottom: 0 solid rgba(0, 0, 0, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-1ab5e644{width:1.22in;background-color:transparent;vertical-align: middle;border-bottom: 0 solid rgba(0, 0, 0, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-1ab5e64c{width:0.897in;background-color:transparent;vertical-align: middle;border-bottom: 0 solid rgba(0, 0, 0, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-1ab5e64d{width:1.135in;background-color:transparent;vertical-align: middle;border-bottom: 0 solid rgba(0, 0, 0, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-1ab5e64e{width:1.22in;background-color:transparent;vertical-align: middle;border-bottom: 0 solid rgba(0, 0, 0, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-1ab5e656{width:0.897in;background-color:transparent;vertical-align: middle;border-bottom: 0 solid rgba(0, 0, 0, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-1ab5e657{width:1.135in;background-color:transparent;vertical-align: middle;border-bottom: 0 solid rgba(0, 0, 0, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-1ab5e660{width:1.22in;background-color:transparent;vertical-align: middle;border-bottom: 0 solid rgba(0, 0, 0, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-1ab5e661{width:0.897in;background-color:transparent;vertical-align: middle;border-bottom: 0 solid rgba(0, 0, 0, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-1ab5e66a{width:1.135in;background-color:transparent;vertical-align: middle;border-bottom: 0 solid rgba(0, 0, 0, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-1ab5e66b{width:1.22in;background-color:transparent;vertical-align: middle;border-bottom: 0 solid rgba(0, 0, 0, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-1ab5e674{width:0.897in;background-color:transparent;vertical-align: middle;border-bottom: 2pt solid rgba(102, 102, 102, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-1ab5e675{width:1.135in;background-color:transparent;vertical-align: middle;border-bottom: 2pt solid rgba(102, 102, 102, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-1ab5e67e{width:1.22in;background-color:transparent;vertical-align: middle;border-bottom: 2pt solid rgba(102, 102, 102, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}</style><table class="cl-1ab89b4e"><caption>Table&nbsp;2:  Criterios de información de los modelos. Mediante Validación cruzada. La tabla presenta los criterios AIC, RMSE, y MAE bajo un 5-fold cv. </caption><thead><tr style="overflow-wrap:break-word;"><td class="cl-1ab5e624"><p class="cl-1ab5da3a"><span class="cl-1ab3f27e">Criterio</span></p></td><td class="cl-1ab5e625"><p class="cl-1ab5da44"><span class="cl-1ab3f27e">q2.5%</span></p></td><td class="cl-1ab5e625"><p class="cl-1ab5da44"><span class="cl-1ab3f27e">Median</span></p></td><td class="cl-1ab5e62e"><p class="cl-1ab5da44"><span class="cl-1ab3f27e">q97.5%</span></p></td></tr></thead><tbody><tr style="overflow-wrap:break-word;"><td class="cl-1ab5e62f"><p class="cl-1ab5da3a"><span class="cl-1ab3f27e">AIC1</span></p></td><td class="cl-1ab5e638"><p class="cl-1ab5da44"><span class="cl-1ab3f27e">8,945.08657</span></p></td><td class="cl-1ab5e638"><p class="cl-1ab5da44"><span class="cl-1ab3f27e">9,828.51100</span></p></td><td class="cl-1ab5e639"><p class="cl-1ab5da44"><span class="cl-1ab3f27e">10,041.34538</span></p></td></tr><tr style="overflow-wrap:break-word;"><td class="cl-1ab5e62f"><p class="cl-1ab5da3a"><span class="cl-1ab3f27e">AIC3</span></p></td><td class="cl-1ab5e638"><p class="cl-1ab5da44"><span class="cl-1ab3f27e">1,792.73762</span></p></td><td class="cl-1ab5e638"><p class="cl-1ab5da44"><span class="cl-1ab3f27e">1,792.73762</span></p></td><td class="cl-1ab5e639"><p class="cl-1ab5da44"><span class="cl-1ab3f27e">1,792.73762</span></p></td></tr><tr style="overflow-wrap:break-word;"><td class="cl-1ab5e642"><p class="cl-1ab5da3a"><span class="cl-1ab3f27e">AIC31</span></p></td><td class="cl-1ab5e643"><p class="cl-1ab5da44"><span class="cl-1ab3f27e">1,834.89184</span></p></td><td class="cl-1ab5e643"><p class="cl-1ab5da44"><span class="cl-1ab3f27e">1,834.89184</span></p></td><td class="cl-1ab5e644"><p class="cl-1ab5da44"><span class="cl-1ab3f27e">1,834.89184</span></p></td></tr><tr style="overflow-wrap:break-word;"><td class="cl-1ab5e64c"><p class="cl-1ab5da3a"><span class="cl-1ab3f27e">RMSE1</span></p></td><td class="cl-1ab5e64d"><p class="cl-1ab5da44"><span class="cl-1ab3f27e">40.40095</span></p></td><td class="cl-1ab5e64d"><p class="cl-1ab5da44"><span class="cl-1ab3f27e">53.82194</span></p></td><td class="cl-1ab5e64e"><p class="cl-1ab5da44"><span class="cl-1ab3f27e">68.34730</span></p></td></tr><tr style="overflow-wrap:break-word;"><td class="cl-1ab5e64c"><p class="cl-1ab5da3a"><span class="cl-1ab3f27e">RMSE3</span></p></td><td class="cl-1ab5e64d"><p class="cl-1ab5da44"><span class="cl-1ab3f27e">40.32755</span></p></td><td class="cl-1ab5e64d"><p class="cl-1ab5da44"><span class="cl-1ab3f27e">53.74815</span></p></td><td class="cl-1ab5e64e"><p class="cl-1ab5da44"><span class="cl-1ab3f27e">68.03719</span></p></td></tr><tr style="overflow-wrap:break-word;"><td class="cl-1ab5e64c"><p class="cl-1ab5da3a"><span class="cl-1ab3f27e">RMSE31</span></p></td><td class="cl-1ab5e64d"><p class="cl-1ab5da44"><span class="cl-1ab3f27e">40.48745</span></p></td><td class="cl-1ab5e64d"><p class="cl-1ab5da44"><span class="cl-1ab3f27e">53.82948</span></p></td><td class="cl-1ab5e64e"><p class="cl-1ab5da44"><span class="cl-1ab3f27e">68.61177</span></p></td></tr><tr style="overflow-wrap:break-word;"><td class="cl-1ab5e656"><p class="cl-1ab5da3a"><span class="cl-1ab3f27e">MAE1</span></p></td><td class="cl-1ab5e657"><p class="cl-1ab5da44"><span class="cl-1ab3f27e">20.44436</span></p></td><td class="cl-1ab5e657"><p class="cl-1ab5da44"><span class="cl-1ab3f27e">24.42291</span></p></td><td class="cl-1ab5e660"><p class="cl-1ab5da44"><span class="cl-1ab3f27e">28.56326</span></p></td></tr><tr style="overflow-wrap:break-word;"><td class="cl-1ab5e661"><p class="cl-1ab5da3a"><span class="cl-1ab3f27e">MAE3</span></p></td><td class="cl-1ab5e66a"><p class="cl-1ab5da44"><span class="cl-1ab3f27e">20.30973</span></p></td><td class="cl-1ab5e66a"><p class="cl-1ab5da44"><span class="cl-1ab3f27e">24.35617</span></p></td><td class="cl-1ab5e66b"><p class="cl-1ab5da44"><span class="cl-1ab3f27e">28.40859</span></p></td></tr><tr style="overflow-wrap:break-word;"><td class="cl-1ab5e674"><p class="cl-1ab5da3a"><span class="cl-1ab3f27e">MAE31</span></p></td><td class="cl-1ab5e675"><p class="cl-1ab5da44"><span class="cl-1ab3f27e">20.66577</span></p></td><td class="cl-1ab5e675"><p class="cl-1ab5da44"><span class="cl-1ab3f27e">24.53436</span></p></td><td class="cl-1ab5e67e"><p class="cl-1ab5da44"><span class="cl-1ab3f27e">28.72089</span></p></td></tr></tbody></table></div>
</div>
</div>
</div>
<p><a href="#tbl-cv">Table&nbsp;2</a> compara los modelos de conteo, se observa que en la mayoría de criterios el modelo Binomial Negativa completo, presenta los mejores resultados y el mejor ajuste, por lo tanto, seleccionamos al modelo <span class="math inline">M_3</span> que este deberá ser comparado con el modelo log-normal.</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb16"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a>kfold1 <span class="ot">=</span> <span class="cf">function</span>(df,k){</span>
<span id="cb16-2"><a href="#cb16-2" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Generar la particion</span></span>
<span id="cb16-3"><a href="#cb16-3" aria-hidden="true" tabindex="-1"></a>  kfld <span class="ot">=</span> <span class="fu">createFolds</span>(df[,<span class="dv">1</span>],<span class="at">k =</span> k)</span>
<span id="cb16-4"><a href="#cb16-4" aria-hidden="true" tabindex="-1"></a>  mat <span class="ot">=</span> <span class="cn">NULL</span></span>
<span id="cb16-5"><a href="#cb16-5" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb16-6"><a href="#cb16-6" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>k) {</span>
<span id="cb16-7"><a href="#cb16-7" aria-hidden="true" tabindex="-1"></a>    <span class="co"># separar los datos en conjuntos de prueba y entrenamiento</span></span>
<span id="cb16-8"><a href="#cb16-8" aria-hidden="true" tabindex="-1"></a>    dfE<span class="ot">=</span> df[<span class="sc">-</span>kfld[[i]],]</span>
<span id="cb16-9"><a href="#cb16-9" aria-hidden="true" tabindex="-1"></a>    dfP <span class="ot">=</span> df[kfld[[i]],]</span>
<span id="cb16-10"><a href="#cb16-10" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Ajustar los modelos</span></span>
<span id="cb16-11"><a href="#cb16-11" aria-hidden="true" tabindex="-1"></a>    m2 <span class="ot">=</span> <span class="fu">lm</span>(y <span class="sc">~</span> .,<span class="at">data =</span> dfE)</span>
<span id="cb16-12"><a href="#cb16-12" aria-hidden="true" tabindex="-1"></a>    p2  <span class="ot">=</span> <span class="fu">predict</span>(m2,dfP)</span>
<span id="cb16-13"><a href="#cb16-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-14"><a href="#cb16-14" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Unir los datos</span></span>
<span id="cb16-15"><a href="#cb16-15" aria-hidden="true" tabindex="-1"></a>    mat <span class="ot">=</span> <span class="fu">rbind</span>(mat,<span class="fu">c</span>(<span class="fu">AIC</span>(m2),<span class="fu">RMSE</span>(<span class="at">pred =</span>  p2,<span class="at">obs =</span> dfP[,<span class="dv">1</span>]),<span class="fu">MAE</span>(<span class="at">pred =</span>  p2,<span class="at">obs =</span> dfP[,<span class="dv">1</span>]))) </span>
<span id="cb16-16"><a href="#cb16-16" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb16-17"><a href="#cb16-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">colnames</span>(mat) <span class="ot">=</span> <span class="fu">c</span>(<span class="st">"AIC1"</span>, <span class="st">"RMSE1"</span>,<span class="st">"MAE1"</span>)</span>
<span id="cb16-18"><a href="#cb16-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">row.names</span>(mat) <span class="ot">=</span> <span class="cn">NULL</span></span>
<span id="cb16-19"><a href="#cb16-19" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(mat)</span>
<span id="cb16-20"><a href="#cb16-20" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb16-21"><a href="#cb16-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-22"><a href="#cb16-22" aria-hidden="true" tabindex="-1"></a>rst <span class="ot">=</span> <span class="fu">kfold1</span>(<span class="at">df =</span> df,<span class="at">k =</span> <span class="dv">5</span>)</span>
<span id="cb16-23"><a href="#cb16-23" aria-hidden="true" tabindex="-1"></a>x <span class="ot">=</span> <span class="fu">t</span>(<span class="fu">apply</span>(rst,<span class="at">MARGIN =</span> <span class="dv">2</span>,<span class="at">FUN =</span> <span class="st">"quantile"</span>,<span class="at">probs =</span> <span class="fu">c</span>(<span class="fl">0.025</span>,<span class="fl">0.5</span>,<span class="fl">0.975</span>)))</span>
<span id="cb16-24"><a href="#cb16-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-25"><a href="#cb16-25" aria-hidden="true" tabindex="-1"></a><span class="co"># Estética</span></span>
<span id="cb16-26"><a href="#cb16-26" aria-hidden="true" tabindex="-1"></a>x <span class="ot">=</span> <span class="fu">data.frame</span>(x)</span>
<span id="cb16-27"><a href="#cb16-27" aria-hidden="true" tabindex="-1"></a>x<span class="sc">$</span>pars <span class="ot">=</span> <span class="fu">c</span>(<span class="st">"AIC2"</span>, <span class="st">"RMSE2"</span>,<span class="st">"MAE2"</span>)</span>
<span id="cb16-28"><a href="#cb16-28" aria-hidden="true" tabindex="-1"></a><span class="fu">colnames</span>(x) <span class="ot">=</span> <span class="fu">c</span>(<span class="st">"q2.5%"</span>,<span class="st">"Median"</span>,<span class="st">"q97.5%"</span>,<span class="st">"Criterio"</span>)</span>
<span id="cb16-29"><a href="#cb16-29" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-30"><a href="#cb16-30" aria-hidden="true" tabindex="-1"></a>ft <span class="ot">=</span> <span class="fu">flextable</span>(x[<span class="fu">c</span>(<span class="dv">4</span>,<span class="dv">1</span>,<span class="dv">2</span>,<span class="dv">3</span>)])</span>
<span id="cb16-31"><a href="#cb16-31" aria-hidden="true" tabindex="-1"></a><span class="fu">autofit</span>(ft)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div id="tbl-cv1" class="anchored">

<div class="tabwid"><style>.cl-1acd4508{}.cl-1ac8dc5c{font-family:'Helvetica';font-size:11pt;font-weight:normal;font-style:normal;text-decoration:none;color:rgba(0, 0, 0, 1.00);background-color:transparent;}.cl-1acab8e2{margin:0;text-align:left;border-bottom: 0 solid rgba(0, 0, 0, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);padding-bottom:5pt;padding-top:5pt;padding-left:5pt;padding-right:5pt;line-height: 1;background-color:transparent;}.cl-1acab8ec{margin:0;text-align:right;border-bottom: 0 solid rgba(0, 0, 0, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);padding-bottom:5pt;padding-top:5pt;padding-left:5pt;padding-right:5pt;line-height: 1;background-color:transparent;}.cl-1acac4ae{width:0.812in;background-color:transparent;vertical-align: middle;border-bottom: 2pt solid rgba(102, 102, 102, 1.00);border-top: 2pt solid rgba(102, 102, 102, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-1acac4b8{width:1.092in;background-color:transparent;vertical-align: middle;border-bottom: 2pt solid rgba(102, 102, 102, 1.00);border-top: 2pt solid rgba(102, 102, 102, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-1acac4b9{width:0.812in;background-color:transparent;vertical-align: middle;border-bottom: 0 solid rgba(0, 0, 0, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-1acac4c2{width:1.092in;background-color:transparent;vertical-align: middle;border-bottom: 0 solid rgba(0, 0, 0, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-1acac4cc{width:0.812in;background-color:transparent;vertical-align: middle;border-bottom: 0 solid rgba(0, 0, 0, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-1acac4cd{width:1.092in;background-color:transparent;vertical-align: middle;border-bottom: 0 solid rgba(0, 0, 0, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-1acac4ce{width:0.812in;background-color:transparent;vertical-align: middle;border-bottom: 2pt solid rgba(102, 102, 102, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-1acac4d6{width:1.092in;background-color:transparent;vertical-align: middle;border-bottom: 2pt solid rgba(102, 102, 102, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}</style><table class="cl-1acd4508"><caption>Table&nbsp;3:  Criterios de información del modelo log-N. Mediante Validación cruzada. La tabla presenta los criterios AIC, RMSE, y MAE bajo un 5-fold cv. </caption><thead><tr style="overflow-wrap:break-word;"><td class="cl-1acac4ae"><p class="cl-1acab8e2"><span class="cl-1ac8dc5c">Criterio</span></p></td><td class="cl-1acac4b8"><p class="cl-1acab8ec"><span class="cl-1ac8dc5c">q2.5%</span></p></td><td class="cl-1acac4b8"><p class="cl-1acab8ec"><span class="cl-1ac8dc5c">Median</span></p></td><td class="cl-1acac4b8"><p class="cl-1acab8ec"><span class="cl-1ac8dc5c">q97.5%</span></p></td></tr></thead><tbody><tr style="overflow-wrap:break-word;"><td class="cl-1acac4b9"><p class="cl-1acab8e2"><span class="cl-1ac8dc5c">AIC2</span></p></td><td class="cl-1acac4c2"><p class="cl-1acab8ec"><span class="cl-1ac8dc5c">408.952903</span></p></td><td class="cl-1acac4c2"><p class="cl-1acab8ec"><span class="cl-1ac8dc5c">411.807307</span></p></td><td class="cl-1acac4c2"><p class="cl-1acab8ec"><span class="cl-1ac8dc5c">420.114457</span></p></td></tr><tr style="overflow-wrap:break-word;"><td class="cl-1acac4cc"><p class="cl-1acab8e2"><span class="cl-1ac8dc5c">RMSE2</span></p></td><td class="cl-1acac4cd"><p class="cl-1acab8ec"><span class="cl-1ac8dc5c">1.166367</span></p></td><td class="cl-1acac4cd"><p class="cl-1acab8ec"><span class="cl-1ac8dc5c">1.295714</span></p></td><td class="cl-1acac4cd"><p class="cl-1acab8ec"><span class="cl-1ac8dc5c">1.403174</span></p></td></tr><tr style="overflow-wrap:break-word;"><td class="cl-1acac4ce"><p class="cl-1acab8e2"><span class="cl-1ac8dc5c">MAE2</span></p></td><td class="cl-1acac4d6"><p class="cl-1acab8ec"><span class="cl-1ac8dc5c">1.015279</span></p></td><td class="cl-1acac4d6"><p class="cl-1acab8ec"><span class="cl-1ac8dc5c">1.082387</span></p></td><td class="cl-1acac4d6"><p class="cl-1acab8ec"><span class="cl-1ac8dc5c">1.157660</span></p></td></tr></tbody></table></div>
</div>
</div>
</div>
<p>Contrario a los esperado, el modelo log-normal <span class="math inline">M_2</span> presenta mejores resultados que los modelos de conteos, por lo tanto el mejor modelo para medir el efecto de tratamientos en cucarachas desde un enfoque de aprendizaje es el modelo log-normal.</p>
<p>Es importante resaltar que las predicciones realizadas con el modelo <span class="math inline">M_2</span> se realizaron en escala logarítmica,</p>
<p><span class="math display">RMSE = \frac{1}{\sqrt n}||\hat{\log (y_P)} -\log (y_P)||_2</span> Es necesario revisar si al transformar de forma inversa el modelo mantiene las predicciones. En caso de evaluar las predicciones en la escala natural de los datos, corroborar si:</p>
<p><span class="math display">RMSE = \frac{1}{\sqrt n}||e^{\mu_p+0.5\sigma} -y_P||_2</span> Donde <span class="math inline">\mu_P</span> son las predicciones obtenidas del modelo en escala logarítmica.</p>
</section>
<section id="referencias" class="level2">




</section>

<div id="quarto-appendix" class="default"><section class="quarto-appendix-contents" role="doc-bibliography"><h2 class="anchored quarto-appendix-heading">Referencias</h2><div id="refs" class="references csl-bib-body hanging-indent" role="doc-bibliography">
<div id="ref-Casella" class="csl-entry" role="doc-biblioentry">
Casella, George, and Roger Berger. 2001. <em>Statistical Inference</em>. Duxbury Resource Center. <a href="http://www.amazon.fr/exec/obidos/ASIN/0534243126/citeulike04-21">http://www.amazon.fr/exec/obidos/ASIN/0534243126/citeulike04-21</a>.
</div>
<div id="ref-degroot2012" class="csl-entry" role="doc-biblioentry">
DeGroot, M. H., and M. J. Schervish. 2012. <em>Probability and Statistics</em>. Addison-Wesley. <a href="https://books.google.es/books?id=4TlEPgAACAAJ">https://books.google.es/books?id=4TlEPgAACAAJ</a>.
</div>
<div id="ref-gelman2013" class="csl-entry" role="doc-biblioentry">
Gelman, A., J. B. Carlin, H. S. Stern, D. B. Dunson, A. Vehtari, and D. B. Rubin. 2013. <em>Bayesian Data Analysis, Third Edition</em>. Chapman &amp; Hall/CRC Texts in Statistical Science. Taylor &amp; Francis. <a href="https://books.google.nl/books?id=ZXL6AQAAQBAJ">https://books.google.nl/books?id=ZXL6AQAAQBAJ</a>.
</div>
<div id="ref-Miggon2014" class="csl-entry" role="doc-biblioentry">
Migon, Helio, Dani Gamerman, and Francisco Louzada. 2014. <em>Statistical Inference. An Integrated Approach</em>. Chapman and Hall CRC Texts in Statistical Science. Chapman; Hall.
</div>
<div id="ref-BMLR2021" class="csl-entry" role="doc-biblioentry">
Roback, paul., and Julie. Legler. 2021. <em><span class="nocase">Beyond Multiple Linear Regression: Applied Generalized Linear Models an Multilevel Models in R</span></em>. <span>Boca Raton</span>.
</div>
</div></section></div></main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const disableStylesheet = (stylesheets) => {
    for (let i=0; i < stylesheets.length; i++) {
      const stylesheet = stylesheets[i];
      stylesheet.rel = 'prefetch';
    }
  }
  const enableStylesheet = (stylesheets) => {
    for (let i=0; i < stylesheets.length; i++) {
      const stylesheet = stylesheets[i];
      stylesheet.rel = 'stylesheet';
    }
  }
  const manageTransitions = (selector, allowTransitions) => {
    const els = window.document.querySelectorAll(selector);
    for (let i=0; i < els.length; i++) {
      const el = els[i];
      if (allowTransitions) {
        el.classList.remove('notransition');
      } else {
        el.classList.add('notransition');
      }
    }
  }
  const toggleColorMode = (alternate) => {
    // Switch the stylesheets
    const alternateStylesheets = window.document.querySelectorAll('link.quarto-color-scheme.quarto-color-alternate');
    manageTransitions('#quarto-margin-sidebar .nav-link', false);
    if (alternate) {
      enableStylesheet(alternateStylesheets);
      for (const sheetNode of alternateStylesheets) {
        if (sheetNode.id === "quarto-bootstrap") {
          toggleBodyColorMode(sheetNode);
        }
      }
    } else {
      disableStylesheet(alternateStylesheets);
      toggleBodyColorPrimary();
    }
    manageTransitions('#quarto-margin-sidebar .nav-link', true);
    // Switch the toggles
    const toggles = window.document.querySelectorAll('.quarto-color-scheme-toggle');
    for (let i=0; i < toggles.length; i++) {
      const toggle = toggles[i];
      if (toggle) {
        if (alternate) {
          toggle.classList.add("alternate");     
        } else {
          toggle.classList.remove("alternate");
        }
      }
    }
    // Hack to workaround the fact that safari doesn't
    // properly recolor the scrollbar when toggling (#1455)
    if (navigator.userAgent.indexOf('Safari') > 0 && navigator.userAgent.indexOf('Chrome') == -1) {
      manageTransitions("body", false);
      window.scrollTo(0, 1);
      setTimeout(() => {
        window.scrollTo(0, 0);
        manageTransitions("body", true);
      }, 40);  
    }
  }
  const isFileUrl = () => { 
    return window.location.protocol === 'file:';
  }
  const hasAlternateSentinel = () => {  
    let styleSentinel = getColorSchemeSentinel();
    if (styleSentinel !== null) {
      return styleSentinel === "alternate";
    } else {
      return false;
    }
  }
  const setStyleSentinel = (alternate) => {
    const value = alternate ? "alternate" : "default";
    if (!isFileUrl()) {
      window.localStorage.setItem("quarto-color-scheme", value);
    } else {
      localAlternateSentinel = value;
    }
  }
  const getColorSchemeSentinel = () => {
    if (!isFileUrl()) {
      const storageValue = window.localStorage.getItem("quarto-color-scheme");
      return storageValue != null ? storageValue : localAlternateSentinel;
    } else {
      return localAlternateSentinel;
    }
  }
  let localAlternateSentinel = 'default';
  // Dark / light mode switch
  window.quartoToggleColorScheme = () => {
    // Read the current dark / light value 
    let toAlternate = !hasAlternateSentinel();
    toggleColorMode(toAlternate);
    setStyleSentinel(toAlternate);
  };
  // Ensure there is a toggle, if there isn't float one in the top right
  if (window.document.querySelector('.quarto-color-scheme-toggle') === null) {
    const a = window.document.createElement('a');
    a.classList.add('top-right');
    a.classList.add('quarto-color-scheme-toggle');
    a.href = "";
    a.onclick = function() { try { window.quartoToggleColorScheme(); } catch {} return false; };
    const i = window.document.createElement("i");
    i.classList.add('bi');
    a.appendChild(i);
    window.document.body.appendChild(a);
  }
  // Switch to dark mode if need be
  if (hasAlternateSentinel()) {
    toggleColorMode(true);
  } 
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    target: function(trigger) {
      return trigger.previousElementSibling;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    setTimeout(function() {
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const cites = ref.parentNode.getAttribute('data-cites').split(' ');
    tippyHover(ref, function() {
      var popup = window.document.createElement('div');
      cites.forEach(function(cite) {
        var citeDiv = window.document.createElement('div');
        citeDiv.classList.add('hanging-indent');
        citeDiv.classList.add('csl-entry');
        var biblioDiv = window.document.getElementById('ref-' + cite);
        if (biblioDiv) {
          citeDiv.innerHTML = biblioDiv.innerHTML;
        }
        popup.appendChild(citeDiv);
      });
      return popup.innerHTML;
    });
  }
});
</script>
</div> <!-- /content -->



<script src="../../../site_libs/quarto-html/zenscroll-min.js"></script>
</body></html>