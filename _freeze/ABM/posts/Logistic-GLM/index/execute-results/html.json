{
  "hash": "742e5735c6423e5c3000311f594a78cd",
  "result": {
    "markdown": "---\ntitle: \"Sobrevivencia en el Titani\"\nsubtitle: \"GLMs logísticos\"\nauthor: \"Asael Alonzo Matamoros\"\ndate: \"2022-11-22\"\ncategories: [Binomial,GLM,code,analysis]\nimage: \"image.jpg\"\nbibliography: ref.bib\nformat: \n  html:\n    toc: true\n    code-copy: true\n    smooth-scroll: true\n    anchor-sections: true\n---\n\n\nEste post presenta un análisis la base `Titanic` usando un modelo lineal generalizado Logístico.\n\nEl nombre del barco \"Titanic\" se inspira de los titanes de la mitología Griega, y pese que fue de los cruceros más grandes de su época, se hundió en su primera excursión, ocasionando la muerte de miles de sus tripulantes. Se desea crear un modelo que prediga el número de sobrevivientes en la excursión, para eso utilizaremos los registros de muerte del evento, la base de datos se divide en dos conjuntos\n\n  + `Train`: que contiene 891 registros, usado para entrenar los modelos de clasificación.\n  \n  + `Test`: contiene 418 registros, para corroborar las predicciones del modelo, pero la variable de interés no se encuentra en el conjunto de datos.\n\n\n\n::: {.cell}\n\n```{.r .cell-code  code-fold=\"true\"}\nlibrary(caret)\nlibrary(GGally)\nlibrary(ggplot2)\nlibrary(flextable)\nlibrary(bayesplot)\nlibrary(ggfortify)\n\nbayesplot_theme_set(theme_grey())\n\nload(\"Titanic.RData\")\n```\n:::\n\n\nLa base de datos `Train` contiene las siguiente variables:\n\n + `survival`: Indica si la sobrevivencia del pasajero. (**Dependiente**)\n\n + `pclass`: La clase de abordaje en el boleto. (`1 = \"1st\"`, `2 = '2nd\"` y `3 = \"3rd\"`)\n\n + `sex`: Género de los pasajeros.\n \n + `Age`: Edad en años.\n \n + `sibsp`: número de parientes/esposas a bordo.\n \n + `parh`: número de padres/hijos a bordo.\n \n + `ticket`: número del boleto.\n \n + `fare`: precio del boleto.\n \n + `cabin`: número de cabina.\n \n + `embarked`: Puerto de embarcación. `C = Chersbourg`, `Q = Queenstown`, y `S = Southampton`.\n \n## Verosimilitud\n \nLa variable `survival` es una variable indicadora que representa si el pasajero abordo sobrevivió el hundimiento del Titanic. Dado que es una v.a. discreta y dicotómica se puede modelar con una distribución de Bernoulli.\n\n$$y_i \\sim Bernoulli(p), \\quad y_i = 0,1. \\quad \\& \\quad f(y) = p^y(1-p)^{(1-y)}.$$\nDonde $p$ representa la probabilidad de éxito (`éxito := 1`), que indica que el paciente sobrevivió. \n \nPara este tipo de modelos se utilizan GLMs Logísticos, cuya estructura se presenta en la siguiente ecuación:\n\n$$y_i \\sim \\text{Bernoulli}(p_i),\\quad g(p) = \\text{logit}(p_i), \\text{ y } p_i = \\frac{1}{1 + e^{-\\beta X_i}}.$$\nDonde:\n\n  + $g:\\mathbb R \\to \\mathbb R$, es la función logit $g(x) = \\log\\left(\\frac{p}{1-p}\\right)$.\n  \n  +  $g^{-1}(x) = \\frac{1}{1 + e^{-x}}$ es la función logística.\n  \n  + $X$ son las covariables.\n\nFinalmente, realizamos un gráfico de correlaciones para identificar las interacciones lineales entre variables.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nggpairs(Train[,-1])\n```\n\n::: {.cell-output-display}\n![Gráfico de pares. La diagonal principal muestra histogramas densidades de cada una de las variables. La parte superior muestra el coeficiente de correlación entre dos variables, fila y columna. La parte inferior muestra un gráfico de dispersión entre dos variables.](index_files/figure-html/fig-pairs-1.png){#fig-pairs width=864}\n:::\n:::\n\n\nLa @fig-pairs es poco informativa debido que múltiples variables, incluida la de interés, son variables discretas. Una forma alternativa de medir la dispersión en v.a.d. es usar gráficos de barras compuestos o gráfico de bombones. Para medir correlación un indicador no paramétrico equivalente, es el coeficiente de [Kendall](https://en.wikipedia.org/wiki/Kendall_rank_correlation_coefficient). \n\n## Ajuste del GLM Logístico\n\nAjustamos el modelo GLM logístico completo que consiste en usar todas las variables, y revisamos el ajuste e inferencia de los parámetros.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nm1  = glm(Survived ~ Pclass + Sex + Age + SibSp + Parch + Fare,\n            data = Train, family = \"binomial\")\n\nsummary(m1)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n\nCall:\nglm(formula = Survived ~ Pclass + Sex + Age + SibSp + Parch + \n    Fare, family = \"binomial\", data = Train)\n\nDeviance Residuals: \n    Min       1Q   Median       3Q      Max  \n-2.7953  -0.6476  -0.3847   0.6271   2.4433  \n\nCoefficients:\n             Estimate Std. Error z value Pr(>|z|)    \n(Intercept)  5.389003   0.603734   8.926  < 2e-16 ***\nPclass      -1.242249   0.163191  -7.612 2.69e-14 ***\nSexmale     -2.634845   0.219609 -11.998  < 2e-16 ***\nAge         -0.043953   0.008179  -5.374 7.70e-08 ***\nSibSp       -0.375755   0.127361  -2.950  0.00317 ** \nParch       -0.061937   0.122925  -0.504  0.61436    \nFare         0.002160   0.002493   0.866  0.38627    \n---\nSignif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1\n\n(Dispersion parameter for binomial family taken to be 1)\n\n    Null deviance: 964.52  on 713  degrees of freedom\nResidual deviance: 635.81  on 707  degrees of freedom\n  (177 observations deleted due to missingness)\nAIC: 649.81\n\nNumber of Fisher Scoring iterations: 5\n```\n:::\n:::\n\n\nEl modelo completo da una impresión con buenos resultados, todas las variables excepto el precio de boletos (`Fare`) y el número de Padres/hijos (`parch`) resultaron significativas; pero los residuos no están centrados en cero, por ende no cumplen los supuestos iniciales. \n\nEl siguiente código genera una muestra Bootstrap para los parámetros del modelo $M_1$.\n\n\n::: {.cell}\n\n```{.r .cell-code  code-fold=\"true\"}\nglm_boots = function(dat,B = 1000){\n  n = dim(dat)[1]\n  est = NULL\n  for (i in 1:B) {\n    si = sample(x = 1:n,size = n,replace = TRUE)\n    dsi = dat[si,]\n    mli = glm(Survived ~ Pclass + Sex + Age + SibSp + Parch + Fare,\n              data = dsi,family = binomial)\n    ci = as.array(mli$coefficients)\n    est = rbind(est,ci)\n  }\n  # Estética\n  return(est)\n}\n```\n:::\n\n\nObtenemos una muestra Bootstrap para los estimadores $\\hat \\beta$ de tamaño $B = 2,000$ repeticiones.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nbtp = glm_boots(dat = Train,B = 2000)\n\ncolor_scheme_set(\"green\")\nmcmc_dens(btp)+labs(title=\"Distribución muestral de los estimadores, GLM Logístico\",\n                    subtitle =\"Bootstrap B = 2,000 iteraciones\")\n```\n\n::: {.cell-output-display}\n![Gráfico de densidades. Cada densidad representa la distribución muestral aproximada para cada uno de los estimadores usando un Bootstrap de B = 2,000 iteraciones.](index_files/figure-html/fig-btp1-1.png){#fig-btp1 width=672}\n:::\n:::\n\n\nLos intervalos de confianza al 95% son:\n\n\n::: {#tbl-btp1 .cell tbl-cap='Intervalos de confianza al 95%, obtenidos a partir de una muestra bootstrap de B = 2,000 iteraciones'}\n\n```{.r .cell-code}\nx = apply(btp,MARGIN = 2, FUN = quantile, probs = c(0.025,0.5,0.975)) \n\n# Estética\nx = data.frame( t(x) )\nx$pars = c(\"intercepto\",\"Pclass\",\"Sexmal\",\"Age\",\"SibSp\",\"Parch\",\"Fare\")\ncolnames(x) = c(\"q2.5%\",\"Median\",\"q97.5%\",\"parámetros\")\n\nft = flextable(x[c(4,1,2,3)])\nautofit(ft)\n```\n\n::: {.cell-output-display}\n```{=html}\n<div class=\"tabwid\"><style>.cl-4b11dd54{}.cl-4b0b5f92{font-family:'Helvetica';font-size:11pt;font-weight:normal;font-style:normal;text-decoration:none;color:rgba(0, 0, 0, 1.00);background-color:transparent;}.cl-4b0da90a{margin:0;text-align:left;border-bottom: 0 solid rgba(0, 0, 0, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);padding-bottom:5pt;padding-top:5pt;padding-left:5pt;padding-right:5pt;line-height: 1;background-color:transparent;}.cl-4b0da91e{margin:0;text-align:right;border-bottom: 0 solid rgba(0, 0, 0, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);padding-bottom:5pt;padding-top:5pt;padding-left:5pt;padding-right:5pt;line-height: 1;background-color:transparent;}.cl-4b0db88c{width:1.058in;background-color:transparent;vertical-align: middle;border-bottom: 2pt solid rgba(102, 102, 102, 1.00);border-top: 2pt solid rgba(102, 102, 102, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-4b0db896{width:1.228in;background-color:transparent;vertical-align: middle;border-bottom: 2pt solid rgba(102, 102, 102, 1.00);border-top: 2pt solid rgba(102, 102, 102, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-4b0db897{width:1.058in;background-color:transparent;vertical-align: middle;border-bottom: 0 solid rgba(0, 0, 0, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-4b0db8a0{width:1.228in;background-color:transparent;vertical-align: middle;border-bottom: 0 solid rgba(0, 0, 0, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-4b0db8a1{width:1.058in;background-color:transparent;vertical-align: middle;border-bottom: 0 solid rgba(0, 0, 0, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-4b0db8aa{width:1.228in;background-color:transparent;vertical-align: middle;border-bottom: 0 solid rgba(0, 0, 0, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-4b0db8ab{width:1.058in;background-color:transparent;vertical-align: middle;border-bottom: 0 solid rgba(0, 0, 0, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-4b0db8b4{width:1.228in;background-color:transparent;vertical-align: middle;border-bottom: 0 solid rgba(0, 0, 0, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-4b0db8b5{width:1.058in;background-color:transparent;vertical-align: middle;border-bottom: 0 solid rgba(0, 0, 0, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-4b0db8b6{width:1.228in;background-color:transparent;vertical-align: middle;border-bottom: 0 solid rgba(0, 0, 0, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-4b0db8be{width:1.058in;background-color:transparent;vertical-align: middle;border-bottom: 0 solid rgba(0, 0, 0, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-4b0db8bf{width:1.228in;background-color:transparent;vertical-align: middle;border-bottom: 0 solid rgba(0, 0, 0, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-4b0db8c8{width:1.058in;background-color:transparent;vertical-align: middle;border-bottom: 2pt solid rgba(102, 102, 102, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-4b0db8c9{width:1.228in;background-color:transparent;vertical-align: middle;border-bottom: 2pt solid rgba(102, 102, 102, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}</style><table class='cl-4b11dd54'><caption></caption><thead><tr style=\"overflow-wrap:break-word;\"><td class=\"cl-4b0db88c\"><p class=\"cl-4b0da90a\"><span class=\"cl-4b0b5f92\">parámetros</span></p></td><td class=\"cl-4b0db896\"><p class=\"cl-4b0da91e\"><span class=\"cl-4b0b5f92\">q2.5%</span></p></td><td class=\"cl-4b0db896\"><p class=\"cl-4b0da91e\"><span class=\"cl-4b0b5f92\">Median</span></p></td><td class=\"cl-4b0db896\"><p class=\"cl-4b0da91e\"><span class=\"cl-4b0b5f92\">q97.5%</span></p></td></tr></thead><tbody><tr style=\"overflow-wrap:break-word;\"><td class=\"cl-4b0db897\"><p class=\"cl-4b0da90a\"><span class=\"cl-4b0b5f92\">intercepto</span></p></td><td class=\"cl-4b0db8a0\"><p class=\"cl-4b0da91e\"><span class=\"cl-4b0b5f92\">4.334260675</span></p></td><td class=\"cl-4b0db8a0\"><p class=\"cl-4b0da91e\"><span class=\"cl-4b0b5f92\">5.439635093</span></p></td><td class=\"cl-4b0db8a0\"><p class=\"cl-4b0da91e\"><span class=\"cl-4b0b5f92\">6.745395492</span></p></td></tr><tr style=\"overflow-wrap:break-word;\"><td class=\"cl-4b0db8a1\"><p class=\"cl-4b0da90a\"><span class=\"cl-4b0b5f92\">Pclass</span></p></td><td class=\"cl-4b0db8aa\"><p class=\"cl-4b0da91e\"><span class=\"cl-4b0b5f92\">-1.639020256</span></p></td><td class=\"cl-4b0db8aa\"><p class=\"cl-4b0da91e\"><span class=\"cl-4b0b5f92\">-1.248013748</span></p></td><td class=\"cl-4b0db8aa\"><p class=\"cl-4b0da91e\"><span class=\"cl-4b0b5f92\">-0.920773130</span></p></td></tr><tr style=\"overflow-wrap:break-word;\"><td class=\"cl-4b0db8ab\"><p class=\"cl-4b0da90a\"><span class=\"cl-4b0b5f92\">Sexmal</span></p></td><td class=\"cl-4b0db8b4\"><p class=\"cl-4b0da91e\"><span class=\"cl-4b0b5f92\">-3.103889872</span></p></td><td class=\"cl-4b0db8b4\"><p class=\"cl-4b0da91e\"><span class=\"cl-4b0b5f92\">-2.670659414</span></p></td><td class=\"cl-4b0db8b4\"><p class=\"cl-4b0da91e\"><span class=\"cl-4b0b5f92\">-2.236386690</span></p></td></tr><tr style=\"overflow-wrap:break-word;\"><td class=\"cl-4b0db8b5\"><p class=\"cl-4b0da90a\"><span class=\"cl-4b0b5f92\">Age</span></p></td><td class=\"cl-4b0db8b6\"><p class=\"cl-4b0da91e\"><span class=\"cl-4b0b5f92\">-0.061857970</span></p></td><td class=\"cl-4b0db8b6\"><p class=\"cl-4b0da91e\"><span class=\"cl-4b0b5f92\">-0.044474501</span></p></td><td class=\"cl-4b0db8b6\"><p class=\"cl-4b0da91e\"><span class=\"cl-4b0b5f92\">-0.028015033</span></p></td></tr><tr style=\"overflow-wrap:break-word;\"><td class=\"cl-4b0db8be\"><p class=\"cl-4b0da90a\"><span class=\"cl-4b0b5f92\">SibSp</span></p></td><td class=\"cl-4b0db8bf\"><p class=\"cl-4b0da91e\"><span class=\"cl-4b0b5f92\">-0.650111165</span></p></td><td class=\"cl-4b0db8bf\"><p class=\"cl-4b0da91e\"><span class=\"cl-4b0b5f92\">-0.388576745</span></p></td><td class=\"cl-4b0db8bf\"><p class=\"cl-4b0da91e\"><span class=\"cl-4b0b5f92\">-0.140536577</span></p></td></tr><tr style=\"overflow-wrap:break-word;\"><td class=\"cl-4b0db8a1\"><p class=\"cl-4b0da90a\"><span class=\"cl-4b0b5f92\">Parch</span></p></td><td class=\"cl-4b0db8aa\"><p class=\"cl-4b0da91e\"><span class=\"cl-4b0b5f92\">-0.308640960</span></p></td><td class=\"cl-4b0db8aa\"><p class=\"cl-4b0da91e\"><span class=\"cl-4b0b5f92\">-0.059430606</span></p></td><td class=\"cl-4b0db8aa\"><p class=\"cl-4b0da91e\"><span class=\"cl-4b0b5f92\">0.181213922</span></p></td></tr><tr style=\"overflow-wrap:break-word;\"><td class=\"cl-4b0db8c8\"><p class=\"cl-4b0da90a\"><span class=\"cl-4b0b5f92\">Fare</span></p></td><td class=\"cl-4b0db8c9\"><p class=\"cl-4b0da91e\"><span class=\"cl-4b0b5f92\">-0.003236097</span></p></td><td class=\"cl-4b0db8c9\"><p class=\"cl-4b0da91e\"><span class=\"cl-4b0b5f92\">0.002371131</span></p></td><td class=\"cl-4b0db8c9\"><p class=\"cl-4b0da91e\"><span class=\"cl-4b0b5f92\">0.008264565</span></p></td></tr></tbody></table></div>\n```\n:::\n:::\n\n\nLa @fig-btp1 muestra la distribución muestral de los estimadores del modelo, y la @tbl-btp1 muestra los intervalos de confianza.El efecto de las variables `Fare` y `Parxh` está concentrado en cero, por lo tanto, se deberá considerar un GLM logístico reducido.\n\nLos residuos no son una medida correcta para evaluar el ajuste del modelo. Esto se debe a que el modelo predice de forma continua valores en el intervalo unitario $I = [0,1]$ y los datos son los enteros en la clausura de $I$. Una forma adecuada de visualizar los residuos es usando la matriz de confusión, esta es una matriz en $\\mathbb{R}^{2 \\times 2}$ que presenta el ajuste del modelo.\n\n$$\n CM = \\begin{pmatrix}\n    P & FP\\\\\n    FN & N\n \\end{pmatrix}\n$$\nDonde: \n \n  + $P$ representa los valores predichos correctamente como positivos (1).\n  \n  + $N$ representa los valores predichos correctamente como negativos (0).\n  \n  + $FP$ representan los valores falsos positivos, $\\hat y = 1$ cuando $y = 0$.\n  \n  + $FN$ representan los valores falsos negativos, $\\hat y = 0$ cuando $y = 1$.\n\n\n::: {.cell}\n\n```{.r .cell-code}\npred1 = predict(m1,Train[,-c(1:2)],type = \"response\")\npred1 =  ifelse(pred1 > 0.5, 1, 0)\n   \nx = table(pred1, Train$Survived)\nx = round(prop.table(x)*100,2)\nx\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n     \npred1     0     1\n    0 50.98 11.20\n    1  8.40 29.41\n```\n:::\n:::\n\n  \nUna medida importante es la precisión (*\"Accuracy\"*) del modelo, que es el porcentaje de aciertos del modelo. Que se calcula como la suma de las diagonales en la matriz de confusión.\nEl accuracy para el modelo $M_1$ es:\n\n\n::: {.cell}\n\n```{.r .cell-code}\nAccuracy = sum(diag(x))\nAccuracy\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n[1] 80.39\n```\n:::\n:::\n\n\n## Selección de modelos, 10-fold-CV\n\nPara seleccionar el mejor modelo usaremos validación cruzada, 10-fold, esto implica que ajustaremos diez veces cada modelo, evaluando la precisión del modelo. Los modelos que se consideraran son los siguientes:\n\n + $M_1:$ Modelo de logístico completo\n \n + $M_2:$ Modelo logístico reducido sin la variable `Parch`.\n \n + $M_3:$ Modelo logístico reducido sin variables `Parch` y `Fare`.\n\nEl siguiente código presenta una función para realizar **k-fold-CV** para cualquier valor de $k$. En caso de querer añadir otros modelos o criterios, la función deberá ser modificada.\n\n\n::: {.cell}\n\n```{.r .cell-code  code-fold=\"true\"}\nkfold = function(df,k){\n  # Generar la particion\n  kfld = createFolds(df[,1],k = k)\n  mat = NULL\n  \n  for (i in 1:k) {\n    # separar los datos en conjuntos de prueba y entrenamiento\n    dfE= df[-kfld[[i]],]\n    dfP = df[kfld[[i]],]\n    # Ajustar los modelos\n    m1  = glm(Survived ~ Pclass + Sex + Age + SibSp + Parch + Fare,\n              data = dfE,family = binomial)\n    m2 = glm(Survived ~ Pclass + Sex + Age + SibSp + Fare,\n              data = dfE,family = binomial)\n    m3  = glm(Survived ~ Pclass + Sex + Age + SibSp,\n              data = dfE,family = binomial)\n\n    \n    p1  = predict(m1,dfP,type = \"response\")\n    p1 =  ifelse(p1 > 0.5, 1, 0)\n    p2 = predict(m2,dfP,type = \"response\")\n    p2 =  ifelse(p2 > 0.5, 1, 0)\n    p3  = predict(m3,dfP,type = \"response\")\n    p3 =  ifelse(p3 > 0.5, 1, 0)\n\n    Accuracy = c(\n      sum(diag(round(prop.table(table(p1, dfP[,2]))*100,2))),\n      sum(diag(round(prop.table(table(p2, dfP[,2]))*100,2))),\n      sum(diag(round(prop.table(table(p3, dfP[,2]))*100,2)))\n    )\n\n    # Unir los datos\n    mat = rbind(mat,Accuracy) \n  }\n  colnames(mat) = c(\"Accuracy1\",\"Accuracy2\",\"Accuracy3\")\n  row.names(mat) = NULL\n  return(mat)\n}\n```\n:::\n\n\n@tbl-cv presenta los resultados obtenidos al realizar 10-fold-cv, el modelo $M_3$ es el que presenta la mejor precisión de los tres modelos evaluados.\n\n\n::: {#tbl-cv .cell tbl-cap='Precisión de los modelos. Mediante Validación cruzada.'}\n\n```{.r .cell-code}\nrst = kfold(df = na.exclude(Train),k = 10)\nx = t(apply(rst,MARGIN = 2,FUN = \"quantile\",probs = c(0.025,0.5,0.975)))\n\n# Estética\nx = data.frame(x)\nx$pars =  c(\"Accuracy1\", \"Accuracy2\", \"Accuracy3\")\ncolnames(x) = c(\"q2.5%\",\"Median\",\"q97.5%\",\"Criterio\")\n\nft = flextable(x[c(4,1,2,3)])\nautofit(ft)\n```\n\n::: {.cell-output-display}\n```{=html}\n<div class=\"tabwid\"><style>.cl-4b3a4212{}.cl-4b35dfec{font-family:'Helvetica';font-size:11pt;font-weight:normal;font-style:normal;text-decoration:none;color:rgba(0, 0, 0, 1.00);background-color:transparent;}.cl-4b37b6fa{margin:0;text-align:left;border-bottom: 0 solid rgba(0, 0, 0, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);padding-bottom:5pt;padding-top:5pt;padding-left:5pt;padding-right:5pt;line-height: 1;background-color:transparent;}.cl-4b37b704{margin:0;text-align:right;border-bottom: 0 solid rgba(0, 0, 0, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);padding-bottom:5pt;padding-top:5pt;padding-left:5pt;padding-right:5pt;line-height: 1;background-color:transparent;}.cl-4b37c244{width:0.998in;background-color:transparent;vertical-align: middle;border-bottom: 2pt solid rgba(102, 102, 102, 1.00);border-top: 2pt solid rgba(102, 102, 102, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-4b37c245{width:0.752in;background-color:transparent;vertical-align: middle;border-bottom: 2pt solid rgba(102, 102, 102, 1.00);border-top: 2pt solid rgba(102, 102, 102, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-4b37c24e{width:0.786in;background-color:transparent;vertical-align: middle;border-bottom: 2pt solid rgba(102, 102, 102, 1.00);border-top: 2pt solid rgba(102, 102, 102, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-4b37c258{width:0.922in;background-color:transparent;vertical-align: middle;border-bottom: 2pt solid rgba(102, 102, 102, 1.00);border-top: 2pt solid rgba(102, 102, 102, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-4b37c259{width:0.998in;background-color:transparent;vertical-align: middle;border-bottom: 0 solid rgba(0, 0, 0, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-4b37c25a{width:0.752in;background-color:transparent;vertical-align: middle;border-bottom: 0 solid rgba(0, 0, 0, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-4b37c262{width:0.786in;background-color:transparent;vertical-align: middle;border-bottom: 0 solid rgba(0, 0, 0, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-4b37c26c{width:0.922in;background-color:transparent;vertical-align: middle;border-bottom: 0 solid rgba(0, 0, 0, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-4b37c26d{width:0.998in;background-color:transparent;vertical-align: middle;border-bottom: 2pt solid rgba(102, 102, 102, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-4b37c276{width:0.752in;background-color:transparent;vertical-align: middle;border-bottom: 2pt solid rgba(102, 102, 102, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-4b37c277{width:0.786in;background-color:transparent;vertical-align: middle;border-bottom: 2pt solid rgba(102, 102, 102, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-4b37c280{width:0.922in;background-color:transparent;vertical-align: middle;border-bottom: 2pt solid rgba(102, 102, 102, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}</style><table class='cl-4b3a4212'><caption></caption><thead><tr style=\"overflow-wrap:break-word;\"><td class=\"cl-4b37c244\"><p class=\"cl-4b37b6fa\"><span class=\"cl-4b35dfec\">Criterio</span></p></td><td class=\"cl-4b37c245\"><p class=\"cl-4b37b704\"><span class=\"cl-4b35dfec\">q2.5%</span></p></td><td class=\"cl-4b37c24e\"><p class=\"cl-4b37b704\"><span class=\"cl-4b35dfec\">Median</span></p></td><td class=\"cl-4b37c258\"><p class=\"cl-4b37b704\"><span class=\"cl-4b35dfec\">q97.5%</span></p></td></tr></thead><tbody><tr style=\"overflow-wrap:break-word;\"><td class=\"cl-4b37c259\"><p class=\"cl-4b37b6fa\"><span class=\"cl-4b35dfec\">Accuracy1</span></p></td><td class=\"cl-4b37c25a\"><p class=\"cl-4b37b704\"><span class=\"cl-4b35dfec\">73.763</span></p></td><td class=\"cl-4b37c262\"><p class=\"cl-4b37b704\"><span class=\"cl-4b35dfec\">80.430</span></p></td><td class=\"cl-4b37c26c\"><p class=\"cl-4b37b704\"><span class=\"cl-4b35dfec\">85.48725</span></p></td></tr><tr style=\"overflow-wrap:break-word;\"><td class=\"cl-4b37c259\"><p class=\"cl-4b37b6fa\"><span class=\"cl-4b35dfec\">Accuracy2</span></p></td><td class=\"cl-4b37c25a\"><p class=\"cl-4b37b704\"><span class=\"cl-4b35dfec\">73.763</span></p></td><td class=\"cl-4b37c262\"><p class=\"cl-4b37b704\"><span class=\"cl-4b35dfec\">80.555</span></p></td><td class=\"cl-4b37c26c\"><p class=\"cl-4b37b704\"><span class=\"cl-4b35dfec\">85.44000</span></p></td></tr><tr style=\"overflow-wrap:break-word;\"><td class=\"cl-4b37c26d\"><p class=\"cl-4b37b6fa\"><span class=\"cl-4b35dfec\">Accuracy3</span></p></td><td class=\"cl-4b37c276\"><p class=\"cl-4b37b704\"><span class=\"cl-4b35dfec\">73.763</span></p></td><td class=\"cl-4b37c277\"><p class=\"cl-4b37b704\"><span class=\"cl-4b35dfec\">80.555</span></p></td><td class=\"cl-4b37c280\"><p class=\"cl-4b37b704\"><span class=\"cl-4b35dfec\">85.44000</span></p></td></tr></tbody></table></div>\n```\n:::\n:::\n\n\n@tbl-cv compara los tres modelos, usando la medida de precisión, y el modelo reducido $M_3$ tiene resultados ligeramente mejores. Finalmente,  se predice en el conjunto de prueba, la @fig-pred presenta las predicciones realizadas por el modelo $M_3$ para 332 pasajeros, donde la mayoría de ellos no sobreviven al hundimiento del barco.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nm3 = glm(Survived ~ Pclass + Sex + Age + SibSp,\n              data = Train,family = binomial)\n\np3  = predict(m3,Test,type = \"response\")\np3 =  ifelse(na.exclude(p3) > 0.5, 1, 0)\np3 = data.frame(p3)\n\nggplot(p3, aes(x=as.factor(p3), fill=as.factor(p3) )) + \n  geom_bar( ) + scale_fill_hue(c = 40) +\n  labs(title = \"Predicciones de la sobrevivencia de los pasajeros, Titanic\",\n       subtitle = \"Conjunto de Prueba\",\n       x = \"Sobrevivencia\",y = \"Conteo\")+theme(legend.position=\"none\")\n```\n\n::: {.cell-output-display}\n![Gráfico de predicciones. La barra roja presenta el número de pasajeros que no sobrevivieron al hundimiento del Titanic.](index_files/figure-html/fig-pred-1.png){#fig-pred width=672}\n:::\n:::\n\n\n## Referencias\n\n\n---\nnocite: |\n @Casella @degroot2012 @Miggon2014 @gelman2013 @BMLR2021 @BMCP2021\n---\n\n\n::: {#refs}\n:::\n",
    "supporting": [
      "index_files"
    ],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {
      "include-in-header": [
        "<link href=\"../../../site_libs/tabwid-1.1.0/tabwid.css\" rel=\"stylesheet\" />\n<link href=\"../../../site_libs/tabwid-1.1.0/scrool.css\" rel=\"stylesheet\" />\n"
      ]
    },
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}