{
  "hash": "76e73f0c85e5bbcb3f90d5e4324b7c03",
  "result": {
    "markdown": "---\ntitle: \"Sobrevivencia en el Titanic, parte 2\"\nsubtitle: \"GAMs logísticos\"\nauthor: \"Asael Alonzo Matamoros\"\ndate: \"2022-11-24\"\ncategories: [Binomial,GAM,code,analysis]\nimage: \"image.jpg\"\nbibliography: ref.bib\nformat: \n  html:\n    toc: true\n    code-copy: true\n    smooth-scroll: true\n    anchor-sections: true\n---\n\n\nEste post presenta un análisis la base `Titanic` usando un modelo aditivo generalizado logístico.\n\nLos modelos aditivos generalizados (GAMs) relacionan forma no lineal al conjunto de v.a. independientes $Z = \\{Z_1,Z_2,\\ldots,Z_n\\}$, tal que $Z_i = (Y_i,X_i) \\in \\mathbb R^{d+1}$. La colección $Z$ sigue un GAM si: \n\n$$Y_i \\sim \\mathscr{F}_\\varepsilon (\\theta_i), \\quad \\text{y } g(\\theta_i) = \\sum_{s = 1}^mf_s(X_i),$$\nDonde: \n\n + $\\mathscr{F}_\\varepsilon$ representa la familia exponencial.\n \n + El conjunto $\\theta = \\{\\theta_i\\}$ representa una colección de parámetros de locación.\n \n + $g: \\mathbb R \\to \\mathbb R$ es una función diferenciable e invertible, conocida como la **función de enlace**.\n \n + $\\beta \\in \\mathbb R^{d+1}$ es el vector de coeficientes de regresión o importancias.\n \n + las funciones $f_s:\\mathbb{R}^d \\to \\mathbb R$ son suaves y diferenciables, de tal forma que, se pueden aproximar mediante la siguiente expresión: \n\n$$f_s(X) \\approx \\sum^K_{k = 1}\\beta_{k,s} b_{k,s}(X),$$ \n  \n  + donde $\\beta_{k,s}$ son los coeficientes por estimar y $b_{k,s}(X)$ son una base de funciones *\"conocidas.\"*  \n  \nDado que  \n$$B_s(X) = [b_{1,s}(X),b_{2,s}(X),\\ldots,b_{K,s}(X)],$$ \nes una base, entonces los $b_{k,s}(X)$ son una colección linealmente independiente en un espacio de funciones ($L_2$). Este resultado implica que estimar la función no lineal $f_s(X)$ es equivalente a resolver el problema de **regresión lineal:** \n\n$$\\hat f_s(X) = B_s(X) \\hat \\beta.$$\nEste tipo de modelos tiene dos limitantes, el primero es seleccionar una base adecuada, y segundo elegir el número de óptimo de elementos en la base $K$. Si $K$ es muy grande el modelo sobre-ajusta los datos (*overfitting*). Una solución es penalizar el suavizado con:\n\n$$P(f) = \\int \\partial^2f^2(x) dx.$$\nPor lo tanto, el problema de optimización se escribe como:\n\n$$\\hat \\beta_s = \\arg \\min_\\beta ||g^{-1}(y) - f_s(X)||^2 + \\lambda P(f),$$\n$$\\hat \\beta_s = \\arg \\min_\\beta || g^{-1}(y) - B_s(X)\\beta ||^2 + \\lambda \\beta^tS\\beta.$$\n\nDonde $S = \\int B_s^t(X)B_s(X) dx$, es la penalización. Note que el problema de optimización anterior es equivalente a resolver un problema de regresión lineal penalizado, que a su vez puede ser re-escrito como un problema de regresión lineal completo. \n\n## Ejemplo: mcycle dataset \n\n\n::: {.cell}\n\n```{.r .cell-code  code-fold=\"true\"}\nlibrary(mgcv)\nlibrary(caret)\nlibrary(tidymv)\nlibrary(GGally)\nlibrary(ggplot2)\nlibrary(flextable)\nlibrary(bayesplot)\n\nbayesplot_theme_set(theme_grey())\ndata(\"mcycle\",package = \"MASS\")\nload(\"Titanic.RData\")\n```\n:::\n\n\nLa base de datos `mcycles` presenta una serie de mediciones de la aceleración de cabezas en un accidente motorizado simulado para probar la resistencia al impacto en cascos. La base de datos contiene las siguiente variables:\n\n + `accel`: La aceleración obtenida al momento de impacto. (**Dependiente**)\n\n + `times`: El tiempo previo al impacto. (`ms`)\n\n\n::: {.cell}\n\n```{.r .cell-code}\nggplot(mcycle,aes(times, accel))+\n  geom_point()+\n  labs(title = \"Aceleración de cabezas al momento de impacto\",\n       subtitle = \"Accidentes motorizados simulados\",\n       y = \"aceleracion (g)\",x  = \"tiempo (ms)\")\n```\n\n::: {.cell-output-display}\n![Gráfico de dispersión de las simulaciones.](index_files/figure-html/fig-dat-1.png){#fig-dat width=672}\n:::\n:::\n\n\nPara medir la relación de la aceleración obtenida de los accidentes utilizaremos un GAM normal tal que:\n\n$$accel_i \\sim N(\\mu_i,\\sigma^2), \\quad  g(\\mu_i) = \\mu_i, \\text{ y } \\mu_i = f(times_i).$$\nDonde $f(times) = \\sum^k_{t = 1}\\beta_t b_t(times)$ representa aproximación por base Splines para la media del modelo. El siguiente código limpia la base de datos para obtener las variables de interés\n\n\n::: {.cell}\n\n```{.r .cell-code}\nm1 = gam(accel ~ s(times,k = 15,bs = \"fs\",m = 2),data = mcycle)\nsummary(m1)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n\nFamily: gaussian \nLink function: identity \n\nFormula:\naccel ~ s(times, k = 15, bs = \"fs\", m = 2)\n\nParametric coefficients:\n            Estimate Std. Error t value Pr(>|t|)    \n(Intercept)  -25.546      1.965     -13   <2e-16 ***\n---\nSignif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1\n\nApproximate significance of smooth terms:\n           edf Ref.df     F p-value    \ns(times) 10.44  12.18 38.07  <2e-16 ***\n---\nSignif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1\n\nR-sq.(adj) =   0.78   Deviance explained = 79.8%\nGCV = 561.61  Scale est. = 513.3     n = 133\n```\n:::\n:::\n\n\nEl resumen del modelo presenta un análisis de significancia para el vector de parámetros $\\hat \\beta$, que en este caso es de dimensión $d = 15$, y que debido al TLC se distribuye normal multivariada.  El siguiente código genera una muestra Bootstrap para cada uno de los parámetros del modelo $M_1$.\n\n\n::: {.cell}\n\n```{.r .cell-code  code-fold=\"true\"}\ngam_boots = function(dat,B = 2000){\n  n = dim(dat)[1]\n  est = NULL\n  for (i in 1:B) {\n    si = sample(x = 1:n,size = n,replace = TRUE)\n    mli = gam(accel[si] ~ s(times[si],k = 15,bs = \"fs\",m = 2),data = dat)\n    ci = as.array(mli$coefficients)\n    est = rbind(est,ci)\n  }\n    # Estética\n  cn = dim(est)[2]-1\n  colnames(est) = c(\"intercepto\",paste0(\"beta\",1:cn))\n  return(est)\n}\n```\n:::\n\n\nObtenemos una muestra Bootstrap para los estimadores $\\hat \\beta$ de tamaño $B = 2,000$ repeticiones.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nbtp = gam_boots(dat = mcycle,B = 2000)\n\ncolor_scheme_set(\"viridis\")\n\nmcmc_dens(btp)+\n  labs(title = \"Distribución muestral de los estimadores, GAM\",\n       subtitle =\"Bootstrap B = 2,000 iteraciones\")\n```\n\n::: {.cell-output-display}\n![Gráfico de densidades. Cada densidad representa la distribución muestral aproximada para cada uno de los estimadores usando un Bootstrap de B = 2,000 iteraciones.](index_files/figure-html/fig-btp1-1.png){#fig-btp1 width=672}\n:::\n:::\n\n\nLos intervalos de confianza al 95% son:\n\n\n::: {#tbl-btp .cell tbl-cap='Intervalos de confianza al 95%, obtenidos a partir de una muestra bootstrap de B = 2,000 iteraciones'}\n\n```{.r .cell-code}\nx = apply(btp,MARGIN = 2, FUN = quantile, probs = c(0.025,0.5,0.975)) \n\n# Estética\nx = data.frame( t(x) )\nx$pars = c(\"intercepto\",paste0(\"beta\",1:14))\ncolnames(x) = c(\"q2.5%\",\"Median\",\"q97.5%\",\"parámetros\")\n\nft = flextable(x[c(4,1,2,3)])\nautofit(ft)\n```\n\n::: {.cell-output-display}\n```{=html}\n<div class=\"tabwid\"><style>.cl-31f83262{}.cl-31f27084{font-family:'Helvetica';font-size:11pt;font-weight:normal;font-style:normal;text-decoration:none;color:rgba(0, 0, 0, 1.00);background-color:transparent;}.cl-31f4cfb4{margin:0;text-align:left;border-bottom: 0 solid rgba(0, 0, 0, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);padding-bottom:5pt;padding-top:5pt;padding-left:5pt;padding-right:5pt;line-height: 1;background-color:transparent;}.cl-31f4cfc8{margin:0;text-align:right;border-bottom: 0 solid rgba(0, 0, 0, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);padding-bottom:5pt;padding-top:5pt;padding-left:5pt;padding-right:5pt;line-height: 1;background-color:transparent;}.cl-31f4e044{width:1.058in;background-color:transparent;vertical-align: middle;border-bottom: 2pt solid rgba(102, 102, 102, 1.00);border-top: 2pt solid rgba(102, 102, 102, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-31f4e045{width:1.058in;background-color:transparent;vertical-align: middle;border-bottom: 2pt solid rgba(102, 102, 102, 1.00);border-top: 2pt solid rgba(102, 102, 102, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-31f4e058{width:1.228in;background-color:transparent;vertical-align: middle;border-bottom: 2pt solid rgba(102, 102, 102, 1.00);border-top: 2pt solid rgba(102, 102, 102, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-31f4e059{width:1.007in;background-color:transparent;vertical-align: middle;border-bottom: 2pt solid rgba(102, 102, 102, 1.00);border-top: 2pt solid rgba(102, 102, 102, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-31f4e062{width:1.058in;background-color:transparent;vertical-align: middle;border-bottom: 0 solid rgba(0, 0, 0, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-31f4e063{width:1.058in;background-color:transparent;vertical-align: middle;border-bottom: 0 solid rgba(0, 0, 0, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-31f4e06c{width:1.228in;background-color:transparent;vertical-align: middle;border-bottom: 0 solid rgba(0, 0, 0, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-31f4e076{width:1.007in;background-color:transparent;vertical-align: middle;border-bottom: 0 solid rgba(0, 0, 0, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-31f4e077{width:1.058in;background-color:transparent;vertical-align: middle;border-bottom: 0 solid rgba(0, 0, 0, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-31f4e080{width:1.058in;background-color:transparent;vertical-align: middle;border-bottom: 0 solid rgba(0, 0, 0, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-31f4e08a{width:1.228in;background-color:transparent;vertical-align: middle;border-bottom: 0 solid rgba(0, 0, 0, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-31f4e08b{width:1.007in;background-color:transparent;vertical-align: middle;border-bottom: 0 solid rgba(0, 0, 0, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-31f4e094{width:1.058in;background-color:transparent;vertical-align: middle;border-bottom: 0 solid rgba(0, 0, 0, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-31f4e095{width:1.058in;background-color:transparent;vertical-align: middle;border-bottom: 0 solid rgba(0, 0, 0, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-31f4e09e{width:1.228in;background-color:transparent;vertical-align: middle;border-bottom: 0 solid rgba(0, 0, 0, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-31f4e09f{width:1.007in;background-color:transparent;vertical-align: middle;border-bottom: 0 solid rgba(0, 0, 0, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-31f4e0a8{width:1.058in;background-color:transparent;vertical-align: middle;border-bottom: 0 solid rgba(0, 0, 0, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-31f4e0a9{width:1.058in;background-color:transparent;vertical-align: middle;border-bottom: 0 solid rgba(0, 0, 0, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-31f4e0aa{width:1.228in;background-color:transparent;vertical-align: middle;border-bottom: 0 solid rgba(0, 0, 0, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-31f4e0b2{width:1.007in;background-color:transparent;vertical-align: middle;border-bottom: 0 solid rgba(0, 0, 0, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-31f4e0bc{width:1.058in;background-color:transparent;vertical-align: middle;border-bottom: 0 solid rgba(0, 0, 0, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-31f4e0bd{width:1.058in;background-color:transparent;vertical-align: middle;border-bottom: 0 solid rgba(0, 0, 0, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-31f4e0c6{width:1.228in;background-color:transparent;vertical-align: middle;border-bottom: 0 solid rgba(0, 0, 0, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-31f4e0d0{width:1.007in;background-color:transparent;vertical-align: middle;border-bottom: 0 solid rgba(0, 0, 0, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-31f4e0d1{width:1.058in;background-color:transparent;vertical-align: middle;border-bottom: 2pt solid rgba(102, 102, 102, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-31f4e0d2{width:1.058in;background-color:transparent;vertical-align: middle;border-bottom: 2pt solid rgba(102, 102, 102, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-31f4e0da{width:1.228in;background-color:transparent;vertical-align: middle;border-bottom: 2pt solid rgba(102, 102, 102, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-31f4e0e4{width:1.007in;background-color:transparent;vertical-align: middle;border-bottom: 2pt solid rgba(102, 102, 102, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}</style><table class='cl-31f83262'><caption></caption><thead><tr style=\"overflow-wrap:break-word;\"><td class=\"cl-31f4e044\"><p class=\"cl-31f4cfb4\"><span class=\"cl-31f27084\">parámetros</span></p></td><td class=\"cl-31f4e045\"><p class=\"cl-31f4cfc8\"><span class=\"cl-31f27084\">q2.5%</span></p></td><td class=\"cl-31f4e058\"><p class=\"cl-31f4cfc8\"><span class=\"cl-31f27084\">Median</span></p></td><td class=\"cl-31f4e059\"><p class=\"cl-31f4cfc8\"><span class=\"cl-31f27084\">q97.5%</span></p></td></tr></thead><tbody><tr style=\"overflow-wrap:break-word;\"><td class=\"cl-31f4e062\"><p class=\"cl-31f4cfb4\"><span class=\"cl-31f27084\">intercepto</span></p></td><td class=\"cl-31f4e063\"><p class=\"cl-31f4cfc8\"><span class=\"cl-31f27084\">-33.74242</span></p></td><td class=\"cl-31f4e06c\"><p class=\"cl-31f4cfc8\"><span class=\"cl-31f27084\">-25.51390977</span></p></td><td class=\"cl-31f4e076\"><p class=\"cl-31f4cfc8\"><span class=\"cl-31f27084\">-17.59773</span></p></td></tr><tr style=\"overflow-wrap:break-word;\"><td class=\"cl-31f4e077\"><p class=\"cl-31f4cfb4\"><span class=\"cl-31f27084\">beta1</span></p></td><td class=\"cl-31f4e080\"><p class=\"cl-31f4cfc8\"><span class=\"cl-31f27084\">-86.43808</span></p></td><td class=\"cl-31f4e08a\"><p class=\"cl-31f4cfc8\"><span class=\"cl-31f27084\">-50.53775106</span></p></td><td class=\"cl-31f4e08b\"><p class=\"cl-31f4cfc8\"><span class=\"cl-31f27084\">86.20654</span></p></td></tr><tr style=\"overflow-wrap:break-word;\"><td class=\"cl-31f4e077\"><p class=\"cl-31f4cfb4\"><span class=\"cl-31f27084\">beta2</span></p></td><td class=\"cl-31f4e080\"><p class=\"cl-31f4cfc8\"><span class=\"cl-31f27084\">-56.22651</span></p></td><td class=\"cl-31f4e08a\"><p class=\"cl-31f4cfc8\"><span class=\"cl-31f27084\">-3.28926160</span></p></td><td class=\"cl-31f4e08b\"><p class=\"cl-31f4cfc8\"><span class=\"cl-31f27084\">48.04959</span></p></td></tr><tr style=\"overflow-wrap:break-word;\"><td class=\"cl-31f4e094\"><p class=\"cl-31f4cfb4\"><span class=\"cl-31f27084\">beta3</span></p></td><td class=\"cl-31f4e095\"><p class=\"cl-31f4cfc8\"><span class=\"cl-31f27084\">-92.80978</span></p></td><td class=\"cl-31f4e09e\"><p class=\"cl-31f4cfc8\"><span class=\"cl-31f27084\">98.00417475</span></p></td><td class=\"cl-31f4e09f\"><p class=\"cl-31f4cfc8\"><span class=\"cl-31f27084\">124.52621</span></p></td></tr><tr style=\"overflow-wrap:break-word;\"><td class=\"cl-31f4e077\"><p class=\"cl-31f4cfb4\"><span class=\"cl-31f27084\">beta4</span></p></td><td class=\"cl-31f4e080\"><p class=\"cl-31f4cfc8\"><span class=\"cl-31f27084\">-103.00675</span></p></td><td class=\"cl-31f4e08a\"><p class=\"cl-31f4cfc8\"><span class=\"cl-31f27084\">-53.78880623</span></p></td><td class=\"cl-31f4e08b\"><p class=\"cl-31f4cfc8\"><span class=\"cl-31f27084\">-6.37414</span></p></td></tr><tr style=\"overflow-wrap:break-word;\"><td class=\"cl-31f4e077\"><p class=\"cl-31f4cfb4\"><span class=\"cl-31f27084\">beta5</span></p></td><td class=\"cl-31f4e080\"><p class=\"cl-31f4cfc8\"><span class=\"cl-31f27084\">-80.28676</span></p></td><td class=\"cl-31f4e08a\"><p class=\"cl-31f4cfc8\"><span class=\"cl-31f27084\">-28.98926274</span></p></td><td class=\"cl-31f4e08b\"><p class=\"cl-31f4cfc8\"><span class=\"cl-31f27084\">77.06557</span></p></td></tr><tr style=\"overflow-wrap:break-word;\"><td class=\"cl-31f4e077\"><p class=\"cl-31f4cfb4\"><span class=\"cl-31f27084\">beta6</span></p></td><td class=\"cl-31f4e080\"><p class=\"cl-31f4cfc8\"><span class=\"cl-31f27084\">-89.04965</span></p></td><td class=\"cl-31f4e08a\"><p class=\"cl-31f4cfc8\"><span class=\"cl-31f27084\">38.79923330</span></p></td><td class=\"cl-31f4e08b\"><p class=\"cl-31f4cfc8\"><span class=\"cl-31f27084\">90.37534</span></p></td></tr><tr style=\"overflow-wrap:break-word;\"><td class=\"cl-31f4e077\"><p class=\"cl-31f4cfb4\"><span class=\"cl-31f27084\">beta7</span></p></td><td class=\"cl-31f4e080\"><p class=\"cl-31f4cfc8\"><span class=\"cl-31f27084\">-26.02682</span></p></td><td class=\"cl-31f4e08a\"><p class=\"cl-31f4cfc8\"><span class=\"cl-31f27084\">-0.06114796</span></p></td><td class=\"cl-31f4e08b\"><p class=\"cl-31f4cfc8\"><span class=\"cl-31f27084\">23.77885</span></p></td></tr><tr style=\"overflow-wrap:break-word;\"><td class=\"cl-31f4e0a8\"><p class=\"cl-31f4cfb4\"><span class=\"cl-31f27084\">beta8</span></p></td><td class=\"cl-31f4e0a9\"><p class=\"cl-31f4cfc8\"><span class=\"cl-31f27084\">-31.46533</span></p></td><td class=\"cl-31f4e0aa\"><p class=\"cl-31f4cfc8\"><span class=\"cl-31f27084\">0.49993074</span></p></td><td class=\"cl-31f4e0b2\"><p class=\"cl-31f4cfc8\"><span class=\"cl-31f27084\">32.48495</span></p></td></tr><tr style=\"overflow-wrap:break-word;\"><td class=\"cl-31f4e0bc\"><p class=\"cl-31f4cfb4\"><span class=\"cl-31f27084\">beta9</span></p></td><td class=\"cl-31f4e0bd\"><p class=\"cl-31f4cfc8\"><span class=\"cl-31f27084\">-29.53657</span></p></td><td class=\"cl-31f4e0c6\"><p class=\"cl-31f4cfc8\"><span class=\"cl-31f27084\">-2.72177658</span></p></td><td class=\"cl-31f4e0d0\"><p class=\"cl-31f4cfc8\"><span class=\"cl-31f27084\">20.40368</span></p></td></tr><tr style=\"overflow-wrap:break-word;\"><td class=\"cl-31f4e094\"><p class=\"cl-31f4cfb4\"><span class=\"cl-31f27084\">beta10</span></p></td><td class=\"cl-31f4e095\"><p class=\"cl-31f4cfc8\"><span class=\"cl-31f27084\">-36.23520</span></p></td><td class=\"cl-31f4e09e\"><p class=\"cl-31f4cfc8\"><span class=\"cl-31f27084\">0.54603412</span></p></td><td class=\"cl-31f4e09f\"><p class=\"cl-31f4cfc8\"><span class=\"cl-31f27084\">34.96996</span></p></td></tr><tr style=\"overflow-wrap:break-word;\"><td class=\"cl-31f4e077\"><p class=\"cl-31f4cfb4\"><span class=\"cl-31f27084\">beta11</span></p></td><td class=\"cl-31f4e080\"><p class=\"cl-31f4cfc8\"><span class=\"cl-31f27084\">-20.27582</span></p></td><td class=\"cl-31f4e08a\"><p class=\"cl-31f4cfc8\"><span class=\"cl-31f27084\">1.43754123</span></p></td><td class=\"cl-31f4e08b\"><p class=\"cl-31f4cfc8\"><span class=\"cl-31f27084\">24.66445</span></p></td></tr><tr style=\"overflow-wrap:break-word;\"><td class=\"cl-31f4e077\"><p class=\"cl-31f4cfb4\"><span class=\"cl-31f27084\">beta12</span></p></td><td class=\"cl-31f4e080\"><p class=\"cl-31f4cfc8\"><span class=\"cl-31f27084\">-31.46700</span></p></td><td class=\"cl-31f4e08a\"><p class=\"cl-31f4cfc8\"><span class=\"cl-31f27084\">1.83396840</span></p></td><td class=\"cl-31f4e08b\"><p class=\"cl-31f4cfc8\"><span class=\"cl-31f27084\">34.85059</span></p></td></tr><tr style=\"overflow-wrap:break-word;\"><td class=\"cl-31f4e094\"><p class=\"cl-31f4cfb4\"><span class=\"cl-31f27084\">beta13</span></p></td><td class=\"cl-31f4e095\"><p class=\"cl-31f4cfc8\"><span class=\"cl-31f27084\">-98.04408</span></p></td><td class=\"cl-31f4e09e\"><p class=\"cl-31f4cfc8\"><span class=\"cl-31f27084\">-1.46568098</span></p></td><td class=\"cl-31f4e09f\"><p class=\"cl-31f4cfc8\"><span class=\"cl-31f27084\">99.90742</span></p></td></tr><tr style=\"overflow-wrap:break-word;\"><td class=\"cl-31f4e0d1\"><p class=\"cl-31f4cfb4\"><span class=\"cl-31f27084\">beta14</span></p></td><td class=\"cl-31f4e0d2\"><p class=\"cl-31f4cfc8\"><span class=\"cl-31f27084\">-15.73013</span></p></td><td class=\"cl-31f4e0da\"><p class=\"cl-31f4cfc8\"><span class=\"cl-31f27084\">10.96349509</span></p></td><td class=\"cl-31f4e0e4\"><p class=\"cl-31f4cfc8\"><span class=\"cl-31f27084\">42.98066</span></p></td></tr></tbody></table></div>\n```\n:::\n:::\n\n\nLos intervalos de confianza revelan mayor información a lo obtenido por la prueba-t, el análisis de incertidumbre revela que parámetros desde `beta7` hasta `beta14` son no significativos, y otros parámetros como `beta1` sus intervalos de confianza son no significativos pero sus densidades muestran que cero no contiene probabilidad.\n\nEste análisis revela que el número de nodos en la base es muy grande, por lo tanto, se deberá probar con un modelo más pequeño. Analizamos los residuos del modelo, el siguiente código muestra están centrados en cero pero con alta dispersión. \n\n\n::: {.cell}\n\n```{.r .cell-code}\nsummary(m1$residuals)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n    Min.  1st Qu.   Median     Mean  3rd Qu.     Max. \n-76.8753 -12.3859  -0.6566   0.0000  12.5556  50.5333 \n```\n:::\n:::\n\n\nFinalmente, ajustamos un modelo más pequeño, el modelo $M_2$ es un modelo con base splines tal que el numero de nodos se estimo con validación cruzada generalizada (GCV), resultando con $k = 10$ nodos.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nm2 = gam(accel ~ s(times),data = mcycle)\n\npred1 = predict_gam(m1)\npred2 = predict_gam(m2)\n\npred = rbind(pred1,pred2)\npred$model = sort(rep(c(\"m1\",\"m2\"),50))\n\nggplot(pred,aes(times, fit))+\n  geom_point(data = mcycle,aes(x = times,y = accel))+\n  geom_smooth_ci(group = model,ci_alpha = 0.4)+\n  labs(title = \"Ajuste de los modelos GAMs\",\n       subtitle = \"Accidentes motorizados simulados\",\n       y = \"aceleracion (g)\",x  = \"tiempo (ms)\")\n```\n\n::: {.cell-output-display}\n![Gráfico de ajuste. Se muestra el ajuste de ambos modelos, estos estiman una curva suave para ambos datos, con la limitante de que los intervalos predictivos no se ajustan a los valores atípicos.](index_files/figure-html/fig-fit-1.png){#fig-fit width=672}\n:::\n:::\n\n\nDado que en este modelo queremos encontrar el mejor ajuste, usar un criterio de información como el AIC es suficiente y necesario. @tbl-aic compara ambos modelos donde el modelo $M_2$ que contiene menos nodos presenta un mejor ajuste.\n\n\n::: {#tbl-aic .cell tbl-cap='Comparación de modelos bajo el criterio de información de Akaike'}\n\n```{.r .cell-code}\nx = AIC(m1,m2)\n\n# Estética\nx = data.frame(x)\nx$modelo = c(\"M1\",\"M2\")\ncolnames(x) = c(\"df\",\"AIC\",\"Modelo\")\n\nft = flextable(x[c(3,1,2)])\nautofit(ft)\n```\n\n::: {.cell-output-display}\n```{=html}\n<div class=\"tabwid\"><style>.cl-323e7600{}.cl-3238dc54{font-family:'Helvetica';font-size:11pt;font-weight:normal;font-style:normal;text-decoration:none;color:rgba(0, 0, 0, 1.00);background-color:transparent;}.cl-323b9c46{margin:0;text-align:left;border-bottom: 0 solid rgba(0, 0, 0, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);padding-bottom:5pt;padding-top:5pt;padding-left:5pt;padding-right:5pt;line-height: 1;background-color:transparent;}.cl-323b9c50{margin:0;text-align:right;border-bottom: 0 solid rgba(0, 0, 0, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);padding-bottom:5pt;padding-top:5pt;padding-left:5pt;padding-right:5pt;line-height: 1;background-color:transparent;}.cl-323babdc{width:0.786in;background-color:transparent;vertical-align: middle;border-bottom: 2pt solid rgba(102, 102, 102, 1.00);border-top: 2pt solid rgba(102, 102, 102, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-323babdd{width:0.922in;background-color:transparent;vertical-align: middle;border-bottom: 2pt solid rgba(102, 102, 102, 1.00);border-top: 2pt solid rgba(102, 102, 102, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-323babe6{width:0.965in;background-color:transparent;vertical-align: middle;border-bottom: 2pt solid rgba(102, 102, 102, 1.00);border-top: 2pt solid rgba(102, 102, 102, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-323babf0{width:0.786in;background-color:transparent;vertical-align: middle;border-bottom: 0 solid rgba(0, 0, 0, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-323babf1{width:0.922in;background-color:transparent;vertical-align: middle;border-bottom: 0 solid rgba(0, 0, 0, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-323babfa{width:0.965in;background-color:transparent;vertical-align: middle;border-bottom: 0 solid rgba(0, 0, 0, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-323bac04{width:0.786in;background-color:transparent;vertical-align: middle;border-bottom: 2pt solid rgba(102, 102, 102, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-323bac05{width:0.922in;background-color:transparent;vertical-align: middle;border-bottom: 2pt solid rgba(102, 102, 102, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-323bac0e{width:0.965in;background-color:transparent;vertical-align: middle;border-bottom: 2pt solid rgba(102, 102, 102, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}</style><table class='cl-323e7600'><caption></caption><thead><tr style=\"overflow-wrap:break-word;\"><td class=\"cl-323babdc\"><p class=\"cl-323b9c46\"><span class=\"cl-3238dc54\">Modelo</span></p></td><td class=\"cl-323babdd\"><p class=\"cl-323b9c50\"><span class=\"cl-3238dc54\">df</span></p></td><td class=\"cl-323babe6\"><p class=\"cl-323b9c50\"><span class=\"cl-3238dc54\">AIC</span></p></td></tr></thead><tbody><tr style=\"overflow-wrap:break-word;\"><td class=\"cl-323babf0\"><p class=\"cl-323b9c46\"><span class=\"cl-3238dc54\">M1</span></p></td><td class=\"cl-323babf1\"><p class=\"cl-323b9c50\"><span class=\"cl-3238dc54\">12.44132</span></p></td><td class=\"cl-323babfa\"><p class=\"cl-323b9c50\"><span class=\"cl-3238dc54\">1,220.390</span></p></td></tr><tr style=\"overflow-wrap:break-word;\"><td class=\"cl-323bac04\"><p class=\"cl-323b9c46\"><span class=\"cl-3238dc54\">M2</span></p></td><td class=\"cl-323bac05\"><p class=\"cl-323b9c50\"><span class=\"cl-3238dc54\">10.69331</span></p></td><td class=\"cl-323bac0e\"><p class=\"cl-323b9c50\"><span class=\"cl-3238dc54\">1,216.889</span></p></td></tr></tbody></table></div>\n```\n:::\n:::\n\n\n## Sobrevivencia en el Titanic\n\nRegresamos al análisis de sobrevivencia del Titanic, la base de datos contiene 891 registros y 9 variables, en el trabajo anterior se estimo un modelo GLM logístico para predecir la sobrevivencia de los pasajeros. El modelo seleccionado descartó variables como `Fare` y `Parch`, resultando en el modelo:\n\n$$M2: survival_i \\sim \\text{Bernoulli}(p_i), \\quad p_i = \\frac{1}{1 + e^{-\\beta X_i}}; y \\quad X_i = [Pclass, Sex, Age, SibSp].$$\nEl análisis realizado no contempla relaciones no lineales entre `Fare` y `survival`. Por lo tanto, re-evaluamos la interacción no lineal con las variables continuas `Age` y `Fare`. El nuevo modelo es:\n\n$$M3: survival \\sim \\text{Bernoulli}(p_i), \\quad p_i = \\frac{1}{1 + e^{f_1(X_i)+f_2(X_k)}}.$$ \nDonde: \n\n  + $g(p) = \\text{logit}(p_i)$, es la función de enlace. \n  \n  +  $g(p) = f_1(X_i) + f_2(X_k)$. Las covariables interactuan de forma aditiva.\n\n  + $f_1(X_i) = \\beta_1*[Pclass, Sex, SibSp]$, es un funcional lineal.\n  \n  + $f_2(X_K) = f(Age,Fare) \\approx \\sum_{k=1}^K \\beta_2 b(Age, Fare)$, es un funcional no lineal.\n\n## Ajuste del GAM Logístico\n\nAjustamos el modelo GAM logístico propuesto,y revisamos el ajuste e inferencia de los parámetros.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nm3  = gam(Survived ~ Pclass + Sex + SibSp + s(Fare,Age),\n            data = Train, family = \"binomial\")\nsummary(m3)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n\nFamily: binomial \nLink function: logit \n\nFormula:\nSurvived ~ Pclass + Sex + SibSp + s(Fare, Age)\n\nParametric coefficients:\n            Estimate Std. Error z value Pr(>|z|)    \n(Intercept)   4.1641     0.5141   8.099 5.53e-16 ***\nPclass       -1.2076     0.2123  -5.689 1.28e-08 ***\nSexmale      -2.6842     0.2261 -11.869  < 2e-16 ***\nSibSp        -0.5303     0.1605  -3.305 0.000951 ***\n---\nSignif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1\n\nApproximate significance of smooth terms:\n              edf Ref.df Chi.sq p-value   \ns(Fare,Age) 16.65  21.44  46.34 0.00103 **\n---\nSignif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1\n\nR-sq.(adj) =  0.437   Deviance explained = 37.7%\nUBRE = -0.10016  Scale est. = 1         n = 714\n```\n:::\n:::\n\n\nEl modelo parece ser adecuado, todos los parámetros son significativos y la interaccion no lineal parece brindar buenos resultados.  El siguiente código genera una muestra Bootstrap para cada uno de los parámetros del modelo $M_1$.\n\n\n::: {.cell}\n\n```{.r .cell-code  code-fold=\"true\"}\ngam_boots = function(dat,B = 2000){\n  n = dim(dat)[1]\n  est = NULL\n  for (i in 1:B) {\n    si = sample(x = 1:n,size = n,replace = TRUE)\n    mli = gam(Survived[si] ~ Pclass[si] + Sex[si] + SibSp[si] + s(Fare[si],Age[si]),\n            data = dat, family = \"binomial\")\n    ci = as.array(mli$coefficients)\n    est = rbind(est,ci)\n  }\n    # Estética\n  cn = dim(est)[2]-4\n  colnames(est) = c(\"intercepto\",\"Pclass\",\"Sex\",\"SibSp\",paste0(\"beta\",1:cn))\n  return(est)\n}\n```\n:::\n\n\nObtenemos una muestra Bootstrap para los estimadores $\\hat \\beta$ de tamaño $B = 2,000$ repeticiones.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nbtp = gam_boots(dat = na.exclude(Train),B = 5000)\n\ncolor_scheme_set(\"viridis\")\n\nmcmc_dens(btp)+\n  labs(title = \"Distribución muestral de los estimadores, GAM\",\n       subtitle =\"Bootstrap B = 2,000 iteraciones\")\n```\n:::\n\n::: {.cell}\n::: {.cell-output-display}\n![Gráfico de densidades. Cada densidad representa la distribución muestral aproximada para cada uno de los estimadores usando un Bootstrap de B = 2,000 iteraciones.](index_files/figure-html/fig-btp2-1.png){#fig-btp2 width=1152}\n:::\n:::\n\n\nLa @fig-btp1 muestra la distribución muestral de los estimadores del modelo, se observa que los efectos de la componente no lineal son muy dispersos y centrados en cero. Existe la posibilidad que el efecto no lineal sea no significativo.\n\nPara evaluar el ajuste del modelo calculamos la matriz de confusión y la precisión del modelo.\n\n\n::: {.cell}\n\n```{.r .cell-code}\npred1 = predict (m3,Train[,-c(1:2)],type = \"response\")\npred1 =  ifelse(pred1 > 0.5, 1, 0)\n   \nx = table(pred1, Train$Survived)\nx = round(prop.table(x)*100,2)\nx\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n     \npred1     0     1\n    0 51.26 10.50\n    1  8.12 30.11\n```\n:::\n:::\n\n  \nLa precisión para el modelo $M_3$ es:\n\n\n::: {.cell}\n\n```{.r .cell-code}\nAccuracy = sum(diag(x))\nAccuracy\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n[1] 81.37\n```\n:::\n:::\n\n\n## Selección de modelos, 10-fold-CV\n\nPara seleccionar el mejor modelo usaremos validación cruzada, 10-fold, esto implica que ajustaremos diez veces cada modelo, evaluando la precisión del modelo. Los modelos que se consideraran son los siguientes:\n\n + $M_2:$ GLM logístico reducido sin variables `Parch` y `Fare`.\n \n + $M_3$ GAM logístico con variables lineales `Pclass`, `Sex`, y  `SibSp`. Componente no lineal `Age` y `Fare`\n\nEl siguiente código presenta una función para realizar **k-fold-CV** para cualquier valor de $k$. En caso de querer añadir otros modelos o criterios, la función deberá ser modificada.\n\n\n::: {.cell}\n\n```{.r .cell-code  code-fold=\"true\"}\nkfold = function(df,k){\n  # Generar la particion\n  kfld = createFolds(df[,1],k = k)\n  mat = NULL\n  \n  for (i in 1:k) {\n    # separar los datos en conjuntos de prueba y entrenamiento\n    dfE= df[-kfld[[i]],]\n    dfP = df[kfld[[i]],]\n    # Ajustar los modelos\n    m2  = glm(Survived ~ Pclass + Sex + Age + SibSp,\n              data = dfE,family = binomial)\n    m3  = gam(Survived ~ Pclass + Sex + SibSp + s(Fare,Age),\n            data = dfE, family = \"binomial\")\n\n    p2 = predict(m2,dfP,type = \"response\")\n    p2 =  ifelse(p2 > 0.5, 1, 0)\n    p3  = predict(m3,dfP,type = \"response\")\n    p3 =  ifelse(p3 > 0.5, 1, 0)\n\n    Accuracy = c(\n      sum(diag(round(prop.table(table(p2, dfP[,2]))*100,2))),\n      sum(diag(round(prop.table(table(p3, dfP[,2]))*100,2)))\n    )\n\n    # Unir los datos\n    mat = rbind(mat,Accuracy) \n  }\n  colnames(mat) = c(\"Accuracy1\",\"Accuracy2\")\n  row.names(mat) = NULL\n  return(mat)\n}\n```\n:::\n\n\n@tbl-cv presenta los resultados obtenidos al realizar 10-fold-cv, el modelo $M_3$ es el que presenta la mejor precisión de los dos modelos evaluados.\n\n\n::: {#tbl-cv .cell tbl-cap='Precisión de los modelos. Mediante Validación cruzada.'}\n\n```{.r .cell-code}\nrst = kfold(df = na.exclude(Train),k = 10)\nx = t(apply(rst,MARGIN = 2,FUN = \"quantile\",probs = c(0.025,0.5,0.975)))\n\n# Estética\nx = data.frame(x)\nx$pars =  c(\"Accuracy2\", \"Accuracy3\")\ncolnames(x) = c(\"q2.5%\",\"Median\",\"q97.5%\",\"Criterio\")\n\nft = flextable(x[c(4,1,2,3)])\nautofit(ft)\n```\n\n::: {.cell-output-display}\n```{=html}\n<div class=\"tabwid\"><style>.cl-3c513f9c{}.cl-3c4cc502{font-family:'Helvetica';font-size:11pt;font-weight:normal;font-style:normal;text-decoration:none;color:rgba(0, 0, 0, 1.00);background-color:transparent;}.cl-3c4eaae8{margin:0;text-align:left;border-bottom: 0 solid rgba(0, 0, 0, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);padding-bottom:5pt;padding-top:5pt;padding-left:5pt;padding-right:5pt;line-height: 1;background-color:transparent;}.cl-3c4eaaf2{margin:0;text-align:right;border-bottom: 0 solid rgba(0, 0, 0, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);padding-bottom:5pt;padding-top:5pt;padding-left:5pt;padding-right:5pt;line-height: 1;background-color:transparent;}.cl-3c4eb682{width:0.998in;background-color:transparent;vertical-align: middle;border-bottom: 2pt solid rgba(102, 102, 102, 1.00);border-top: 2pt solid rgba(102, 102, 102, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-3c4eb68c{width:0.922in;background-color:transparent;vertical-align: middle;border-bottom: 2pt solid rgba(102, 102, 102, 1.00);border-top: 2pt solid rgba(102, 102, 102, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-3c4eb696{width:0.786in;background-color:transparent;vertical-align: middle;border-bottom: 2pt solid rgba(102, 102, 102, 1.00);border-top: 2pt solid rgba(102, 102, 102, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-3c4eb697{width:0.998in;background-color:transparent;vertical-align: middle;border-bottom: 0 solid rgba(0, 0, 0, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-3c4eb698{width:0.922in;background-color:transparent;vertical-align: middle;border-bottom: 0 solid rgba(0, 0, 0, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-3c4eb6a0{width:0.786in;background-color:transparent;vertical-align: middle;border-bottom: 0 solid rgba(0, 0, 0, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-3c4eb6aa{width:0.998in;background-color:transparent;vertical-align: middle;border-bottom: 2pt solid rgba(102, 102, 102, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-3c4eb6ab{width:0.922in;background-color:transparent;vertical-align: middle;border-bottom: 2pt solid rgba(102, 102, 102, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-3c4eb6ac{width:0.786in;background-color:transparent;vertical-align: middle;border-bottom: 2pt solid rgba(102, 102, 102, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}</style><table class='cl-3c513f9c'><caption></caption><thead><tr style=\"overflow-wrap:break-word;\"><td class=\"cl-3c4eb682\"><p class=\"cl-3c4eaae8\"><span class=\"cl-3c4cc502\">Criterio</span></p></td><td class=\"cl-3c4eb68c\"><p class=\"cl-3c4eaaf2\"><span class=\"cl-3c4cc502\">q2.5%</span></p></td><td class=\"cl-3c4eb696\"><p class=\"cl-3c4eaaf2\"><span class=\"cl-3c4cc502\">Median</span></p></td><td class=\"cl-3c4eb68c\"><p class=\"cl-3c4eaaf2\"><span class=\"cl-3c4cc502\">q97.5%</span></p></td></tr></thead><tbody><tr style=\"overflow-wrap:break-word;\"><td class=\"cl-3c4eb697\"><p class=\"cl-3c4eaae8\"><span class=\"cl-3c4cc502\">Accuracy2</span></p></td><td class=\"cl-3c4eb698\"><p class=\"cl-3c4eaaf2\"><span class=\"cl-3c4cc502\">72.46450</span></p></td><td class=\"cl-3c4eb6a0\"><p class=\"cl-3c4eaaf2\"><span class=\"cl-3c4cc502\">81.685</span></p></td><td class=\"cl-3c4eb698\"><p class=\"cl-3c4eaaf2\"><span class=\"cl-3c4cc502\">87.18725</span></p></td></tr><tr style=\"overflow-wrap:break-word;\"><td class=\"cl-3c4eb6aa\"><p class=\"cl-3c4eaae8\"><span class=\"cl-3c4cc502\">Accuracy3</span></p></td><td class=\"cl-3c4eb6ab\"><p class=\"cl-3c4eaaf2\"><span class=\"cl-3c4cc502\">72.54325</span></p></td><td class=\"cl-3c4eb6ac\"><p class=\"cl-3c4eaaf2\"><span class=\"cl-3c4cc502\">80.415</span></p></td><td class=\"cl-3c4eb6ab\"><p class=\"cl-3c4eaaf2\"><span class=\"cl-3c4cc502\">87.18725</span></p></td></tr></tbody></table></div>\n```\n:::\n:::\n\n\n## Referencias\n\n\n---\nnocite: |\n @Casella @degroot2012 @Miggon2014 @gelman2013 @BMLR2021 @BMCP2021\n---\n\n\n::: {#refs}\n:::\n",
    "supporting": [
      "index_files"
    ],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {
      "include-in-header": [
        "<link href=\"../../../site_libs/tabwid-1.1.0/tabwid.css\" rel=\"stylesheet\" />\n<link href=\"../../../site_libs/tabwid-1.1.0/scrool.css\" rel=\"stylesheet\" />\n"
      ]
    },
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}