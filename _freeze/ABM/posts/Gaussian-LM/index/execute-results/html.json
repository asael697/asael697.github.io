{
  "hash": "3dcca17f7a31db2c92dd71022b4bdbb1",
  "result": {
    "markdown": "---\ntitle: \"*GLMs Gaussianos*: Capacidad de motores de carros\"\nauthor: \"Asael Alonzo Matamoros\"\ndate: \"2022-11-15\"\ncategories: [Gaussian,code,analysis]\nimage: \"image.jpg\"\nbibliography: ref.bib\nformat: \n  html:\n    toc: true\n    code-copy: true\n    smooth-scroll: true\n    anchor-sections: true\n---\n\n\nEste post presenta un análisis la base `mtcars` usando un modelo lineal múltiple con verosimilitud Gaussiana. \n\nLa base de datos `mtcars` contiene el registro de motores de carros mas populares en USA, 1974. los datos contienen 32 registros, con 10 atributos del motor.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary(caret)\nlibrary(GGally)\nlibrary(ggplot2)\nlibrary(flextable)\nlibrary(bayesplot)\nlibrary(ggfortify)\n```\n:::\n\n\nSe desea predecir la capacidad de consumo de los motores, para eso se evaluaron las siguiente variables.\n\n + `mpg`: Millas por Galón. (**Dependiente**)\n\n + `hp`: Caballos de fuerza.\n\n + `carb`: número de carburadores.\n \n + `wt`: peso del motor.\n \n + `gears`: Número de cambios.\n \n + `vs`: tipo de motor, `recto:1` o `tipo V:0`.\n\n## Verosimilitud\n \nPara medir la relación de consumo de los motores utilizaremos un GLM normal tal que:\n\n$$mpg_i \\sim N(\\mu_i,\\sigma^2), \\quad  g(\\mu_i) = \\mu_i, \\text{ y } \\mu_i = \\beta X_i.$$\n\nEl siguiente código limpia la base de datos para obtener las variables de interés\n\n\n::: {.cell}\n\n```{.r .cell-code}\ndf = mtcars[,c(1,4,6,8,10,11)]\nstr(df)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n'data.frame':\t32 obs. of  6 variables:\n $ mpg : num  21 21 22.8 21.4 18.7 18.1 14.3 24.4 22.8 19.2 ...\n $ hp  : num  110 110 93 110 175 105 245 62 95 123 ...\n $ wt  : num  2.62 2.88 2.32 3.21 3.44 ...\n $ vs  : num  0 0 1 1 0 1 0 1 1 1 ...\n $ gear: num  4 4 4 3 3 3 3 4 4 4 ...\n $ carb: num  4 4 1 1 2 1 4 2 2 4 ...\n```\n:::\n:::\n\n \nTodas las variables son numéricas, pero algunas son totalmente enteras, dificultando el proceso de análisis, se procede a revisar las correlaciones para revisar las interacciones lineales entre variables.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nggpairs(df)\n```\n\n::: {.cell-output-display}\n![Gráfico de pares. La diagonal principal muestra histogramas densidades de cada una de las variables. La parte superior muestra el coeficiente de correlación entre dos variables, fila y columna. La parte inferior muestra un gráfico de dispersión entre dos variables.](index_files/figure-html/fig-pairs-1.png){#fig-pairs width=672}\n:::\n:::\n\n  \n@fig-pairs muestra colinealidad entre las variables `mpg, hp` y `wt`. Por lo tanto, múltiples modelos deben ser considerados. Realizemos un modelo inicial, el considerado el modelo completo que posee todas las variables\n\n::: {.callout-note}\n\n### Colinealidad\n\nDos covariables $X_1$ y $X_2$ se dicen ser **colineales** si las variables son **linealmente dependientes**. \n\nRecordar que si dos columnas de una matriz son linealmente dependiente, entonces el determinante es cero.\n\n:::\n\n## Ajuste del modelo\n\nAjustamos el modelo completo que consiste en usar todas las variables, y revisamos el ajuste e inferencia de los parámetros.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nm1 = lm(mpg~.,data = df)\nsummary(m1)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n\nCall:\nlm(formula = mpg ~ ., data = df)\n\nResiduals:\n    Min      1Q  Median      3Q     Max \n-3.2884 -1.4370 -0.3155  1.1697  5.8246 \n\nCoefficients:\n            Estimate Std. Error t value Pr(>|t|)    \n(Intercept) 27.20311    5.74212   4.737 6.72e-05 ***\nhp          -0.02339    0.01353  -1.728   0.0958 .  \nwt          -2.74663    0.92005  -2.985   0.0061 ** \nvs           0.94692    1.36929   0.692   0.4954    \ngear         1.78520    1.12762   1.583   0.1255    \ncarb        -0.65498    0.57767  -1.134   0.2672    \n---\nSignif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1\n\nResidual standard error: 2.569 on 26 degrees of freedom\nMultiple R-squared:  0.8477,\tAdjusted R-squared:  0.8184 \nF-statistic: 28.94 on 5 and 26 DF,  p-value: 7.653e-10\n```\n:::\n:::\n\n\nDebido a la alta colinealidad entre las variables, pocos parámetros estimados son significativos.  Procedemos a eliminar algunas variables del modelo. Eliminamos la variable `wt` al ser colineal con múltiples variables. Por lo tanto, el modelo inicial $M_1$ es:\n\n\n::: {.cell}\n\n```{.r .cell-code}\nm1  =  lm(mpg~vs+hp+gear+carb,data = df)\nsummary(m1)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n\nCall:\nlm(formula = mpg ~ vs + hp + gear + carb, data = df)\n\nResiduals:\n    Min      1Q  Median      3Q     Max \n-3.8047 -2.3487 -0.0967  1.9188  6.7859 \n\nCoefficients:\n            Estimate Std. Error t value Pr(>|t|)    \n(Intercept) 13.03756    3.67694   3.546  0.00145 ** \nvs           0.84671    1.55657   0.544  0.59093    \nhp          -0.03449    0.01480  -2.331  0.02747 *  \ngear         4.20129    0.89285   4.705 6.72e-05 ***\ncarb        -1.33338    0.60391  -2.208  0.03593 *  \n---\nSignif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1\n\nResidual standard error: 2.921 on 27 degrees of freedom\nMultiple R-squared:  0.7955,\tAdjusted R-squared:  0.7652 \nF-statistic: 26.25 on 4 and 27 DF,  p-value: 5.825e-09\n```\n:::\n:::\n\n\n## Incertidumbre de los estimadores.\n\nPese que la función `lm` de `R` realiza un análisis de incertidumbre al presentar una *Prueba-t* de significacia para cada parámetro $\\beta_i$, no presenta los intervalos de confianza. Estos serán estimados con **Bootstrap**. La siguiente función obtiene una muestra Bootstrap de los parámetros desconocidos $\\beta$.\n\n\n::: {.cell}\n\n```{.r .cell-code  code-fold=\"true\"}\nlm_boots = function(y,x,B = 1000){\n  n = length(y)\n  est = NULL\n  for (i in 1:B) {\n    si = sample(x = 1:n,size = n,replace = TRUE)\n    mli = lm(y[si]~x[si,] )\n    ci = as.array(mli$coefficients)\n    est = rbind(est,ci)\n  }\n  # Estética\n  cn = colnames(x)\n  colnames(est) = c(\"intercepto\",cn)\n  \n  return(est)\n}\n```\n:::\n\n\nObtenemos una muestra Bootstrap para los estimadores $\\hat \\beta$ de tamaño $B=5,000$ repeticiones\n\n\n::: {.cell}\n\n```{.r .cell-code}\nbtp = lm_boots(y = df$mpg,x = as.matrix(df[,-1]),B = 5000)\n\nbayesplot_theme_set(theme_grey())\nmcmc_dens(btp)+labs(title=\"Distribución muestral de los estimadores\",\n                    subtitle =\"Bootstrap B = 5,000 iteraciones\")\n```\n\n::: {.cell-output-display}\n![Gráfico de densidades. Cada densidad representa la distribución muestral aproximada para cada uno de los estimadores usando un Bootstrap de B=5,000 iteraciones.](index_files/figure-html/fig-btp-1.png){#fig-btp width=672}\n:::\n:::\n\n\nLos intervalos de confianza al 95% son:\n\n\n::: {#tbl-btp .cell tbl-cap='Intervalos de confianza al 95%, obtenidos a partir de una muestra bootstrap de B = 5,000 iteraciones'}\n\n```{.r .cell-code}\nx = apply(btp,MARGIN = 2, FUN = quantile, probs = c(0.025,0.5,0.975)) \n\n# Estética\nx = data.frame( t(x) )\nx$pars = c(\"intercepto\",\"hp\",\"wt\",\"vs\",\"gear\",\"carb\")\ncolnames(x) = c(\"q2.5%\",\"Median\",\"q97.5%\",\"parámetros\")\n\nft = flextable(x[c(4,1,2,3)])\nautofit(ft)\n```\n\n::: {.cell-output-display}\n```{=html}\n<div class=\"tabwid\"><style>.cl-472af04a{}.cl-47256c92{font-family:'Helvetica';font-size:11pt;font-weight:normal;font-style:normal;text-decoration:none;color:rgba(0, 0, 0, 1.00);background-color:transparent;}.cl-4727b010{margin:0;text-align:left;border-bottom: 0 solid rgba(0, 0, 0, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);padding-bottom:5pt;padding-top:5pt;padding-left:5pt;padding-right:5pt;line-height: 1;background-color:transparent;}.cl-4727b024{margin:0;text-align:right;border-bottom: 0 solid rgba(0, 0, 0, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);padding-bottom:5pt;padding-top:5pt;padding-left:5pt;padding-right:5pt;line-height: 1;background-color:transparent;}.cl-4727c078{width:1.058in;background-color:transparent;vertical-align: middle;border-bottom: 2pt solid rgba(102, 102, 102, 1.00);border-top: 2pt solid rgba(102, 102, 102, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-4727c079{width:1.177in;background-color:transparent;vertical-align: middle;border-bottom: 2pt solid rgba(102, 102, 102, 1.00);border-top: 2pt solid rgba(102, 102, 102, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-4727c082{width:1.262in;background-color:transparent;vertical-align: middle;border-bottom: 2pt solid rgba(102, 102, 102, 1.00);border-top: 2pt solid rgba(102, 102, 102, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-4727c083{width:1.058in;background-color:transparent;vertical-align: middle;border-bottom: 0 solid rgba(0, 0, 0, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-4727c08c{width:1.177in;background-color:transparent;vertical-align: middle;border-bottom: 0 solid rgba(0, 0, 0, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-4727c08d{width:1.262in;background-color:transparent;vertical-align: middle;border-bottom: 0 solid rgba(0, 0, 0, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-4727c096{width:1.058in;background-color:transparent;vertical-align: middle;border-bottom: 0 solid rgba(0, 0, 0, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-4727c097{width:1.177in;background-color:transparent;vertical-align: middle;border-bottom: 0 solid rgba(0, 0, 0, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-4727c098{width:1.262in;background-color:transparent;vertical-align: middle;border-bottom: 0 solid rgba(0, 0, 0, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-4727c0a0{width:1.058in;background-color:transparent;vertical-align: middle;border-bottom: 0 solid rgba(0, 0, 0, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-4727c0a1{width:1.177in;background-color:transparent;vertical-align: middle;border-bottom: 0 solid rgba(0, 0, 0, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-4727c0aa{width:1.262in;background-color:transparent;vertical-align: middle;border-bottom: 0 solid rgba(0, 0, 0, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-4727c0ab{width:1.058in;background-color:transparent;vertical-align: middle;border-bottom: 0 solid rgba(0, 0, 0, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-4727c0ac{width:1.177in;background-color:transparent;vertical-align: middle;border-bottom: 0 solid rgba(0, 0, 0, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-4727c0b4{width:1.262in;background-color:transparent;vertical-align: middle;border-bottom: 0 solid rgba(0, 0, 0, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-4727c0be{width:1.058in;background-color:transparent;vertical-align: middle;border-bottom: 0 solid rgba(0, 0, 0, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-4727c0bf{width:1.177in;background-color:transparent;vertical-align: middle;border-bottom: 0 solid rgba(0, 0, 0, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-4727c0c8{width:1.262in;background-color:transparent;vertical-align: middle;border-bottom: 0 solid rgba(0, 0, 0, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-4727c0c9{width:1.058in;background-color:transparent;vertical-align: middle;border-bottom: 2pt solid rgba(102, 102, 102, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-4727c0d2{width:1.177in;background-color:transparent;vertical-align: middle;border-bottom: 2pt solid rgba(102, 102, 102, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-4727c0d3{width:1.262in;background-color:transparent;vertical-align: middle;border-bottom: 2pt solid rgba(102, 102, 102, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}</style><table class='cl-472af04a'><caption></caption><thead><tr style=\"overflow-wrap:break-word;\"><td class=\"cl-4727c078\"><p class=\"cl-4727b010\"><span class=\"cl-47256c92\">parámetros</span></p></td><td class=\"cl-4727c079\"><p class=\"cl-4727b024\"><span class=\"cl-47256c92\">q2.5%</span></p></td><td class=\"cl-4727c079\"><p class=\"cl-4727b024\"><span class=\"cl-47256c92\">Median</span></p></td><td class=\"cl-4727c082\"><p class=\"cl-4727b024\"><span class=\"cl-47256c92\">q97.5%</span></p></td></tr></thead><tbody><tr style=\"overflow-wrap:break-word;\"><td class=\"cl-4727c083\"><p class=\"cl-4727b010\"><span class=\"cl-47256c92\">intercepto</span></p></td><td class=\"cl-4727c08c\"><p class=\"cl-4727b024\"><span class=\"cl-47256c92\">12.20100137</span></p></td><td class=\"cl-4727c08c\"><p class=\"cl-4727b024\"><span class=\"cl-47256c92\">26.97835481</span></p></td><td class=\"cl-4727c08d\"><p class=\"cl-4727b024\"><span class=\"cl-47256c92\">37.948075491</span></p></td></tr><tr style=\"overflow-wrap:break-word;\"><td class=\"cl-4727c096\"><p class=\"cl-4727b010\"><span class=\"cl-47256c92\">hp</span></p></td><td class=\"cl-4727c097\"><p class=\"cl-4727b024\"><span class=\"cl-47256c92\">-0.04826082</span></p></td><td class=\"cl-4727c097\"><p class=\"cl-4727b024\"><span class=\"cl-47256c92\">-0.02391672</span></p></td><td class=\"cl-4727c098\"><p class=\"cl-4727b024\"><span class=\"cl-47256c92\">0.002385223</span></p></td></tr><tr style=\"overflow-wrap:break-word;\"><td class=\"cl-4727c0a0\"><p class=\"cl-4727b010\"><span class=\"cl-47256c92\">wt</span></p></td><td class=\"cl-4727c0a1\"><p class=\"cl-4727b024\"><span class=\"cl-47256c92\">-4.74193174</span></p></td><td class=\"cl-4727c0a1\"><p class=\"cl-4727b024\"><span class=\"cl-47256c92\">-2.63010138</span></p></td><td class=\"cl-4727c0aa\"><p class=\"cl-4727b024\"><span class=\"cl-47256c92\">-0.965883340</span></p></td></tr><tr style=\"overflow-wrap:break-word;\"><td class=\"cl-4727c0ab\"><p class=\"cl-4727b010\"><span class=\"cl-47256c92\">vs</span></p></td><td class=\"cl-4727c0ac\"><p class=\"cl-4727b024\"><span class=\"cl-47256c92\">-2.04529374</span></p></td><td class=\"cl-4727c0ac\"><p class=\"cl-4727b024\"><span class=\"cl-47256c92\">0.72191647</span></p></td><td class=\"cl-4727c0b4\"><p class=\"cl-4727b024\"><span class=\"cl-47256c92\">3.043954024</span></p></td></tr><tr style=\"overflow-wrap:break-word;\"><td class=\"cl-4727c0be\"><p class=\"cl-4727b010\"><span class=\"cl-47256c92\">gear</span></p></td><td class=\"cl-4727c0bf\"><p class=\"cl-4727b024\"><span class=\"cl-47256c92\">0.16602148</span></p></td><td class=\"cl-4727c0bf\"><p class=\"cl-4727b024\"><span class=\"cl-47256c92\">1.83445861</span></p></td><td class=\"cl-4727c0c8\"><p class=\"cl-4727b024\"><span class=\"cl-47256c92\">5.144794762</span></p></td></tr><tr style=\"overflow-wrap:break-word;\"><td class=\"cl-4727c0c9\"><p class=\"cl-4727b010\"><span class=\"cl-47256c92\">carb</span></p></td><td class=\"cl-4727c0d2\"><p class=\"cl-4727b024\"><span class=\"cl-47256c92\">-2.26408869</span></p></td><td class=\"cl-4727c0d2\"><p class=\"cl-4727b024\"><span class=\"cl-47256c92\">-0.71763153</span></p></td><td class=\"cl-4727c0d3\"><p class=\"cl-4727b024\"><span class=\"cl-47256c92\">0.291145300</span></p></td></tr></tbody></table></div>\n```\n:::\n:::\n\n\nLos intervalos de confianza revelan mayor información a lo obtenido por la prueba-t, parámetros como `hp`, y `carb` que son significativos en la prueba, no lo son mediante los intervalos. Esto indica la posibilidad de un modelo mucho mas reducido.\n\n## Análisis de los residuos\n\nUna vez evaluadas las estimaciones del modelo, es necesario revisar los residuos del mismo para corroborar supuestos, la siguiente linea de código presenta un resumen descriptivo de los residuos del modelo inicial $M_1$, en su mayoría  parecen estar centrados en cero.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nsummary(m1$residuals)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n    Min.  1st Qu.   Median     Mean  3rd Qu.     Max. \n-3.80470 -2.34875 -0.09674  0.00000  1.91880  6.78592 \n```\n:::\n:::\n\n\n@fig-res1 presenta una visualización típica para el diagnostico de los residuos, ninguna figura debe presentar un comportamiento polinómico a excepción del gráfico de quantiles (*derecha superior*), que debe seguir el comportamiento de una función lineal creciente.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nautoplot(m1)\n```\n\n::: {.cell-output-display}\n![Gráfico diagnóstico de los residuos, estos cuatro gráficos evaluan el ajuste y supuestos del modelo, si  algún comportamiento polinómico es persistente, entonces los supuestos del modelo no se satisfacen.](index_files/figure-html/fig-res1-1.png){#fig-res1 width=672}\n:::\n:::\n\n\n## Selección de modelos\n\nAdicional al modelo $M_1$, ajustamos dos modelos mas: \n\n$$M_2: \\quad mpg \\sim N(hp+gear+carb,\\sigma^2),$$\n$$M_3: \\quad mpg \\sim N(wt+gear+carb,\\sigma^2).$$\n\n::: {.cell}\n\n```{.r .cell-code  code-fold=\"true\"}\nm2 = lm(mpg~hp+gear+carb,data = df)\nm3 = lm(mpg~wt+gear+carb,data = df)\n```\n:::\n\n\nEl siguiente código calcula el $RMSE$ de un modelo linea en el conjunto de entrenamiento.\n\n\n::: {.cell}\n\n```{.r .cell-code  code-fold=\"true\"}\nrmse = function(m){\n  mse = sum(m$residuals^2)/length(m$residuals)\n  return(sqrt(mse))\n}\n```\n:::\n\n::: {#tbl-criteria .cell tbl-cap='Criterios de información de los modelos. Se selecciona el modelo con menores criterios.'}\n\n```{.r .cell-code}\nx = matrix(0,nrow = 4,ncol = 3)\nx[1,] = c(logLik(m1),logLik(m2),logLik(m3))\nx[2,] = c(AIC(m1),AIC(m2),AIC(m3))\nx[3,] = c(BIC(m1),BIC(m2),BIC(m3))\nx[4,] = c(rmse(m1),rmse(m2),rmse(m3))\n\n# Estética\nx = data.frame(x)\nx$pars =  c(\"logLik\",\"AIC\",\"BIC\",\"RMSE\")\ncolnames(x)  = c(\"Modelo 1\",\"Modelo 2\",\"Modelo 3\",\"Criterio\")\n\nft = flextable(x[c(4,1,2,3)])\nautofit(ft)\n```\n\n::: {.cell-output-display}\n```{=html}\n<div class=\"tabwid\"><style>.cl-47f82b3c{}.cl-47f3b4ee{font-family:'Helvetica';font-size:11pt;font-weight:normal;font-style:normal;text-decoration:none;color:rgba(0, 0, 0, 1.00);background-color:transparent;}.cl-47f5964c{margin:0;text-align:left;border-bottom: 0 solid rgba(0, 0, 0, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);padding-bottom:5pt;padding-top:5pt;padding-left:5pt;padding-right:5pt;line-height: 1;background-color:transparent;}.cl-47f59656{margin:0;text-align:right;border-bottom: 0 solid rgba(0, 0, 0, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);padding-bottom:5pt;padding-top:5pt;padding-left:5pt;padding-right:5pt;line-height: 1;background-color:transparent;}.cl-47f5a240{width:0.778in;background-color:transparent;vertical-align: middle;border-bottom: 2pt solid rgba(102, 102, 102, 1.00);border-top: 2pt solid rgba(102, 102, 102, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-47f5a241{width:1.092in;background-color:transparent;vertical-align: middle;border-bottom: 2pt solid rgba(102, 102, 102, 1.00);border-top: 2pt solid rgba(102, 102, 102, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-47f5a24a{width:0.778in;background-color:transparent;vertical-align: middle;border-bottom: 0 solid rgba(0, 0, 0, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-47f5a24b{width:1.092in;background-color:transparent;vertical-align: middle;border-bottom: 0 solid rgba(0, 0, 0, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-47f5a254{width:0.778in;background-color:transparent;vertical-align: middle;border-bottom: 0 solid rgba(0, 0, 0, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-47f5a255{width:1.092in;background-color:transparent;vertical-align: middle;border-bottom: 0 solid rgba(0, 0, 0, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-47f5a25e{width:0.778in;background-color:transparent;vertical-align: middle;border-bottom: 2pt solid rgba(102, 102, 102, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-47f5a25f{width:1.092in;background-color:transparent;vertical-align: middle;border-bottom: 2pt solid rgba(102, 102, 102, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}</style><table class='cl-47f82b3c'><caption></caption><thead><tr style=\"overflow-wrap:break-word;\"><td class=\"cl-47f5a240\"><p class=\"cl-47f5964c\"><span class=\"cl-47f3b4ee\">Criterio</span></p></td><td class=\"cl-47f5a241\"><p class=\"cl-47f59656\"><span class=\"cl-47f3b4ee\">Modelo 1</span></p></td><td class=\"cl-47f5a241\"><p class=\"cl-47f59656\"><span class=\"cl-47f3b4ee\">Modelo 2</span></p></td><td class=\"cl-47f5a241\"><p class=\"cl-47f59656\"><span class=\"cl-47f3b4ee\">Modelo 3</span></p></td></tr></thead><tbody><tr style=\"overflow-wrap:break-word;\"><td class=\"cl-47f5a24a\"><p class=\"cl-47f5964c\"><span class=\"cl-47f3b4ee\">logLik</span></p></td><td class=\"cl-47f5a24b\"><p class=\"cl-47f59656\"><span class=\"cl-47f3b4ee\">-76.986353</span></p></td><td class=\"cl-47f5a24b\"><p class=\"cl-47f59656\"><span class=\"cl-47f3b4ee\">-77.160742</span></p></td><td class=\"cl-47f5a24b\"><p class=\"cl-47f59656\"><span class=\"cl-47f3b4ee\">-75.196419</span></p></td></tr><tr style=\"overflow-wrap:break-word;\"><td class=\"cl-47f5a254\"><p class=\"cl-47f5964c\"><span class=\"cl-47f3b4ee\">AIC</span></p></td><td class=\"cl-47f5a255\"><p class=\"cl-47f59656\"><span class=\"cl-47f3b4ee\">165.972706</span></p></td><td class=\"cl-47f5a255\"><p class=\"cl-47f59656\"><span class=\"cl-47f3b4ee\">164.321484</span></p></td><td class=\"cl-47f5a255\"><p class=\"cl-47f59656\"><span class=\"cl-47f3b4ee\">160.392838</span></p></td></tr><tr style=\"overflow-wrap:break-word;\"><td class=\"cl-47f5a254\"><p class=\"cl-47f5964c\"><span class=\"cl-47f3b4ee\">BIC</span></p></td><td class=\"cl-47f5a255\"><p class=\"cl-47f59656\"><span class=\"cl-47f3b4ee\">174.767122</span></p></td><td class=\"cl-47f5a255\"><p class=\"cl-47f59656\"><span class=\"cl-47f3b4ee\">171.650163</span></p></td><td class=\"cl-47f5a255\"><p class=\"cl-47f59656\"><span class=\"cl-47f3b4ee\">167.721517</span></p></td></tr><tr style=\"overflow-wrap:break-word;\"><td class=\"cl-47f5a25e\"><p class=\"cl-47f5964c\"><span class=\"cl-47f3b4ee\">RMSE</span></p></td><td class=\"cl-47f5a25f\"><p class=\"cl-47f59656\"><span class=\"cl-47f3b4ee\">2.682864</span></p></td><td class=\"cl-47f5a25f\"><p class=\"cl-47f59656\"><span class=\"cl-47f3b4ee\">2.697525</span></p></td><td class=\"cl-47f5a25f\"><p class=\"cl-47f59656\"><span class=\"cl-47f3b4ee\">2.536917</span></p></td></tr></tbody></table></div>\n```\n:::\n:::\n\n\n@tbl-criteria muestra la tabla de criterios de información para el conjunto de datos `mtcars` para sorpresa del lector el mejor modelo es el alternativo $M_3$ que usa la variable colineal `wt` en vez de `hp`.\n\n## Validación cruzada\n\nEl siguiente código presenta una función para realizar **k-fold-CV** para cualquier valor de $k$. En caso de querer añadir otros modelos o criterios, la función deberá ser modificada.\n\n\n::: {.cell}\n\n```{.r .cell-code  code-fold=\"true\"}\nkfold = function(df,k){\n  # Generar la particion\n  kfld = createFolds(df[,1],k = k)\n  mat = NULL\n  \n  for (i in 1:k) {\n    # separar los datos en conjuntos de prueba y entrenamiento\n    dfE= df[-kfld[[i]],]\n    dfP = df[kfld[[i]],]\n    # Ajustar los modelos\n    m1 = lm(mpg~vs+hp+gear+carb,data = dfE)\n    m2 = lm(mpg~hp+gear+carb,data = dfE)\n    m3 = lm(mpg~wt+gear+carb,data = dfE)\n    \n    p1 = predict(m1,dfP)\n    p2 = predict(m2,dfP)\n    p3 = predict(m3,dfP)\n    \n    # Calcular  RMSE\n    rmse = c(\n             RMSE(pred =  p1,obs = dfP[,1]),\n             RMSE(pred =  p2,obs = dfP[,1]),\n             RMSE(pred =  p3,obs = dfP[,1])\n             )\n    # Unir los datos\n    mat = rbind(mat,rmse) \n  }\n  colnames(mat) = c(\"RMSE1\",\"RMSE2\",\"RMSE3\")\n  row.names(mat) = NULL\n  return(mat)\n}\n```\n:::\n\n\n@tbl-cv presenta los resultados obtenidos al realizar 5-fold-cv usando el rmse como criterio de información, el modelo $M_3$ presenta las mejores predicciones. Por lo tanto, $M_3$ es el modelo con Mayor aprendizaje.\n\n\n::: {#tbl-cv .cell tbl-cap='Criterios de información de los modelos. Mediante Validación cruzada. La tabla presenta los RMSE de cada modelo. bajo un 5-fold cv.'}\n\n```{.r .cell-code}\nrst = kfold(df = df,k = 5)\nx = t(apply(rst,MARGIN = 2,FUN = \"quantile\",probs = c(0.025,0.5,0.975)))\n\n# Estética\nx = data.frame(x)\nx$pars =  c(\"M1\",\"M2\",\"M3\")\ncolnames(x) = c(\"q2.5%\",\"Median\",\"q97.5%\",\"RMSE\")\n\nft = flextable(x[c(4,1,2,3)])\nautofit(ft)\n```\n\n::: {.cell-output-display}\n```{=html}\n<div class=\"tabwid\"><style>.cl-480dd3ce{}.cl-48097bd0{font-family:'Helvetica';font-size:11pt;font-weight:normal;font-style:normal;text-decoration:none;color:rgba(0, 0, 0, 1.00);background-color:transparent;}.cl-480b505e{margin:0;text-align:left;border-bottom: 0 solid rgba(0, 0, 0, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);padding-bottom:5pt;padding-top:5pt;padding-left:5pt;padding-right:5pt;line-height: 1;background-color:transparent;}.cl-480b5068{margin:0;text-align:right;border-bottom: 0 solid rgba(0, 0, 0, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);padding-bottom:5pt;padding-top:5pt;padding-left:5pt;padding-right:5pt;line-height: 1;background-color:transparent;}.cl-480b5bf8{width:0.727in;background-color:transparent;vertical-align: middle;border-bottom: 2pt solid rgba(102, 102, 102, 1.00);border-top: 2pt solid rgba(102, 102, 102, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-480b5c02{width:0.922in;background-color:transparent;vertical-align: middle;border-bottom: 2pt solid rgba(102, 102, 102, 1.00);border-top: 2pt solid rgba(102, 102, 102, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-480b5c03{width:0.727in;background-color:transparent;vertical-align: middle;border-bottom: 0 solid rgba(0, 0, 0, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-480b5c0c{width:0.922in;background-color:transparent;vertical-align: middle;border-bottom: 0 solid rgba(0, 0, 0, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-480b5c0d{width:0.727in;background-color:transparent;vertical-align: middle;border-bottom: 2pt solid rgba(102, 102, 102, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-480b5c16{width:0.922in;background-color:transparent;vertical-align: middle;border-bottom: 2pt solid rgba(102, 102, 102, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}</style><table class='cl-480dd3ce'><caption></caption><thead><tr style=\"overflow-wrap:break-word;\"><td class=\"cl-480b5bf8\"><p class=\"cl-480b505e\"><span class=\"cl-48097bd0\">RMSE</span></p></td><td class=\"cl-480b5c02\"><p class=\"cl-480b5068\"><span class=\"cl-48097bd0\">q2.5%</span></p></td><td class=\"cl-480b5c02\"><p class=\"cl-480b5068\"><span class=\"cl-48097bd0\">Median</span></p></td><td class=\"cl-480b5c02\"><p class=\"cl-480b5068\"><span class=\"cl-48097bd0\">q97.5%</span></p></td></tr></thead><tbody><tr style=\"overflow-wrap:break-word;\"><td class=\"cl-480b5c03\"><p class=\"cl-480b505e\"><span class=\"cl-48097bd0\">M1</span></p></td><td class=\"cl-480b5c0c\"><p class=\"cl-480b5068\"><span class=\"cl-48097bd0\">2.648257</span></p></td><td class=\"cl-480b5c0c\"><p class=\"cl-480b5068\"><span class=\"cl-48097bd0\">2.924445</span></p></td><td class=\"cl-480b5c0c\"><p class=\"cl-480b5068\"><span class=\"cl-48097bd0\">3.647122</span></p></td></tr><tr style=\"overflow-wrap:break-word;\"><td class=\"cl-480b5c03\"><p class=\"cl-480b505e\"><span class=\"cl-48097bd0\">M2</span></p></td><td class=\"cl-480b5c0c\"><p class=\"cl-480b5068\"><span class=\"cl-48097bd0\">2.686454</span></p></td><td class=\"cl-480b5c0c\"><p class=\"cl-480b5068\"><span class=\"cl-48097bd0\">2.875313</span></p></td><td class=\"cl-480b5c0c\"><p class=\"cl-480b5068\"><span class=\"cl-48097bd0\">3.667834</span></p></td></tr><tr style=\"overflow-wrap:break-word;\"><td class=\"cl-480b5c0d\"><p class=\"cl-480b505e\"><span class=\"cl-48097bd0\">M3</span></p></td><td class=\"cl-480b5c16\"><p class=\"cl-480b5068\"><span class=\"cl-48097bd0\">2.416332</span></p></td><td class=\"cl-480b5c16\"><p class=\"cl-480b5068\"><span class=\"cl-48097bd0\">2.916764</span></p></td><td class=\"cl-480b5c16\"><p class=\"cl-480b5068\"><span class=\"cl-48097bd0\">3.234804</span></p></td></tr></tbody></table></div>\n```\n:::\n:::\n\n\n## Referencias\n\n\n---\nnocite: |\n @Casella @degroot2012 @Miggon2014 @gelman2013 @BMLR2021 \n---\n\n\n::: {#refs}\n:::\n",
    "supporting": [
      "index_files"
    ],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {
      "include-in-header": [
        "<link href=\"../../../site_libs/tabwid-1.1.0/tabwid.css\" rel=\"stylesheet\" />\n<link href=\"../../../site_libs/tabwid-1.1.0/scrool.css\" rel=\"stylesheet\" />\n"
      ]
    },
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}